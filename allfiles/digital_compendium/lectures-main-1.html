<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="Numerical Methods for Engineers">
<meta name="keywords" content="vectorizing if tests">

<title>Numerical Methods for Engineers</title>


<style type="text/css">
/* bloodish style */

body {
  font-family: Helvetica, Verdana, Arial, Sans-serif;
  color: #404040;
  background: #ffffff;
}
h1 { font-size: 1.8em;  color: #8A0808; }
h2 { font-size: 1.6em;  color: #8A0808; }
h3 { font-size: 1.4em;  color: #8A0808; }
h4 { color: #8A0808; }
a { color: #8A0808; text-decoration:none; }
tt { font-family: "Courier New", Courier; }
/* pre style removed because it will interfer with pygments */
p { text-indent: 0px; }
hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
p.caption { width: 80%; font-style: normal; text-align: left; }
hr.figure { border: 0; width: 80%; border-bottom: 1px solid #aaa}

div { text-align: justify; text-justify: inter-word; }
</style>


</head>

<!-- tocinfo
{'highest level': 2,
 'sections': [(u' Digital compendium for TKT4140 ', 2, None, '___sec0'),
              (u' Example: Sphere in free fall ',
               2,
               u'example:sphere_freefall',
               u'example:sphere_freefall'),
              (u' Example: Sphere in free fall ', 2, None, '___sec2'),
              (u' Example: Sphere in free fall ', 2, None, '___sec3'),
              (u' Drag coefficient as a function of Re ', 2, None, '___sec4'),
              (u' Python implementation of $C_D$ ', 2, None, '___sec5'),
              (u' Python functions with vector arguments and modules ',
               2,
               None,
               '___sec6'),
              (u' A simple extension of the single-valued function ',
               2,
               None,
               '___sec7'),
              (u' Vectorize the if test with `where` ', 2, None, '___sec8'),
              (u' Vectorize cd_sphere with `where` ', 2, None, '___sec9'),
              (u' Vectorize with booleans ', 2, None, '___sec10'),
              (u' How to make a Python-module and some useful programming features ',
               2,
               None,
               '___sec11'),
              (u' An example module `DragCoefficientGeneric` ',
               2,
               None,
               '___sec12'),
              (u' Differences ', 2, None, '___sec13'),
              (u' Treatment of the term $\\frac{d}{dx} \\left[ p(x) \\frac{d}{dx} u(x)\\right]$ ',
               3,
               None,
               '___sec14'),
              (u" Euler's method ", 2, None, '___sec15'),
              (u' Example: Falling sphere with constant and varying drag ',
               2,
               u'ex:falling_sphere',
               u'ex:falling_sphere'),
              (u" Euler's method for a system ", 3, None, '___sec17'),
              (u" Heun's method ", 2, None, '___sec18'),
              (u" Example: Newton's equation ", 2, None, '___sec19'),
              (u" Example: Falling sphere with Heun's method ",
               2,
               None,
               '___sec20'),
              (u' Runge-Kutta of 4th order ', 2, None, '___sec21'),
              (u' Example: Particle motion in two dimensions ',
               2,
               None,
               '___sec22')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- ------------------- main content ---------------------- -->



<center><h1>Numerical Methods for Engineers</h1></center>  <!-- document title -->



<center><h1>A digital compendium</h1></center>  <!-- document title -->

<p>
<!-- author(s): Johan Kolstø Sønstabø, and Leif Rune Hellevik -->

<center>
<b>Johan Kolstø Sønstabø</b> [1]
</center>

<center>
<b>Leif Rune Hellevik</b> [1]
</center>


<p>
<!-- institution(s) -->

<center>[1] <b>Department of Structural Engineering, NTNU</b></center>
<p>
<center><h4>Jan 19, 2015</h4></center> <!-- date -->
<!-- TOC: on -->

<p>
<!-- TKT4140 Numerical Methods with Computer Laboratory. -->

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec0">Digital compendium for TKT4140 </h2>

<ul>
 <li> Numeriske Beregninger by J.B. Aarseth, revised by Hellevik 2014</li>
 <li> Collaborators</li>

<ul>
  <li> professor Langtangen, UiO</li> 

<ul>
    <li> <a href="https://github.com/hplgit/doconce" target="_blank">Doconce</a> for flexible typesetting</li>
</ul>

   <li> associate professor Trætteberg, IDI,  NTNU</li>

<ul>
    <li> webpage-parser which identifies Python-code for integration in Eclipse IDEs</li> 
</ul>

</ul>

 <li> Funding project <a href="https://www.ntnu.no/wiki/pages/viewpage.action?pageId=72646826" target="_blank">IKTiSU.</a></li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="example:sphere_freefall">Example: Sphere in free fall</h2>

<p>
<center><p><img src="chapter1/programs_and_modules/2.png" align="bottom" width=500></p></center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec2">Example: Sphere in free fall </h2>

<ul>
 <li> diameter \( d \)</li> 
 <li> mass \( m=\rho_k V \),</li>
 <li> \( \rho_k \) : sphere density</li> 
 <li> \( V \): sphere volume</li>
 <li> \( \rho_f \): fluid density</li> 
 <li> \( m_f=\rho_f V \) mass of displaced fluid</li> 
 <li> \( A_k = \frac{\pi}{4}d^2 \): projected area</li>
 <li> \( \frac{1}{2}m_f \): hydro-dynamical mass (added mass)</li>
 <li> \( C_D=C_D(Re) \): drag coefficient</li>
 <li> \( \displaystyle R_e = \frac{vd}{\nu} \): Reynolds number</li>
 <li> \( \nu \): kinematical viscosity</li>
</ul>

<b>Newton's 2nd law in the \( z \)-direction</b>
$$
\begin{equation}
\label{eq:newton_2nd_sphere}
m\frac{dv}{dt} = mg-m_fg-\frac{1}{2}m_f\frac{dv}{dt}-\frac{1}{2}\rho_fv\left|v\right|A_kC_D,
\end{equation}
$$


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec3">Example: Sphere in free fall </h2>
Convenient abbreviations:
$$
\begin{equation}
\rho=\frac{\rho_f}{\rho_k},\ A=1+\frac{\rho}{2}, \ B=(1-\rho)g,\ C=\frac{3\rho}{4d}.
\end{equation}
$$


<p>
<b>Newton's 2nd law reformulated as first order ODE</b>
$$
\begin{eqnarray}
\label{eq:sphere_1st_order}
\frac{dz}{dt}&=& v \\ 
\frac{dv}{dt}&=&\frac{1}{A}(B-C\cdot v\left|v\right|C_d)
\end{eqnarray}
$$


<p>
<b>Newton's 2nd law  as second order ODE</b> \( \Leftarrow v=\frac{dz}{dt} \) 
$$
\begin{equation}
\label{eq:sphere_second_order}
\frac{d^2z}{dt^2}=\frac{1}{A}\left(B-C\cdot \frac{dz}{dt}\bigg|\frac{dz}{dt}\bigg|C_d\right)
\end{equation}
$$

Second order \( \Rightarrow \) requires two initial conditions, e.g. \( v=v_0 \) and \( z=z_0 \) for \( t=0 \).

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec4">Drag coefficient as a function of Re </h2>

<p>
<center><p><img src="chapter1/programs_and_modules/example_sphere.png" align="bottom" height=400 width=600></p></center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec5">Python implementation of \( C_D \) </h2>

<p>
<b>Motivation</b>

<ul>
 <li> Demonstrate functions and modules in Python</li>
 <li> Use \( C_D \) to solve the ODEs for the falling sphere</li>
</ul>

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># chapter1/programs_and_modules/CDsphere.py</span>

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> logspace, zeros

<span style="color: #408080; font-style: italic"># Define the function cd_sphere</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere</span>(Re):
    <span style="color: #BA2121">&quot;This function computes the drag coefficient of a sphere as a function of the Reynolds number Re.&quot;</span>
    <span style="color: #408080; font-style: italic"># Curve fitted after fig . A -56 in Evett and Liu: &quot;Fluid Mechanics and Hydraulics&quot;</span>
    
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> log10, array, polyval
    
    <span style="color: #008000; font-weight: bold">if</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.0</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">8.0e6</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.0</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.5</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">24.0/</span>Re
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.5</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">100.0</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">4.22</span>, <span style="color: #666666">-14.05</span>, <span style="color: #666666">34.87</span>, <span style="color: #666666">0.658</span>])
        CD <span style="color: #666666">=</span> polyval(p, <span style="color: #666666">1.0/</span>Re) 
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">100.0</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">1.0e4</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-30.41</span>, <span style="color: #666666">43.72</span>, <span style="color: #666666">-17.08</span>, <span style="color: #666666">2.41</span>])
        CD <span style="color: #666666">=</span> polyval(p, <span style="color: #666666">1.0/</span>log10(Re))
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">1.0e4</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">3.35e5</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.1584</span>, <span style="color: #666666">2.031</span>, <span style="color: #666666">-8.472</span>, <span style="color: #666666">11.932</span>])
        CD <span style="color: #666666">=</span> polyval(p, log10(Re))
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">3.35e5</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">5.0e5</span>:
        x1 <span style="color: #666666">=</span> log10(Re<span style="color: #666666">/4.5e5</span>)
        CD <span style="color: #666666">=</span> <span style="color: #666666">91.08*</span>x1<span style="color: #666666">**4</span> <span style="color: #666666">+</span> <span style="color: #666666">0.0764</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.06338</span>, <span style="color: #666666">1.1905</span>, <span style="color: #666666">-7.332</span>, <span style="color: #666666">14.93</span>])
        CD <span style="color: #666666">=</span> polyval(p, log10(Re))
    <span style="color: #008000; font-weight: bold">return</span> CD

<span style="color: #408080; font-style: italic"># Calculate drag coefficient</span>
Npts <span style="color: #666666">=</span> <span style="color: #666666">500</span>
Re <span style="color: #666666">=</span> logspace(<span style="color: #666666">-1</span>, <span style="color: #666666">7</span>, Npts, <span style="color: #008000">True</span>, <span style="color: #666666">10</span>)
CD <span style="color: #666666">=</span> zeros(Npts)
i_list <span style="color: #666666">=</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>, Npts<span style="color: #666666">-1</span>)
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> i_list:
    CD[i] <span style="color: #666666">=</span> cd_sphere(Re[i])

<span style="color: #408080; font-style: italic"># Make plot</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib</span> <span style="color: #008000; font-weight: bold">import</span> pyplot
pyplot<span style="color: #666666">.</span>plot(Re, CD, <span style="color: #BA2121">&#39;-b&#39;</span>)
font <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;size&#39;</span> : <span style="color: #666666">16</span>}
pyplot<span style="color: #666666">.</span>rc(<span style="color: #BA2121">&#39;font&#39;</span>, <span style="color: #666666">**</span>font)
pyplot<span style="color: #666666">.</span>yscale(<span style="color: #BA2121">&#39;log&#39;</span>)
pyplot<span style="color: #666666">.</span>xscale(<span style="color: #BA2121">&#39;log&#39;</span>)
pyplot<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;$Re$&#39;</span>)
pyplot<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;$C_D$&#39;</span>)
pyplot<span style="color: #666666">.</span>grid(<span style="color: #BA2121">&#39;on&#39;</span>, <span style="color: #BA2121">&#39;both&#39;</span>, <span style="color: #BA2121">&#39;both&#39;</span>)
pyplot<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;example_sphere.png&#39;</span>, transparent<span style="color: #666666">=</span><span style="color: #008000">True</span>)
pyplot<span style="color: #666666">.</span>show()
</pre></div>
<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere</span>(Re):
    <span style="color: #BA2121">&quot;This function computes the drag coefficient of a sphere as a function of the Reynolds number Re.&quot;</span>
    <span style="color: #408080; font-style: italic"># Curve fitted after fig . A -56 in Evett and Liu: &quot;Fluid Mechanics and Hydraulics&quot;</span>
    
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> log10, array, polyval
    
    <span style="color: #008000; font-weight: bold">if</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.0</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">8.0e6</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.0</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.5</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">24.0/</span>Re
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.5</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">100.0</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">4.22</span>, <span style="color: #666666">-14.05</span>, <span style="color: #666666">34.87</span>, <span style="color: #666666">0.658</span>])
        CD <span style="color: #666666">=</span> polyval(p, <span style="color: #666666">1.0/</span>Re) 
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">100.0</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">1.0e4</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-30.41</span>, <span style="color: #666666">43.72</span>, <span style="color: #666666">-17.08</span>, <span style="color: #666666">2.41</span>])
        CD <span style="color: #666666">=</span> polyval(p, <span style="color: #666666">1.0/</span>log10(Re))
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">1.0e4</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">3.35e5</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.1584</span>, <span style="color: #666666">2.031</span>, <span style="color: #666666">-8.472</span>, <span style="color: #666666">11.932</span>])
        CD <span style="color: #666666">=</span> polyval(p, log10(Re))
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">3.35e5</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">5.0e5</span>:
        x1 <span style="color: #666666">=</span> log10(Re<span style="color: #666666">/4.5e5</span>)
        CD <span style="color: #666666">=</span> <span style="color: #666666">91.08*</span>x1<span style="color: #666666">**4</span> <span style="color: #666666">+</span> <span style="color: #666666">0.0764</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.06338</span>, <span style="color: #666666">1.1905</span>, <span style="color: #666666">-7.332</span>, <span style="color: #666666">14.93</span>])
        CD <span style="color: #666666">=</span> polyval(p, log10(Re))
    <span style="color: #008000; font-weight: bold">return</span> CD
</pre></div>
<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec6">Python functions with vector arguments and modules </h2>

<p>
For many numerical problems variables are most conveniently expressed
by arrays containing many numbers (i.e. vectors) rather than single
numbers (i.e. scalars). The function <code>cd_sphere</code> above takes a scalar
as an argument and returns a scalar value too. For computationally
intensive algorithms where variables are stored in arrays this is
inconvenient and time consuming, as each of the array elements must be
sent to the function independently. In the following, we will
therefore show how to implement functions with vector arguments that
also return vectors. This may be done in various ways. Some
possibilities are presented in the following, and, as we shall see,
some are more time consuming than others. We will also demonstrate how
the time consumption (or efficiency) may be tested.

<p>
<!-- !split  -->

<h2 id="___sec7">A simple extension of the single-valued function </h2>
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere_py_vector</span>(ReNrs):
    CD <span style="color: #666666">=</span> zeros_like(ReNrs)
    counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>

    <span style="color: #008000; font-weight: bold">for</span> Re <span style="color: #AA22FF; font-weight: bold">in</span> ReNrs:
        CD[counter] <span style="color: #666666">=</span> cd_sphere(Re)
        counter <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">return</span> CD
</pre></div>
<ul>
 <li> does the job</li>
 <li> not very efficient.</li>
</ul>

<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec8">Vectorize the if test with <code>where</code> </h2>

<p>
Functions with if tests require a complete rewrite to work with
arrays.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">s <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where(condition, s1, s2)
</pre></div>
<p>
Explanation:

<ul>
 <li> <code>condition</code>: array of boolean values</li>
 <li> <code>s[i] = s1[i]</code> if <code>condition[i]</code> is <code>True</code></li>
 <li> <code>s[i] = s2[i]</code> if <code>condition[i]</code> is <code>False</code></li>
</ul>

Example

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">s <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where(t <span style="color: #666666">&lt;=</span> t1,
             v0<span style="color: #666666">*</span>t <span style="color: #666666">+</span> <span style="color: #666666">0.5*</span>a0<span style="color: #666666">*</span>t<span style="color: #666666">**2</span>,
             v0<span style="color: #666666">*</span>t <span style="color: #666666">+</span> <span style="color: #666666">0.5*</span>a0<span style="color: #666666">*</span>t1<span style="color: #666666">**2</span> <span style="color: #666666">+</span> a0<span style="color: #666666">*</span>t1<span style="color: #666666">*</span>(t<span style="color: #666666">-</span>t1))
</pre></div>
<p>
Note that <code>t &lt;= t1</code> with array <code>t</code> and scalar <code>t1</code> results in a boolean
array <code>b</code> where <code>b[i] = t[i] &lt;= t1</code>.

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec9">Vectorize cd_sphere with <code>where</code> </h2>

<ul>
 <li> multiple calls of the function <code>numpy.where</code></li> 
 <li> one call for each condition, as for each <code>if</code> statement in the function <code>cd_sphere</code>.</li> 
</ul>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere_vector</span>(Re):
    <span style="color: #BA2121">&quot;Computes the drag coefficient of a sphere as a function of the Reynolds number Re.&quot;</span>
    <span style="color: #408080; font-style: italic"># Curve fitted after fig . A -56 in Evett and Liu: &quot;Fluid Mechanics and Hydraulics&quot;</span>

    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> log10, array, polyval, where, zeros_like
    CD <span style="color: #666666">=</span> zeros_like(Re)
   
    CD <span style="color: #666666">=</span> where(Re <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>, <span style="color: #666666">0.0</span>, CD)     <span style="color: #408080; font-style: italic"># condition 1</span>
    
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.0</span>) <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=0.5</span>), <span style="color: #666666">24/</span>Re, CD) <span style="color: #408080; font-style: italic"># condition 2</span>

    p <span style="color: #666666">=</span> array([<span style="color: #666666">4.22</span>, <span style="color: #666666">-14.05</span>, <span style="color: #666666">34.87</span>, <span style="color: #666666">0.658</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.5</span>) <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=100.0</span>), polyval(p, <span style="color: #666666">1.0/</span>Re), CD) <span style="color: #408080; font-style: italic">#condition 3</span>

    p <span style="color: #666666">=</span> array([<span style="color: #666666">-30.41</span>, <span style="color: #666666">43.72</span>, <span style="color: #666666">-17.08</span>, <span style="color: #666666">2.41</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">100.0</span>)  <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">1.0e4</span>), polyval(p, <span style="color: #666666">1.0/</span>log10(Re)), CD) <span style="color: #408080; font-style: italic">#condition 4</span>

    p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.1584</span>, <span style="color: #666666">2.031</span>, <span style="color: #666666">-8.472</span>, <span style="color: #666666">11.932</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">1.0e4</span>)  <span style="color: #666666">&amp;</span>  (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">3.35e5</span>), polyval(p, log10(Re)), CD) <span style="color: #408080; font-style: italic">#condition 5</span>

    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">3.35e5</span>) <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">5.0e5</span>), <span style="color: #666666">91.08*</span>(log10(Re<span style="color: #666666">/4.5e5</span>))<span style="color: #666666">**4</span> <span style="color: #666666">+</span> <span style="color: #666666">0.0764</span>, CD) <span style="color: #408080; font-style: italic">#condition 6</span>

    p  <span style="color: #666666">=</span> array([<span style="color: #666666">-0.06338</span>, <span style="color: #666666">1.1905</span>, <span style="color: #666666">-7.332</span>, <span style="color: #666666">14.93</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">5.05e5</span>)  <span style="color: #666666">&amp;</span>  (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">8.0e6</span>), polyval(p, log10(Re)), CD) <span style="color: #408080; font-style: italic">#condition 7</span>
    
    CD <span style="color: #666666">=</span> where(Re <span style="color: #666666">&gt;</span> <span style="color: #666666">8.0e6</span>, <span style="color: #666666">0.2</span>, CD)  <span style="color: #408080; font-style: italic"># condition 8</span>
    <span style="color: #008000; font-weight: bold">return</span> CD
</pre></div>
<p>
<!-- !split  -->

<h2 id="___sec10">Vectorize with booleans </h2>

<p>
 The elements of the boolean variables evaluate to
either <code>True</code> or <code>False</code>, depending on if the corresponding element in
<code>Re</code> satisfy the condition the variable is assigned.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere_vector_bool</span>(Re):
    <span style="color: #BA2121">&quot;Computes the drag coefficient of a sphere as a function of the Reynolds number Re.&quot;</span>
    <span style="color: #408080; font-style: italic"># Curve fitted after fig . A -56 in Evett and Liu: &quot;Fluid Mechanics and Hydraulics&quot;</span>
    
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> log10, array, polyval, zeros_like
       
    condition1 <span style="color: #666666">=</span> Re <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>
    condition2 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">0</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.5</span>)
    condition3 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">0.5</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">100.0</span>)
    condition4 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">100.0</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">1.0e4</span>)
    condition5 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">1.0e4</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">3.35e5</span>)
    condition6 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">3.35e5</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">5.0e5</span>)
    condition7 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">5.0e5</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">8.0e6</span>)
    condition8 <span style="color: #666666">=</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">8.0e6</span>
    
    CD <span style="color: #666666">=</span> zeros_like(Re)
    CD[condition1] <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>
    
    CD[condition2] <span style="color: #666666">=</span> <span style="color: #666666">24/</span>Re[condition2]
    
    p <span style="color: #666666">=</span> array([<span style="color: #666666">4.22</span>,<span style="color: #666666">-14.05</span>,<span style="color: #666666">34.87</span>,<span style="color: #666666">0.658</span>])
    CD[condition3] <span style="color: #666666">=</span> polyval(p,<span style="color: #666666">1.0/</span>Re[condition3]) 
    
    p <span style="color: #666666">=</span> array([<span style="color: #666666">-30.41</span>,<span style="color: #666666">43.72</span>,<span style="color: #666666">-17.08</span>,<span style="color: #666666">2.41</span>])
    CD[condition4] <span style="color: #666666">=</span> polyval(p,<span style="color: #666666">1.0/</span>log10(Re[condition4]))
    
    p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.1584</span>,<span style="color: #666666">2.031</span>,<span style="color: #666666">-8.472</span>,<span style="color: #666666">11.932</span>])
    CD[condition5] <span style="color: #666666">=</span> polyval(p,log10(Re[condition5]))
    
    CD[condition6] <span style="color: #666666">=</span> <span style="color: #666666">91.08*</span>(log10(Re[condition6]<span style="color: #666666">/4.5e5</span>))<span style="color: #666666">**4</span> <span style="color: #666666">+</span> <span style="color: #666666">0.0764</span>
    
    p  <span style="color: #666666">=</span> array([<span style="color: #666666">-0.06338</span>,<span style="color: #666666">1.1905</span>,<span style="color: #666666">-7.332</span>,<span style="color: #666666">14.93</span>])
    CD[condition7] <span style="color: #666666">=</span> polyval(p,log10(Re[condition7]))
    
    CD[condition8] <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
    
    <span style="color: #008000; font-weight: bold">return</span> CD
</pre></div>
<p>
<!-- !split  -->

<h2 id="___sec11">How to make a Python-module and some useful programming features </h2>

<p>
Python-code may be executed either as a

<ul>
 <li> main program (script), typically with <code>python filename.py</code></li>
 <li> imported in another script/module with <code>import filename</code>.</li>
</ul>

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span><span style="color: #BA2121">&#39;__main__&#39;</span>: 
    <span style="color: #666666">&lt;</span>main program statements<span style="color: #666666">&gt;</span> 
</pre></div>
<p>
<b>Python lists and dictionaries</b> 

<ul>
    <li> Lists hold a list of values and are initialized with empty
      brackets, e.g. <code>fncnames = []</code>. The values of the list are
      accessed with an index, starting from zero. The first value of
      <code>fncnames</code> is <code>fncnames[0]</code>, the second value of <code>fncnames</code> is
      <code>fncnames[1]</code> and so on. You can remove values from the list,
      and add new values to the end by <code>fncnames</code>. Example:
      <code>fncnames.append(name)</code> will append <code>name</code> as the last value of
      the list <code>fncnames</code>. In case it was empty prior to the
      append-operation, <code>name</code> will be the only element in the list.</li>
    <li> Dictionaries are similar to what their name suggests - a
      dictionary - and an empty dictionary is initialized with empty
      braces, e.g. <code>CD = {}</code>.  In a dictionary, you have an 'index' of
      words or keys and the values accessed by their 'key'. Thus, the
      values in a dictionary aren't numbered or ordered, they are only
      accessed by the key. You can add, remove, and modify the values
      in dictionaries. For example with the statement <code>CD[name] =
      func(ReNrs)</code> the results of <code>func(ReNrs)</code> are stored in the list
      <code>CD</code> with key <code>name</code>.</li>
</ul>

To illustrate a very powerful feature of Python data structures
allowing for lists of e.g. function objects we put all the function
names in a list with the statement:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">    funcs <span style="color: #666666">=</span> [cd_sphere_py_vector, cd_sphere_vector, cd_sphere_vector_bool, \ 
             cd_sphere_auto_vector]  <span style="color: #408080; font-style: italic"># list of functions to test</span>
</pre></div>
<p>
which allows for convenient looping over all of the functions with the following construction:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">    <span style="color: #008000; font-weight: bold">for</span> func <span style="color: #AA22FF; font-weight: bold">in</span> funcs:
</pre></div>
<p>
<b>Exception handling</b> Python has a very convenient construction for
testing of potential errors with <a href="https://wiki.python.org/moin/HandlingExceptions" target="_blank">try-except</a> blocks: 
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">try</span>:
    <span style="color: #666666">&lt;</span>statements<span style="color: #666666">&gt;</span> 
<span style="color: #008000; font-weight: bold">except</span> ExceptionType1: 
    <span style="color: #666666">&lt;</span>remedy <span style="color: #008000; font-weight: bold">for</span> ExceptionType1 errors<span style="color: #666666">&gt;</span>
<span style="color: #008000; font-weight: bold">except</span> ExceptionType2: 
    <span style="color: #666666">&lt;</span>remedy <span style="color: #008000; font-weight: bold">for</span> ExceptionType1 errors<span style="color: #666666">&gt;</span> 
<span style="color: #008000; font-weight: bold">except</span>:
    <span style="color: #666666">&lt;</span>remedy <span style="color: #008000; font-weight: bold">for</span> <span style="color: #008000">any</span> other errors<span style="color: #666666">&gt;</span> 
</pre></div>
<p>
In the <code>DragCoefficientGeneric</code> module, this feature is used to handle
the function name for a function which has been vectorized
automatically. For such a function <code>func.func_name</code> has no value and
will return an error, and the name may be found by the statements in
the exception block.

<p>
<b>Efficiency and benchmarking</b> The function <code>clock</code> in the module
<a href="https://docs.python.org/2/library/time.html" target="_blank">time</a>, return a time
expressed in seconds for the current statement and is frequently used
for benchmarking in Python or timing of functions. By subtracting the
time <code>t0</code> recored immediately before a function call from the time
immediately after the function call, an estimate of the elapsed
cpu-time is obtained. In our module <code>DragCoefficientGeneric</code> the
efficiency is implemented with the codelines:
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">        t0 <span style="color: #666666">=</span> time<span style="color: #666666">.</span>clock()
        CD[name] <span style="color: #666666">=</span> func(ReNrs) 
        exec_times[name] <span style="color: #666666">=</span> time<span style="color: #666666">.</span>clock() <span style="color: #666666">-</span> t0
</pre></div>
<p>
<b>Sorting of dictionaries</b>
The computed execution times are for convenience stored in the dictionary <code>exec_time</code> to allow for pairing of the names of the functions and their execution time. 
The dictionary may be <a href="http://stackoverflow.com/questions/575819/sorting-dictionary-keys-in-python" target="_blank">sorted</a> on the values and the corresponding keys sorted are returned by:
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">    exec_keys_sorted <span style="color: #666666">=</span> <span style="color: #008000">sorted</span>(exec_times, key<span style="color: #666666">=</span>exec_times<span style="color: #666666">.</span>get)
</pre></div>
<p>
Afterwards the results may be printed with name and execution time, ordered by the latter, with the most efficient function at the top:
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">    <span style="color: #008000; font-weight: bold">for</span> name_key <span style="color: #AA22FF; font-weight: bold">in</span> exec_keys_sorted:
        <span style="color: #008000; font-weight: bold">print</span> name_key, <span style="color: #BA2121">&#39;</span><span style="color: #BB6622; font-weight: bold">\t</span><span style="color: #BA2121"> execution time = &#39;</span>, <span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%6.6f</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> exec_times[name_key]
</pre></div>
<p>
By running the module <code>DragCoefficientGeneric</code> as a script, and with
500 elements in the <code>ReNrs</code> array we got the following output:
<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">cd_sphere_vector_bool   execution time = 0.000312
cd_sphere_vector        execution time = 0.000641
cd_sphere_auto_vector   execution time = 0.009497
cd_sphere_py_vector     execution time = 0.010144
</pre></div>
<p>
Clearly, the function with the boolean variables was fastest, 
the straight forward vectorized version <code>cd_sphere_py_vector</code> was slowest 
and the built-in function <code>vectorize</code> was nearly as inefficient. 

<p>
<!-- !split  -->

<h2 id="___sec12">An example module <code>DragCoefficientGeneric</code> </h2>

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># chapter1/programs_and_modules/DragCoefficientGeneric.py</span>

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> linspace,array,append,logspace,zeros_like,where,vectorize,\
    logical_and
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>  
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">import</span> loglog,xlabel,ylabel,grid,savefig,show,rc,hold,\
    legend, setp

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy.core.multiarray</span> <span style="color: #008000; font-weight: bold">import</span> scalar

<span style="color: #408080; font-style: italic"># single-valued function</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere</span>(Re):
    <span style="color: #BA2121">&quot;Computes the drag coefficient of a sphere as a function of the Reynolds number Re.&quot;</span>
    <span style="color: #408080; font-style: italic"># Curve fitted after fig . A -56 in Evett and Liu: &quot;Fluid Mechanics and Hydraulics&quot;</span>
    
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> log10,array,polyval    
    
    <span style="color: #008000; font-weight: bold">if</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.0</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">8.0e6</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.0</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.5</span>:
        CD <span style="color: #666666">=</span> <span style="color: #666666">24.0/</span>Re
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.5</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">100.0</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">4.22</span>,<span style="color: #666666">-14.05</span>,<span style="color: #666666">34.87</span>,<span style="color: #666666">0.658</span>])
        CD <span style="color: #666666">=</span> polyval(p,<span style="color: #666666">1.0/</span>Re) 
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">100.0</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">1.0e4</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-30.41</span>,<span style="color: #666666">43.72</span>,<span style="color: #666666">-17.08</span>,<span style="color: #666666">2.41</span>])
        CD <span style="color: #666666">=</span> polyval(p,<span style="color: #666666">1.0/</span>log10(Re))
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">1.0e4</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">3.35e5</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.1584</span>,<span style="color: #666666">2.031</span>,<span style="color: #666666">-8.472</span>,<span style="color: #666666">11.932</span>])
        CD <span style="color: #666666">=</span> polyval(p,log10(Re))
    <span style="color: #008000; font-weight: bold">elif</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">3.35e5</span> <span style="color: #AA22FF; font-weight: bold">and</span> Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">5.0e5</span>:
        x1 <span style="color: #666666">=</span> log10(Re<span style="color: #666666">/4.5e5</span>)
        CD <span style="color: #666666">=</span> <span style="color: #666666">91.08*</span>x1<span style="color: #666666">**4</span> <span style="color: #666666">+</span> <span style="color: #666666">0.0764</span>
    <span style="color: #008000; font-weight: bold">else</span>:
        p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.06338</span>,<span style="color: #666666">1.1905</span>,<span style="color: #666666">-7.332</span>,<span style="color: #666666">14.93</span>])
        CD <span style="color: #666666">=</span> polyval(p,log10(Re))
    <span style="color: #008000; font-weight: bold">return</span> CD

<span style="color: #408080; font-style: italic"># simple extension cd_sphere</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere_py_vector</span>(ReNrs):
    CD <span style="color: #666666">=</span> zeros_like(ReNrs)
    counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>

    <span style="color: #008000; font-weight: bold">for</span> Re <span style="color: #AA22FF; font-weight: bold">in</span> ReNrs:
        CD[counter] <span style="color: #666666">=</span> cd_sphere(Re)
        counter <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">return</span> CD

<span style="color: #408080; font-style: italic"># vectorized function</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere_vector</span>(Re):
    <span style="color: #BA2121">&quot;Computes the drag coefficient of a sphere as a function of the Reynolds number Re.&quot;</span>
    <span style="color: #408080; font-style: italic"># Curve fitted after fig . A -56 in Evett and Liu: &quot;Fluid Mechanics and Hydraulics&quot;</span>

    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> log10, array, polyval, where, zeros_like
    CD <span style="color: #666666">=</span> zeros_like(Re)
   
    CD <span style="color: #666666">=</span> where(Re <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>, <span style="color: #666666">0.0</span>, CD)     <span style="color: #408080; font-style: italic"># condition 1</span>
    
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.0</span>) <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=0.5</span>), <span style="color: #666666">24/</span>Re, CD) <span style="color: #408080; font-style: italic"># condition 2</span>

    p <span style="color: #666666">=</span> array([<span style="color: #666666">4.22</span>, <span style="color: #666666">-14.05</span>, <span style="color: #666666">34.87</span>, <span style="color: #666666">0.658</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">0.5</span>) <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=100.0</span>), polyval(p, <span style="color: #666666">1.0/</span>Re), CD) <span style="color: #408080; font-style: italic">#condition 3</span>

    p <span style="color: #666666">=</span> array([<span style="color: #666666">-30.41</span>, <span style="color: #666666">43.72</span>, <span style="color: #666666">-17.08</span>, <span style="color: #666666">2.41</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">100.0</span>)  <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">1.0e4</span>), polyval(p, <span style="color: #666666">1.0/</span>log10(Re)), CD) <span style="color: #408080; font-style: italic">#condition 4</span>

    p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.1584</span>, <span style="color: #666666">2.031</span>, <span style="color: #666666">-8.472</span>, <span style="color: #666666">11.932</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">1.0e4</span>)  <span style="color: #666666">&amp;</span>  (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">3.35e5</span>), polyval(p, log10(Re)), CD) <span style="color: #408080; font-style: italic">#condition 5</span>

    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">3.35e5</span>) <span style="color: #666666">&amp;</span> (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">5.0e5</span>), <span style="color: #666666">91.08*</span>(log10(Re<span style="color: #666666">/4.5e5</span>))<span style="color: #666666">**4</span> <span style="color: #666666">+</span> <span style="color: #666666">0.0764</span>, CD) <span style="color: #408080; font-style: italic">#condition 6</span>

    p  <span style="color: #666666">=</span> array([<span style="color: #666666">-0.06338</span>, <span style="color: #666666">1.1905</span>, <span style="color: #666666">-7.332</span>, <span style="color: #666666">14.93</span>])
    CD <span style="color: #666666">=</span> where((Re <span style="color: #666666">&gt;</span> <span style="color: #666666">5.05e5</span>)  <span style="color: #666666">&amp;</span>  (Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">8.0e6</span>), polyval(p, log10(Re)), CD) <span style="color: #408080; font-style: italic">#condition 7</span>
    
    CD <span style="color: #666666">=</span> where(Re <span style="color: #666666">&gt;</span> <span style="color: #666666">8.0e6</span>, <span style="color: #666666">0.2</span>, CD)  <span style="color: #408080; font-style: italic"># condition 8</span>
    <span style="color: #008000; font-weight: bold">return</span> CD

<span style="color: #408080; font-style: italic"># vectorized boolean</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">cd_sphere_vector_bool</span>(Re):
    <span style="color: #BA2121">&quot;Computes the drag coefficient of a sphere as a function of the Reynolds number Re.&quot;</span>
    <span style="color: #408080; font-style: italic"># Curve fitted after fig . A -56 in Evett and Liu: &quot;Fluid Mechanics and Hydraulics&quot;</span>
    
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> log10, array, polyval, zeros_like
       
    condition1 <span style="color: #666666">=</span> Re <span style="color: #666666">&lt;</span> <span style="color: #666666">0</span>
    condition2 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">0</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">0.5</span>)
    condition3 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">0.5</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">100.0</span>)
    condition4 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">100.0</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">1.0e4</span>)
    condition5 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">1.0e4</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">3.35e5</span>)
    condition6 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">3.35e5</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">5.0e5</span>)
    condition7 <span style="color: #666666">=</span> logical_and(<span style="color: #666666">5.0e5</span> <span style="color: #666666">&lt;</span> Re, Re <span style="color: #666666">&lt;=</span> <span style="color: #666666">8.0e6</span>)
    condition8 <span style="color: #666666">=</span> Re <span style="color: #666666">&gt;</span> <span style="color: #666666">8.0e6</span>
    
    CD <span style="color: #666666">=</span> zeros_like(Re)
    CD[condition1] <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>
    
    CD[condition2] <span style="color: #666666">=</span> <span style="color: #666666">24/</span>Re[condition2]
    
    p <span style="color: #666666">=</span> array([<span style="color: #666666">4.22</span>,<span style="color: #666666">-14.05</span>,<span style="color: #666666">34.87</span>,<span style="color: #666666">0.658</span>])
    CD[condition3] <span style="color: #666666">=</span> polyval(p,<span style="color: #666666">1.0/</span>Re[condition3]) 
    
    p <span style="color: #666666">=</span> array([<span style="color: #666666">-30.41</span>,<span style="color: #666666">43.72</span>,<span style="color: #666666">-17.08</span>,<span style="color: #666666">2.41</span>])
    CD[condition4] <span style="color: #666666">=</span> polyval(p,<span style="color: #666666">1.0/</span>log10(Re[condition4]))
    
    p <span style="color: #666666">=</span> array([<span style="color: #666666">-0.1584</span>,<span style="color: #666666">2.031</span>,<span style="color: #666666">-8.472</span>,<span style="color: #666666">11.932</span>])
    CD[condition5] <span style="color: #666666">=</span> polyval(p,log10(Re[condition5]))
    
    CD[condition6] <span style="color: #666666">=</span> <span style="color: #666666">91.08*</span>(log10(Re[condition6]<span style="color: #666666">/4.5e5</span>))<span style="color: #666666">**4</span> <span style="color: #666666">+</span> <span style="color: #666666">0.0764</span>
    
    p  <span style="color: #666666">=</span> array([<span style="color: #666666">-0.06338</span>,<span style="color: #666666">1.1905</span>,<span style="color: #666666">-7.332</span>,<span style="color: #666666">14.93</span>])
    CD[condition7] <span style="color: #666666">=</span> polyval(p,log10(Re[condition7]))
    
    CD[condition8] <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
    
    <span style="color: #008000; font-weight: bold">return</span> CD
    

<span style="color: #008000; font-weight: bold">if</span> __name__ <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;__main__&#39;</span>:              
<span style="color: #408080; font-style: italic">#Check whether this file is executed (name==main) or imported as a module</span>
    
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">time</span>
    <span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> mean
    
    CD <span style="color: #666666">=</span> {} <span style="color: #408080; font-style: italic"># Empty list for all CD computations</span>
    

    ReNrs <span style="color: #666666">=</span> logspace(<span style="color: #666666">-2</span>,<span style="color: #666666">7</span>,num<span style="color: #666666">=500</span>)
    
    <span style="color: #408080; font-style: italic"># make a vectorized version of the function automatically</span>
    cd_sphere_auto_vector <span style="color: #666666">=</span> vectorize(cd_sphere) 
    
    <span style="color: #408080; font-style: italic"># make a list of all function objects</span>
    funcs <span style="color: #666666">=</span> [cd_sphere_py_vector, cd_sphere_vector, cd_sphere_vector_bool, \
             cd_sphere_auto_vector]  <span style="color: #408080; font-style: italic"># list of functions to test   </span>
    
    
    <span style="color: #408080; font-style: italic"># Put all exec_times in a dictionary and fncnames in a list </span>
    exec_times <span style="color: #666666">=</span> {}
    fncnames <span style="color: #666666">=</span> []
    <span style="color: #008000; font-weight: bold">for</span> func <span style="color: #AA22FF; font-weight: bold">in</span> funcs:
        <span style="color: #008000; font-weight: bold">try</span>:
            name <span style="color: #666666">=</span> func<span style="color: #666666">.</span>func_name
        <span style="color: #008000; font-weight: bold">except</span>: 
            scalarname <span style="color: #666666">=</span> func<span style="color: #666666">.</span>__getattribute__(<span style="color: #BA2121">&#39;pyfunc&#39;</span>)
            name <span style="color: #666666">=</span> scalarname<span style="color: #666666">.</span>__name__<span style="color: #666666">+</span><span style="color: #BA2121">&#39;_auto_vector&#39;</span>
                      
        fncnames<span style="color: #666666">.</span>append(name)
                                      
        <span style="color: #408080; font-style: italic"># benchmark </span>
        t0 <span style="color: #666666">=</span> time<span style="color: #666666">.</span>clock()
        CD[name] <span style="color: #666666">=</span> func(ReNrs) 
        exec_times[name] <span style="color: #666666">=</span> time<span style="color: #666666">.</span>clock() <span style="color: #666666">-</span> t0
    
    <span style="color: #408080; font-style: italic"># sort the dictionary exec_times on values and return a list of the corresponding keys   </span>
    exec_keys_sorted <span style="color: #666666">=</span> <span style="color: #008000">sorted</span>(exec_times, key<span style="color: #666666">=</span>exec_times<span style="color: #666666">.</span>get)
    
    <span style="color: #408080; font-style: italic"># print the exec_times by ascending values</span>
    <span style="color: #008000; font-weight: bold">for</span> name_key <span style="color: #AA22FF; font-weight: bold">in</span> exec_keys_sorted:
        <span style="color: #008000; font-weight: bold">print</span> name_key, <span style="color: #BA2121">&#39;</span><span style="color: #BB6622; font-weight: bold">\t</span><span style="color: #BA2121"> execution time = &#39;</span>, <span style="color: #BA2121">&#39;</span><span style="color: #BB6688; font-weight: bold">%6.6f</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> exec_times[name_key]

        
    <span style="color: #408080; font-style: italic"># set fontsize prms </span>
    fnSz <span style="color: #666666">=</span> <span style="color: #666666">16</span>; font <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;size&#39;</span>   : fnSz}; rc(<span style="color: #BA2121">&#39;font&#39;</span>,<span style="color: #666666">**</span>font)          
    
    <span style="color: #408080; font-style: italic"># set line styles</span>
    style <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;v-&#39;</span>, <span style="color: #BA2121">&#39;8-&#39;</span>, <span style="color: #BA2121">&#39;*-&#39;</span>, <span style="color: #BA2121">&#39;o-&#39;</span>]
    mrkevry <span style="color: #666666">=</span> [<span style="color: #666666">30</span>, <span style="color: #666666">35</span>, <span style="color: #666666">40</span>, <span style="color: #666666">45</span>]
    
    <span style="color: #408080; font-style: italic"># plot the result for all functions    </span>
    i<span style="color: #666666">=0</span>
    <span style="color: #008000; font-weight: bold">for</span> name <span style="color: #AA22FF; font-weight: bold">in</span> fncnames: 
        loglog(ReNrs, CD[name], style[i], markersize<span style="color: #666666">=10</span>, markevery<span style="color: #666666">=</span>mrkevry[i])
        hold(<span style="color: #BA2121">&#39;on&#39;</span>)
        i<span style="color: #666666">+=1</span> 
    
    <span style="color: #408080; font-style: italic"># use fncnames as plot legend</span>
    leg <span style="color: #666666">=</span> legend(fncnames) 
    leg<span style="color: #666666">.</span>get_frame()<span style="color: #666666">.</span>set_alpha(<span style="color: #666666">0.</span>)
    xlabel(<span style="color: #BA2121">&#39;$Re$&#39;</span>)
    ylabel(<span style="color: #BA2121">&#39;$C_D$&#39;</span>)
    grid(<span style="color: #BA2121">&#39;on&#39;</span>, <span style="color: #BA2121">&#39;both&#39;</span>, <span style="color: #BA2121">&#39;both&#39;</span>)
    <span style="color: #408080; font-style: italic"># savefig(&#39;example_sphere_generic.png&#39;, transparent=True) # save plot if needed</span>
    show()
</pre></div>
<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec13">Differences </h2>
<center><p><img src="chapter1/4_new.png" align="bottom" width=300></p></center>

$$
\begin{equation*}
x_j=x_0+jh
\end{equation*}
$$

where \( h=\Delta x \) is assumed constant unless otherwise stated.

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 1:  Illustration of how to obtain difference equations. <div id="fig:1.5"></div> </p></center>
<p><img src="chapter1/5_new.png" align="bottom" width=300></p>
</center>

<p>
Forward differences:
$$
\begin{equation*}
\Delta y_j=y_{j+1}-y_j
\end{equation*}
$$


<p>
Backward differences:
$$
\begin{equation}
\label{eq:1201}
\nabla y_j=y_j-y_{j-1}
\end{equation}
$$


<p>
Central differences:
$$
\begin{equation*}
\delta y_{j+\frac{1}{2}}=y_{j+1}-y_j
\end{equation*}
$$


<p>
The linear difference operators \( \Delta \), \( \nabla \) and \( \delta \) are useful when we are deriving more complicated expressions. An example of usage is as follows,
$$
\begin{equation*}
\delta ^2y_j=\delta (\delta y_j)=\delta (y_{1+\frac{1}{2}}-y_{1-\frac{1}{2}})
=y_{j+1}-y_j-(y_j-y_{j-1})=y_{j+1}-2y_j+y_{j-1}
\end{equation*}
$$


<p>
We will mainly write out the formulas entirely instead of using operators.

<p>
We shall find difference formulas and need again <b>Taylor's theorem</b>:
$$
\begin{align}
\label{eq:1202}
y(x)=&y(x_0)+y'(x_0)\cdot (x-x_0)+\frac{1}{2}y''(x_0)\cdot (x-x_0)^2 + \\ 
&\dots + \frac{1}{n!}y^{(n)}(x_0)\cdot (x-x_0)^n +R_n \nonumber
\end{align}
$$


<p>
The remainder \( R_n \) is given by
$$
\begin{align}
R_n&=\frac{1}{(n+1)!}y^{(n+1)}(\xi)\cdot (x-x_0)^{n+1}\\ 
&\text{where } \xi \in (x_0,x) \nonumber
\end{align}
$$


<p>
By use of \eqref{eq:1202} we get
$$
\begin{align}
\label{eq:1203a}
y(x_{j+1}) \equiv &y(x_j+h)=y(x_j)+hy'(x_j) +\frac{h^2}{2}y''(x_j)+\\ 
&\dots+\frac{h^ny^{(n)}(x_j)}{n!}+R_n \nonumber
\end{align}
$$

where the remainder \( R_n=O(h^{n+1}),\ h\to 0  \).

<p>
From \eqref{eq:1203a} we also get
$$
\begin{equation}
\label{eq:1203b}
y(x_{j-1}) \equiv y(x_j-h)=y(x_j)-hy'(x_j)+\frac{h^2}{2}y''(x_j)+\dots+\frac{h^k(-1)^ky^{(k)}(x_j)}{k!}+\dots
\end{equation}
$$


<p>
We will here and subsequently assume that \( h \) is positive.

<p>
We solve \eqref{eq:1203a} with respect to \( y' \):
$$
\begin{equation}
\label{eq:1204a}
y'(x_j)=\frac{y(x_{j+1})-y(x_j)}{h}+O(h)
\end{equation}
$$


<p>
We solve \eqref{eq:1203b} with respect to \( y' \):
$$
\begin{equation}
\label{eq:1204b}
y'(x_j)=\frac{y(x_{j})-y(x_{j-1})}{h}+O(h)
\end{equation}
$$


<p>
By addition of \eqref{eq:1203b} and \eqref{eq:1203a} we get
$$
\begin{equation}
\label{eq:1204c}
y''(x_j)=\frac{y(x_{j+1})-2y(x_{j})+y(x_{j-1})}{h^2}+O(h^2)
\end{equation}
$$


<p>
By subtraction of \eqref{eq:1203b} from \eqref{eq:1203a} we get
$$
\begin{equation}
\label{eq:1204d}
y'(x_j)=\frac{y(x_{j+1})-y(x_{j-1})}{2h}+O(h^2)
\end{equation}
$$


<p>
<b>Notation:</b> We let \( y(x_j) \) always denote the function \( y(x) \) with \( x=x_j \). We use \( y_j \) both for the numerical and analytical value. Which is which will be implied.

<p>
Equations \eqref{eq:1204a}, \eqref{eq:1204b}, \eqref{eq:1204c} and \eqref{eq:1204d} then gives the following difference expressions:
$$
\begin{align}
\label{eq:1205a}
&y'_j=\frac{y_{j+1}-y_j}{h}\ ;\  \text{truncation error}\ O(h)\\ 
\label{eq:1205b}
&y'_j=\frac{y_{j}-y_{j-1}}{h}\ ;\  \text{truncation error}\ O(h)\\ 
\label{eq:1205c}
&y''_j=\frac{y_{j+1}-2y_j+y_{j-1}}{h^2}\ ;\  \text{truncation error}\ O(h^2)\\ 
\label{eq:1205d}
&y'_j=\frac{y_{j+1}-y_{j-1}}{2h}\ ;\  \text{truncation error}\ O(h^2)
\end{align}
$$


<p>
\eqref{eq:1205a} is a forward difference, \eqref{eq:1205b} is a backward difference while \eqref{eq:1205c} and \eqref{eq:1205d} are central differences.

<p>
<center><p><img src="chapter1/6.png" align="bottom" width=300></p></center>

<p>
The expressions in \eqref{eq:1205a}, \eqref{eq:1205b}, \eqref{eq:1205c} and \eqref{eq:1205d} are easily established from the figure.

<p>
\eqref{eq:1205a} follows directly.

<p>
\eqref{eq:1205c}:
$$
\begin{equation*}
y''_j(x_j)=\left(\frac{y_{j+1}-y_j}{h}-\frac{y_{j}-y_{j-1}}{h}\right)\cdot \frac{1}{h} = \frac{y_{j+1}-2y_j+y_{j-1}}{h^2}
\end{equation*}
$$


<p>
\eqref{eq:1205d}:

$$
\begin{equation*}
y'_j=\left(\frac{y_{j+1}-y_j}{h}-\frac{y_{j}+y_{j-1}}{h}\right)\cdot \frac{1}{2}=\frac{y_{j+1}-y_{j-1}}{2h}
\end{equation*}
$$


<p>
To find the truncation error we must use the Taylor series expansion.

<p>
The derivation above may be done more systematically. We set
$$
\begin{equation}
\label{eq:1206a}
y'(x_j)=a\cdot y(x_{j-1})+b\cdot y(x_j)+c\cdot y(x_{j+1})+O(h^m)
\end{equation}
$$

where we shall determine the constants \( a \), \( b \) and \( c \) together with the error term. For simplicity we use the notation \( y_j\equiv y(x_j),\ y'_j \equiv y'(x_j) \) and so on. From the Taylor series expansion in \eqref{eq:1203a} and \eqref{eq:1203b} we get
$$
\begin{align*}
&a\cdot y_{j-1}+b\cdot y_j +c\cdot y_{j+1} = \\ 
&a\cdot\left[y_j-hy'_j+\frac{h^2}{2}y''_j+\frac{h^3}{6}y'''_j(\xi)\right]+b\cdot y_j + \\ 
&c\cdot \left[y_j-hy'_j+\frac{h^2}{2}y''_j+\frac{h^3}{6}y'''_j(\xi)\right]
\end{align*}
$$

Collecting terms:
$$
\begin{align*}
a\cdot y_{j-1}+b\cdot y_j +c\cdot y_{j+1} = \\ 
(a+b+c)y_j+(c-a)hy'_j+ \\ 
(a+c)\frac{h^2}{2}y''_j+(c-a)\frac{h^3}{6}y'''(\xi)
\end{align*}
$$

We determine \( a \), \( b \) and \( c \) such that \( y'_j \) gets as high accuracy as possible:
$$
\begin{align}
a+b+c=0 \nonumber \\ 
(c-a)\cdot h=1
\label{eq:1206b}\\ \nonumber
a+c=1
\end{align}
$$

The solution to \eqref{eq:1206b} is
$$
\begin{equation*}
a=-\frac{1}{2h},\ b=0 \text{ and } c=\frac{1}{2h}
\end{equation*}
$$

which when inserted in \eqref{eq:1206a} gives
$$
\begin{equation}
\label{eq:1207}
y'_j=\frac{y_{j+1}-y_{j-1}}{2h}-\frac{h^2}{6}y'''(\xi)
\end{equation}
$$

Comparing \eqref{eq:1207} with \eqref{eq:1206a} we see that the error term is \( O(h^m)=-\frac{h^2}{6}y'''(\xi) \), which means that \( m=2 \). As expected, \eqref{eq:1207} is identical to \eqref{eq:1204d}.

<p>
Let's use this method to find a forward difference expression for \( y'(x_j) \) with accuracy of \( O(h^2) \). Second order accuracy requires at least three unknown coefficients. Thus,
$$
\begin{equation}
\label{eq:1208a}
y'(x_j)=a\cdot y_j + b\cdot y_{j+1} + c\cdot y_{j+2} + O(h^m)
\end{equation}
$$

The procedure goes as in the previous example as follows,
$$
\begin{align*}
a&\cdot y_{j}+b\cdot y_{j+1} +c\cdot y_{j+2} =\\ 
a&\cdot y_j+b\cdot\left[y_j+hy'_j+\frac{h^2}{2}y''_j+\frac{h^3}{6}y'''(\xi)\right]+\\ 
c&\cdot \left[y_j+2hy'_j+2h^2y''_j+\frac{8h^3}{6}y'''_j(\xi)\right]\\ 
=&(a+b+c)\cdot y_j+(b+2c)\cdot hy'_j \\ 
+& h^2\left(\frac{b}{2}+2c\right)\cdot y''_j+\frac{h^3}{6}(b+8c)\cdot y'''(\xi)
\end{align*}
$$

We determine \( a \), \( b \) and \( c \) such that \( y'_j \) becomes as accurate as possible. Then we get,
$$
\begin{align}
a+b+c=0 \nonumber\\ 
(b+2c)\cdot h=1
\label{eq:1208b}\\ 
\frac{b}{2}+2c=0\nonumber
\end{align}
$$

The solution of \eqref{eq:1208b} is
$$
\begin{equation*}
a=-\frac{3}{2h},\ b=\frac{2}{h},\ c=-\frac{1}{2h}\ 
\end{equation*}
$$

which inserted in \eqref{eq:1208a} gives
$$
\begin{equation}
\label{eq:1209}
y'_j=\frac{-3y_j+4y_{j+1}-y_{j+2}}{2h}+\frac{h^2}{3}y'''(\xi)
\end{equation}
$$

The error term \( O(h^m)=\frac{h^2}{3}y'''(\xi) \) shows that \( m=2 \).

<p>
Here follows some difference formulas derived with the procedure above:

<p>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">
Forward differences:
$$
\begin{align*}
\dfrac{dy_i}{dx}&=\dfrac{y_{i}-y_{i-1}}{\Delta x}+\dfrac{1}{2}y''(\xi)\Delta x \\ 
\dfrac{dy_i}{dx}&=\dfrac{3y_i-4y_{i-1}+y_{i-2}}{2\Delta x}+\dfrac{1}{3}y'''(\xi)\cdot (\Delta x)^2 \\ 
\dfrac{dy_i}{dx}&=\dfrac{11y_i-18y_{i-1}+9y_{i-2}-y_{i-3}}{6\Delta x}+\dfrac{1}{4}y^{(4)}(\xi)\cdot (\Delta x)^3 \\ 
\dfrac{d^2y_i}{dx^2}&=\dfrac{y_i-2y_{i-1}+y_{i-2}}{(\Delta x)^2}+y'''(\xi)\cdot \Delta x \\ 
\dfrac{d^2y_i}{dx^2}&=\dfrac{2y_i-5y_{i-1}+4y_{i-2}-y_{i-3}}{(\Delta x)^2}+\dfrac{11}{12}y^{(4)}(\xi)\cdot (\Delta x)^2
\end{align*}
$$
</div>
<!-- end box -->


<p>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">
Backward differences:
$$
\begin{align*}
\dfrac{dy_i}{dx}&=\dfrac{y_{i}-y_{i-1}}{\Delta x}+\dfrac{1}{2}y''(\xi)\Delta x \\ 
\dfrac{dy_i}{dx}&=\dfrac{3y_i-4y_{i-1}+y_{i-2}}{2\Delta x}+\dfrac{1}{3}y'''(\xi)\cdot (\Delta x)^2 \\ 
\dfrac{dy_i}{dx}&=\dfrac{11y_i-18y_{i-1}+9y_{i-2}-y_{i-3}}{6\Delta x}+\dfrac{1}{4}y^{(4)}(\xi)\cdot (\Delta x)^3 \\ 
\dfrac{d^2y_i}{dx^2}&=\dfrac{y_i-2y_{i-1}+y_{i-2}}{(\Delta x)^2}+y'''(\xi)\cdot \Delta x \\ 
\dfrac{d^2y_i}{dx^2}&=\dfrac{2y_i-5y_{i-1}+4y_{i-2}-y_{i-3}}{(\Delta x)^2}+\dfrac{11}{12}y^{(4)}(\xi)\cdot (\Delta x)^2
\end{align*}
$$
</div>
<!-- end box -->


<p>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">
Central differences:
$$
\begin{align*}
\dfrac{dy_i}{dx}&=\dfrac{y_{i+1}-y_{i-1}}{2\Delta x}-\dfrac{1}{6}y'''(\xi)(\Delta x)^2 \\ 
\dfrac{dy_i}{dx}&=\dfrac{-y_{i+2}+8y_{i+1}-8y_{i-1}+y_{i-2}}{12\Delta x}+\dfrac{1}{30}y^{(5)}(\xi)\cdot (\Delta x)^4 \\ 
\dfrac{d^2y_i}{dx^2}&=\dfrac{y_{i+1}-2y_{i}+y_{i-1}}{(\Delta x)^2}-\dfrac{1}{12}y^{(4)}(\xi)\cdot (\Delta x)^2 \\ 
\dfrac{d^2y_i}{dx^2}&=\dfrac{-y_{i+2}+16y_{i+1}-30y_{i}+16y_{i-1}-y_{i-2}}{12(\Delta x)^2}+\dfrac{1}{90}y^{(6)}(\xi)\cdot (\Delta x)^4 \\ 
\dfrac{d^3y_i}{dx^3}&=\dfrac{y_{i+2}-2y_{i+1}+2y_{i-1}-y_{i-2}}{2(\Delta x)^3}+\dfrac{1}{4}y^{(5)}(\xi)\cdot (\Delta x)^2
\end{align*}
$$
</div>
<!-- end box -->


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h3 id="___sec14">Treatment of the term \( \frac{d}{dx} \left[ p(x) \frac{d}{dx} u(x)\right] \) </h3>

This term often appears in difference equations, and it may be clever to treat the term as it is instead of first execute the differentiation.

<p>
<b>Central differences</b>
We use central differences (recall Figure <a href="#fig:1.5">1</a>) as follows,
$$
\begin{align*}
\frac{d}{dx}\left[p(x)\cdot \frac{d}{dx}u(x)\right]\bigg|_i \approx& \frac{[p(x)\cdot u'(x)]|_{i+\frac{1}{2}}-[p(x)\cdot u'(x)]|_{i-\frac{1}{2}}}{h}\\ 
=& \frac{p(x_{i+\frac{1}{2}})\cdot u'(x_{i+\frac{1}{2}})-p(x_{i-\frac{1}{2}})\cdot u'(x_{i-\frac{1}{2}})}{h}
\end{align*}
$$

Using central differences again, we get
$$
\begin{equation*}
u'(x_{i+\frac{1}{2}}) \approx \frac{u_{i+1}-u_i}{h},\ u'(x_{i-\frac{1}{2}}) \approx \frac{u_{i}-u_{i-1}}{h},\ 
\end{equation*}
$$

which inserted in the previous equation gives the final expression
$$
\begin{equation}
\label{eq:12010a}
\frac{d}{dx}\left[p(x)\cdot \frac{d}{dx}u(x)\right]\bigg|_i \approx \frac{p_{i-\frac{1}{2}}\cdot {u_{i-1}-(p_{i+\frac{1}{2}}+p_{i-\frac{1}{2}})\cdot u_i+p_{i+\frac{1}{2}}\cdot u_{i+1}}}{h^2} + \text{error term}
\end{equation}
$$

where
$$
\begin{equation*}
\text{error term} =-\frac{h^2}{24}\cdot \frac{d}{dx} \bigg(p(x)\cdot u'''(x)+[p(x)\cdot u'(x)]''\bigg) + O(h^3)
\end{equation*}
$$

If \( p(x_{1+\frac{1}{2}}) \) and \( p(x_{1-\frac{1}{2}}) \) cannot be found directly, we use
$$
\begin{equation}
\label{eq:12011}
p(x_{1+\frac{1}{2}})\approx \frac{1}{2}(p_{i+1}+p_i),\ p(x_{1-\frac{1}{2}}) \approx \frac{1}{2}(p_i+p_{i-1})
\end{equation}
$$

Note that for \( p(x)=1=\text{constant} \) we get the usual expression
$$
\begin{equation*}
\frac{d^2u}{dx^2}\bigg|_i=\frac{u_{i+1}-2u_i+u_{i-1}}{h^2}+O(h^2)
\end{equation*}
$$

<b>Forward differences</b>
We start with
$$
\begin{align*}
\frac{d}{dx}\left[p(x)\cdot \frac{du}{dx}\right]\bigg|_i &\approx \frac{p(x_{i+\frac{1}{2}})\cdot u'(x_{i+\frac{1}{2}})-p(x_i)\cdot u'(x_i)}{\frac{h}{2}}\\ 
 &\approx \frac{p(x_{i+\frac{1}{2}})\cdot\left( \frac{u_{i+1}-u_i}{h}\right) -p(x_i)\cdot u'(x_i)}{\frac{h}{2}}
\end{align*}
$$

which gives
$$
\begin{equation}
\label{eq:12012a}
\frac{d}{dx}\left[p(x)\cdot \frac{du}{dx}\right]\bigg|_i = \frac{2\cdot [p(x_{i+\frac{1}{2}})\cdot {(u_{i+1}-u_i)-h\cdot p(x_i)\cdot u'(x_i)]}}{h^2} +\text{error term}
\end{equation}
$$

where
$$
\begin{equation}
\label{eq:12012b}
\text{error term} =- \frac{h}{12}[3p''(x_i)\cdot u'(x_i)+6p'(x_i)\cdot u''(x_i)+4p(x_i)\cdot u'''(x_i)]+O(h^2)
\end{equation}
$$

We have kept the term \( u'(x_i) \) since \eqref{eq:12012a} usually is used at the boundary, and \( u'(x_i) \) may be prescribed there.
For \( p(x)=1=\text{constant} \) we get the expression
$$
\begin{equation}
\label{eq:12013}
u''_i = \frac{2\cdot [u_{i+1}-u_i-h\cdot u'(x_i)]}{h^2}-\frac{h}{3}u'''(x_i)+O(h^2)
\end{equation}
$$


<p>
<b>Backward Differences</b>
We start with
$$
\begin{align*}
\frac{d}{dx}\left[p(x)\frac{du}{dx}\right]\bigg|_i \approx& \frac{p(x_i)\cdot u'(x_i)-p(x_i)\cdot u'(x_{i-\frac{1}{2}})\cdot u'(x_{i-\frac{1}{2}})}{\frac{h}{2}}\\ \approx& \frac{p(x_i)\cdot u'(x_i)-p(x_{i-\frac{1}{2}})\left(\frac{u_i-u_{i-1}}{h}\right)}{\frac{h}{2}}
\end{align*}
$$

which gives
$$
\begin{equation}
\label{eq:12014a}
\frac{d}{dx}\left[p(x)\frac{du}{dx}\right]\bigg|_i = \frac{2\cdot [h\cdot p(x_i)u'(x_i)-p(x_{i-\frac{1}{2}})\cdot (u_i-u_{i-1})]}{h^2}+\text{error term}
\end{equation}
$$

where
$$
\begin{equation}
\label{eq:12014b}
\text{error term}=\frac{h}{12}[3p''(x_i)\cdot u'(x_i)+6p'(x_i)\cdot u''(x_i)+4p(x_i)\cdot u'''(x_i)]+O(h^2)
\end{equation}
$$

This is the same error term as in \eqref{eq:12012b} except from the sign. Also here we have kept the term \( u'(x_i) \) since \eqref{eq:12014b} usually is used at the boundary where \( u'(x_i) \) may be prescribed.
For \( p(x)=1=\text{constant} \) we get the expression
$$
\begin{equation}
u''_i = \frac{2\cdot [h\cdot u'(x_i)-(u_i-u_{i-1})]}{h^2}+\frac{h}{3}u'''(x_i)+O(h^2)
\end{equation}
$$


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec15">Euler's method </h2>

<p>
The ODE is given as
$$
\begin{align}
\label{eq:1301}
\frac{dy}{dx} = y'(x)&=f(x,y)\\ 
y(x_0)=&y_0
\end{align}
$$

Inserting \eqref{eq:1204a} we obtain
$$
\begin{equation*}
y(x_{n+1})=y(x_n)+h\cdot f(x_n,y(x_n))+O(h^2)
\end{equation*}
$$

or
$$
\begin{equation}
\label{eq:1302}
y_{n+1}=y_n+h\cdot f(x_n,y_n)
\end{equation}
$$

\eqref{eq:1302} is a difference equation and the scheme is called <b>Euler's method</b> (1768). The scheme is illustrated graphically in Figure <a href="#fig:1.7">2</a>. Euler's method is a first order method, since the expression for \( y'(x) \) is first order of \( h \). The method has a global error of order \( h \), and a local of order \( h^2 \).

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 2:  Graphical illustration of Euler's method. <div id="fig:1.7"></div> </p></center>
<p><img src="chapter1/7.png" align="bottom" width=400></p>
</center>

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">

<h2 id="ex:falling_sphere">Example: Falling sphere with constant and varying drag</h2>

<p>
We write \eqref{eq:sphere_1st_order} and \eqref{eq:sphere_second_order} as a system as follows,
$$
\begin{align}
& \frac{dz}{dt}=v \label{eq:1303a}\\ 
& \frac{dv}{dt}=g-\alpha v^2 \label{eq:1303b}
\end{align}
$$

where
$$
\begin{equation*}
\alpha =\frac{3\rho _f}{4\rho _k\cdot d}\cdot C_D
\end{equation*}
$$

The analytical solution with \( z(0)=0 \) and \( v(0)=0 \) is given by
$$
\begin{equation} \label{eq:1304a}
v(t)=\sqrt{\frac{g}{\alpha}}\cdot \tanh (\sqrt{\alpha g}\cdot t), \ z(t)=\frac{\ln(\cosh(\sqrt{\alpha g}\cdot t)}{\alpha}
\end{equation}
$$

The terminal velocity \( v_t \) is found by \( \frac{dv}{dt}=0 \) which gives \( v_t=\sqrt{\frac{g}{\alpha}} \).

<p>
We use data from a golf ball: \( d= 41\text{ mm} \), \( \rho_k = 1275 \text{ kg/m}^3 \), \( \rho_k = 1.22 \text{ kg/m}^3 \), and choose \( C_D = 0.4 \) which gives \( \alpha = 7\cdot 10^{-3} \). The terminal velocity then becomes
$$
\begin{equation*}
v_t = \sqrt{\frac{g}{\alpha}} = 37.44
\end{equation*}
$$


<p>
With Taylor's method  we get the following expression by using four terms in the series expansion:
$$
\begin{align}
\label{eq:1305}
z(t)=&\frac{1}{2}gt^2\cdot (1-\frac{1}{6}\alpha gt^2)\\ 
v(t)=&g t\cdot (1-\frac{1}{3}\alpha gt^2)
\end{align}
$$


<p>
The Euler scheme \eqref{eq:1302} used on \eqref{eq:1303b} gives
$$
\begin{equation}
\label{eq:1306}
v_{n+1}=v_n+\Delta t\cdot (g-\alpha\cdot v^2_n),\ n=0,1,\dots
\end{equation}
$$

with \( v(0)=0 \).

<p>
One way of implementing the integration scheme is given in the following function <code>euler()</code>:
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">euler</span>(func,z0, time):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;The Euler scheme for solution of systems of ODEs. </span>
<span style="color: #BA2121; font-style: italic">    z0 is a vector for the initial conditions, </span>
<span style="color: #BA2121; font-style: italic">    the right hand side of the system is represented by func which returns </span>
<span style="color: #BA2121; font-style: italic">    a vector with the same size as z0 .&quot;&quot;&quot;</span>
    
    z <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros((np<span style="color: #666666">.</span>size(time),np<span style="color: #666666">.</span>size(z0)))
    z[<span style="color: #666666">0</span>,:] <span style="color: #666666">=</span> z0

    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(time)<span style="color: #666666">-1</span>):
        dt <span style="color: #666666">=</span> time[i<span style="color: #666666">+1</span>]<span style="color: #666666">-</span>time[i]
        z[i<span style="color: #666666">+1</span>,:]<span style="color: #666666">=</span>z[i,:] <span style="color: #666666">+</span> np<span style="color: #666666">.</span>asarray(func(z[i,:],time[i]))<span style="color: #666666">*</span>dt

    <span style="color: #008000; font-weight: bold">return</span> z
</pre></div>
<p>
The program <b>FallingSphereEuler.py</b> (may be downloaded <a href="https://lrhgit.github.io/tkt4140/allfiles/digital_compendium/chapter1/programs_and_modules/FallingSphereEuler.py" target="_blank">here</a>) computes the solution for the first 10 seconds, using a time step of \( \Delta t=0.5 \) s, and generates the plot in Figure <a href="#fig:faling_sphere_euler">3</a>. In addition to the case of constant drag coefficient, a solution for the case of varying \( C_D \) is included. To find \( C_D \) as function of velocity we use the function <code>cd_sphere()</code> that we implemented in <a href="#example:sphere_freefall">Example: Sphere in free fall</a>. The complete program is as follows,

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># chapter1/programs_and_modules/FallingSphereEuler.py;DragCoefficientGeneric.py @ git@lrhgit/tkt4140/allfiles/digital_compendium/chapter1/programs_and_modules/DragCoefficientGeneric.py;</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">DragCoefficientGeneric</span> <span style="color: #008000; font-weight: bold">import</span> cd_sphere    
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

<span style="color: #408080; font-style: italic"># change some default values to make plots more readable </span>
LNWDT<span style="color: #666666">=5</span>; FNT<span style="color: #666666">=11</span>
rcParams[<span style="color: #BA2121">&#39;lines.linewidth&#39;</span>] <span style="color: #666666">=</span> LNWDT; rcParams[<span style="color: #BA2121">&#39;font.size&#39;</span>] <span style="color: #666666">=</span> FNT


g <span style="color: #666666">=</span> <span style="color: #666666">9.81</span>      <span style="color: #408080; font-style: italic"># Gravity m/s^2</span>
d <span style="color: #666666">=</span> <span style="color: #666666">41.0e-3</span>   <span style="color: #408080; font-style: italic"># Diameter of the sphere</span>
rho_f <span style="color: #666666">=</span> <span style="color: #666666">1.22</span>  <span style="color: #408080; font-style: italic"># Density of fluid [kg/m^3]</span>
rho_s <span style="color: #666666">=</span> <span style="color: #666666">1275</span>  <span style="color: #408080; font-style: italic"># Density of sphere [kg/m^3]</span>
nu <span style="color: #666666">=</span> <span style="color: #666666">1.5e-5</span>   <span style="color: #408080; font-style: italic"># Kinematical viscosity [m^2/s]</span>
CD <span style="color: #666666">=</span> <span style="color: #666666">0.4</span>      <span style="color: #408080; font-style: italic"># Constant drag coefficient</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;2x2 system for sphere with constant drag.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    alpha <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)<span style="color: #666666">*</span>CD
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">1</span>], g <span style="color: #666666">-</span> alpha<span style="color: #666666">*</span>z[<span style="color: #666666">1</span>]<span style="color: #666666">**2</span>]
    <span style="color: #008000; font-weight: bold">return</span> zout 

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f2</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;2x2 system for sphere with Re-dependent drag.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    v <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(z[<span style="color: #666666">1</span>]) 
    Re <span style="color: #666666">=</span> v<span style="color: #666666">*</span>d<span style="color: #666666">/</span>nu
    CD <span style="color: #666666">=</span> cd_sphere(Re)
    alpha <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)<span style="color: #666666">*</span>CD
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">1</span>], g <span style="color: #666666">-</span> alpha<span style="color: #666666">*</span>z[<span style="color: #666666">1</span>]<span style="color: #666666">**2</span>]
    <span style="color: #008000; font-weight: bold">return</span> zout

<span style="color: #408080; font-style: italic"># define euler scheme</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">euler</span>(func,z0, time):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;The Euler scheme for solution of systems of ODEs. </span>
<span style="color: #BA2121; font-style: italic">    z0 is a vector for the initial conditions, </span>
<span style="color: #BA2121; font-style: italic">    the right hand side of the system is represented by func which returns </span>
<span style="color: #BA2121; font-style: italic">    a vector with the same size as z0 .&quot;&quot;&quot;</span>
    
    z <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros((np<span style="color: #666666">.</span>size(time),np<span style="color: #666666">.</span>size(z0)))
    z[<span style="color: #666666">0</span>,:] <span style="color: #666666">=</span> z0

    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #008000">len</span>(time)<span style="color: #666666">-1</span>):
        dt <span style="color: #666666">=</span> time[i<span style="color: #666666">+1</span>]<span style="color: #666666">-</span>time[i]
        z[i<span style="color: #666666">+1</span>,:]<span style="color: #666666">=</span>z[i,:] <span style="color: #666666">+</span> np<span style="color: #666666">.</span>asarray(func(z[i,:],time[i]))<span style="color: #666666">*</span>dt

    <span style="color: #008000; font-weight: bold">return</span> z

<span style="color: #408080; font-style: italic"># main program starts here</span>

T <span style="color: #666666">=</span> <span style="color: #666666">10</span>  <span style="color: #408080; font-style: italic"># end of simulation</span>
N <span style="color: #666666">=</span> <span style="color: #666666">20</span>  <span style="color: #408080; font-style: italic"># no of time steps</span>
time <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, T, N<span style="color: #666666">+1</span>)

z0<span style="color: #666666">=</span>np<span style="color: #666666">.</span>zeros(<span style="color: #666666">2</span>)
z0[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">2.0</span>

ze <span style="color: #666666">=</span> euler(f, z0, time)     <span style="color: #408080; font-style: italic"># compute response with constant CD using Euler&#39;s method</span>
ze2 <span style="color: #666666">=</span> euler(f2, z0, time)   <span style="color: #408080; font-style: italic"># compute response with varying CD using Euler&#39;s method</span>

k1 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(g<span style="color: #666666">*4*</span>rho_s<span style="color: #666666">*</span>d<span style="color: #666666">/</span>(<span style="color: #666666">3*</span>rho_f<span style="color: #666666">*</span>CD))
k2 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(<span style="color: #666666">3*</span>rho_f<span style="color: #666666">*</span>g<span style="color: #666666">*</span>CD<span style="color: #666666">/</span>(<span style="color: #666666">4*</span>rho_s<span style="color: #666666">*</span>d))
v_a <span style="color: #666666">=</span> k1<span style="color: #666666">*</span>np<span style="color: #666666">.</span>tanh(k2<span style="color: #666666">*</span>time)   <span style="color: #408080; font-style: italic"># compute response with constant CD using analytical solution</span>

<span style="color: #408080; font-style: italic"># plotting</span>

legends<span style="color: #666666">=</span>[]
line_type<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;-&#39;</span>,<span style="color: #BA2121">&#39;:&#39;</span>,<span style="color: #BA2121">&#39;.&#39;</span>,<span style="color: #BA2121">&#39;-.&#39;</span>,<span style="color: #BA2121">&#39;--&#39;</span>]

plot(time, v_a, line_type[<span style="color: #666666">0</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Analytical (constant CD)&#39;</span>)

plot(time, ze[:,<span style="color: #666666">1</span>], line_type[<span style="color: #666666">1</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Euler (constant CD)&#39;</span>)

plot(time, ze2[:,<span style="color: #666666">1</span>], line_type[<span style="color: #666666">3</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Euler (varying CD)&#39;</span>)

legend(legends, loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;best&#39;</span>, frameon<span style="color: #666666">=</span><span style="color: #008000">False</span>)
font <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;size&#39;</span> : <span style="color: #666666">16</span>}
rc(<span style="color: #BA2121">&#39;font&#39;</span>, <span style="color: #666666">**</span>font)
xlabel(<span style="color: #BA2121">&#39;Time [s]&#39;</span>)
ylabel(<span style="color: #BA2121">&#39;Velocity [m/s]&#39;</span>)
savefig(<span style="color: #BA2121">&#39;example_sphere_falling_euler.png&#39;</span>, transparent<span style="color: #666666">=</span><span style="color: #008000">True</span>)
show()
</pre></div>
<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 3:  Euler's method with \( \Delta t=0.5 \) s. <div id="fig:faling_sphere_euler"></div> </p></center>
<p><img src="chapter1/programs_and_modules/example_sphere_falling_euler.png" align="bottom" width=400></p>
</center>

<p>
</div>
<!-- end box -->


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h3 id="___sec17">Euler's method for a system </h3>

Euler's method may of course also be used for a system. Let's look at a simultaneous system of \( p \) equations
$$
\begin{align}
&y'_1=f_1(x,y_1,y_2,\dots y_p) \nonumber\\ 
&y'_2=f_2(x,y_1,y_2,\dots y_p) \nonumber\\ 
&. \label{eq:1307a}\\ 
&.\nonumber\\ 
&y'_p=f_p(x,y_1,y_2,\dots y_p)\nonumber
\end{align}
$$

with initial values
$$
\begin{equation}
\label{eq:1307b}
y_1(x_0)=a_1,\ y_2(x_0)=a_2,\dots,\ y_p(x_0)=a_p
\end{equation}
$$

Or, in vectorial format as follows,
$$
\begin{align}
\label{eq:1308}
\mathbf{y'}&=\mathbf{f}(x,\mathbf{y})\\ 
\mathbf{y}&(x_0)=\mathbf{a} \nonumber
\end{align}
$$

where \( \mathbf{y'} \), \( \mathbf{f} \), \( \mathbf{y} \) and \( \mathbf{a} \) are column vectors with \( p \) components.

<p>
The Euler scheme \eqref{eq:1302} used on \eqref{eq:1308} gives
$$
\begin{equation}
\label{eq:1309}
\mathbf{y_{n+1}}=\mathbf{y_n}+h\cdot \mathbf{f}(x_n,\mathbf{y_n})
\end{equation}
$$

For a system of three equations we get
$$
\begin{align}
y'_1=&y_2\nonumber\\ 
y'_2=&y_3
\label{eq:13010}\\ 
y'_3=&-y_1y_3\nonumber
\end{align}
$$

In this case \eqref{eq:1309} gives
$$
\begin{align}
&(y_1)_{n+1}=(y_1)_n+h\cdot (y_2)_n\nonumber\\ 
&(y_2)_{n+1}=(y_2)_n+h\cdot (y_3)_n
\label{eq:13011}\\ 
&(y_3)_{n+1}=(y_3)_n-h\cdot (y_1)_n\cdot (y_3)_n\nonumber\\ 
\end{align}
$$

with \( y_1(x_0)=a_1,\ y_2(x_0)=a_2,\text{ and }y_3(x_0)=a_3 \)

<p>
A higher order ODE can be reduced to a set of first order ODEs. In \eqref{eq:1303a} and \eqref{eq:1303b} we have the equation \( \frac{d^2z}{dt^2}=g-\alpha\cdot \left(\frac{dz}{dt}\right)^2 \) which we have reduced to a system as
$$
\begin{align*}
\frac{dz}{dt}= v&\\ 
\frac{dv}{dt}= g&-\alpha\cdot v^2
\end{align*}
$$

which gives an Euler scheme as follows,
$$
\begin{align*}
&z_{n+1}=z_n+\Delta t\cdot v_n\\ 
&v_{n+1}=n_n+\Delta t\cdot [g-\alpha(v_n)^2]\\ 
&\text{med }z_0=0,\ v_0=0
\end{align*}
$$


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec18">Heun's method </h2>

<p>
From \eqref{eq:1204a} or \eqref{eq:1205a} we have
$$
\begin{equation}
\label{eq:1401}
y''(x_n,y_n)=f'\left(x_n,y(x_n,y_n)\right)\approx \frac{f(x_n+h)-f(x_n)}{h}
\end{equation}
$$

The Taylor series expansion \eqref{eq:1203a} gives
$$
\begin{equation*}
y(x_n+h)=y(x_n)+hy'[x_n,y(x_n)]+\frac{h^2}{2}y''[x_n,y(x_n)]+O(h^3)
\end{equation*}
$$

which, inserting \eqref{eq:1401}, gives
$$
\begin{equation}
\label{eq:1402}
y_{n+1}=y_n+\frac{h}{2}\cdot [f(x_n,y_n)+f(x_{n+1},y(x_{n+1}))]
\end{equation}
$$


<p>
This formula is called the trapezoidal formula, since it reduces to computing an integral with the trapezoidal rule if \( f(x,y) \) is only a function of \( x \). Since \( y_{n+1} \) appears on both sides of the equation, this is an implicit formula which means that we need to solve a system of non-linear algebraic equations if the function \( f(x,y) \) is non-linear. One way of making the scheme explicit is to use the Euler scheme \eqref{eq:1302} to calculate \( y(x_{n+1}) \) on the right side of \eqref{eq:1402}. The resulting scheme is often denoted <b>Heun's method</b>.

<p>
The scheme for Heun's method becomes
$$
\begin{align}
&y^p_{n+1}=y_n+h\cdot f(x_n,y_n)
\label{eq:1403a} \\ 
&y_{n +1}=y_n+\frac{h}{2}\cdot[f(x_n,y_n)+f(x_{n+1},y^p_{n+1})]
\label{eq:1403b}
\end{align}
$$

Index \( p \) stands for "predicted". \eqref{eq:1403a} is then the predictor and \eqref{eq:1403b} is the corrector. This is a second order method. For more details, see <a href="#cheney2012numerical">[1]</a>. Figure <a href="#fig:illustration_heun">4</a> is a graphical illustration of the method.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 4:  Illustration of Heun's method. <div id="fig:illustration_heun"></div> </p></center>
<p><img src="chapter1/9.png" align="bottom" width=400></p>
</center>

<p>
In principle we could make an iteration procedure where we after using the corrector use the corrected values to correct the corrected values to make a new predictor and so on. This will likely lead to a more accurate solution of the difference scheme, but not necessarily of the differential equation. We are therefore satisfied by using the corrector once. For a system, we get
$$
\begin{align}
& \mathbf{y^p_{n+1}}=\mathbf{y_n}+h\cdot \mathbf{f}(x_n,\mathbf{y_n})
\label{eq:1404a}\\ 
& \mathbf{y_{n+1}}=\mathbf{y_n} +\frac{h}{2}\cdot [\mathbf{f}(x_n,\mathbf{y_n})+\mathbf{f}(x_{n+1},\mathbf{y^p_{n+1}})]
\label{eq:1404b}
\end{align}
$$

Note that \( \mathbf{y}^p_{n+1} \) is a temporary variable that is not necessary to store.

<p>
If we use \eqref{eq:1404a} and \eqref{eq:1404b} on the example in \eqref{eq:13010} we get

<p>
Predictor:
$$
\begin{align*}
(y_1)^p_{n+1}&=(y_1)_n+h\cdot (y_2)_n&\\ 
(y_2)^p_{n+1}&=(y_2)_n+h\cdot (y_3)_n&\\ 
(y_3)^p_{n+1}&=(y_3)_n-h\cdot (y_1)_n\cdot (y_3)_n
\end{align*}
$$

Corrector:
$$
\begin{align*}
(y_1)_{n+1}&=(y_1)_n+0.5h\cdot [(y_2)_n+(y_2)^p_{n+1}]&\\ 
(y_2)_{n+1}&=(y_2)_n+0.5h\cdot [(y_3)_n+(y_3)^p_{n+1}]&\\ 
(y_3)_{n+1}&=(y_3)_n-0.5h\cdot [(y_1)_n\cdot (y_3)_n+(y_1)^p_{n+1}\cdot (y_3)^p_{n+1}]
\end{align*}
$$


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">

<h2 id="___sec19">Example: Newton's equation </h2>

<p>
Let's use Heun's method to solve Newton's equation from the section ref{section:introduction},
$$
\begin{equation}
\label{eq:1405a}
y'(x)=1-3x+y+x^2+xy,\ y(0)=0
\end{equation}
$$

with analytical solution
$$
\begin{align}
y(x)=&3\sqrt{2\pi e}\cdot \exp\left(x\left(1+\frac{x}{2}\right)\right)\cdot \left[\mbox{erf}\left(\frac{\sqrt{2}}{2}(1+x)\right)-\mbox{erf}\left(\frac{\sqrt{2}}{2}\right)\right]\nonumber \\ 
	+&4\cdot \left[1-\exp\left(x\left(1+\frac{x}{2}\right)\right)\right]-x
\label{eq:1405b}
\end{align}
$$


<p>
Here we have \( f(x,y)=1-3x+y+x^2+xy = 1+x(x-3)+(1+x)y \)

<p>
The following program <b>NewtonHeun.py</b> solves this problem using Heun's method, and the resulting figure is shown in Figure <a href="#fig:newton_heun">5</a>.

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># chapter1/programs_and_modules/NewtonHeun.py</span>
<span style="color: #408080; font-style: italic"># Program Newton</span>
<span style="color: #408080; font-style: italic"># Computes the solution of Newton&#39;s 1st order equation (1671):</span>
<span style="color: #408080; font-style: italic"># dy/dx = 1-3*x + y + x^2 +x*y , y(0) = 0</span>
<span style="color: #408080; font-style: italic"># using Heun&#39;s method.</span>

<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

xend <span style="color: #666666">=</span> <span style="color: #666666">2</span>
dx <span style="color: #666666">=</span> <span style="color: #666666">0.1</span>
steps <span style="color: #666666">=</span> np<span style="color: #666666">.</span>int(np<span style="color: #666666">.</span>round(xend<span style="color: #666666">/</span>dx, <span style="color: #666666">0</span>)) <span style="color: #666666">+</span> <span style="color: #666666">1</span> 
y, x <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros((steps,<span style="color: #666666">1</span>), <span style="color: #008000">float</span>), np<span style="color: #666666">.</span>zeros((steps,<span style="color: #666666">1</span>), <span style="color: #008000">float</span>)
y[<span style="color: #666666">0</span>], x[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>, <span style="color: #666666">0.0</span>

<span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>,steps<span style="color: #666666">-1</span>):
    x[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> (n<span style="color: #666666">+1</span>)<span style="color: #666666">*</span>dx
    xn <span style="color: #666666">=</span> x[n]
    fn <span style="color: #666666">=</span> <span style="color: #666666">1</span> <span style="color: #666666">+</span> xn<span style="color: #666666">*</span>(xn<span style="color: #666666">-3</span>) <span style="color: #666666">+</span> y[n]<span style="color: #666666">*</span>(<span style="color: #666666">1+</span>xn)
    yp <span style="color: #666666">=</span> y[n] <span style="color: #666666">+</span> dx<span style="color: #666666">*</span>fn    
    xnp1 <span style="color: #666666">=</span> x[n<span style="color: #666666">+1</span>]
    fnp1 <span style="color: #666666">=</span> <span style="color: #666666">1</span> <span style="color: #666666">+</span> xnp1<span style="color: #666666">*</span>(xnp1<span style="color: #666666">-3</span>) <span style="color: #666666">+</span> yp<span style="color: #666666">*</span>(<span style="color: #666666">1+</span>xnp1)
    y[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> y[n] <span style="color: #666666">+</span> <span style="color: #666666">0.5*</span>dx<span style="color: #666666">*</span>(fn<span style="color: #666666">+</span>fnp1)

<span style="color: #408080; font-style: italic"># Analytical solution</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">scipy.special</span> <span style="color: #008000; font-weight: bold">import</span> erf
a <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(<span style="color: #666666">2</span>)<span style="color: #666666">/2</span>
t1 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>exp(x<span style="color: #666666">*</span>(<span style="color: #666666">1+</span> x<span style="color: #666666">/2</span>))
t2 <span style="color: #666666">=</span> erf((<span style="color: #666666">1+</span>x)<span style="color: #666666">*</span>a)<span style="color: #666666">-</span>erf(a)
ya <span style="color: #666666">=</span> <span style="color: #666666">3*</span>np<span style="color: #666666">.</span>sqrt(<span style="color: #666666">2*</span>np<span style="color: #666666">.</span>pi<span style="color: #666666">*</span>np<span style="color: #666666">.</span>exp(<span style="color: #666666">1</span>))<span style="color: #666666">*</span>t1<span style="color: #666666">*</span>t2 <span style="color: #666666">+</span> <span style="color: #666666">4*</span>(<span style="color: #666666">1-</span>t1)<span style="color: #666666">-</span>x

<span style="color: #408080; font-style: italic"># plotting</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pylab</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">py</span>
py<span style="color: #666666">.</span>plot(x, y, <span style="color: #BA2121">&#39;-b.&#39;</span>, x, ya, <span style="color: #BA2121">&#39;-g.&#39;</span>)
py<span style="color: #666666">.</span>xlabel(<span style="color: #BA2121">&#39;x&#39;</span>)
py<span style="color: #666666">.</span>ylabel(<span style="color: #BA2121">&#39;y&#39;</span>)
font <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;size&#39;</span> : <span style="color: #666666">16</span>}
py<span style="color: #666666">.</span>rc(<span style="color: #BA2121">&#39;font&#39;</span>, <span style="color: #666666">**</span>font)
py<span style="color: #666666">.</span>title(<span style="color: #BA2121">&#39;Solution to Newton</span><span style="color: #BB6622; font-weight: bold">\&#39;</span><span style="color: #BA2121">s equation&#39;</span>)
py<span style="color: #666666">.</span>legend([<span style="color: #BA2121">&#39;Heun&#39;</span>, <span style="color: #BA2121">&#39;Analytical&#39;</span>], loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;best&#39;</span>, frameon<span style="color: #666666">=</span><span style="color: #008000">False</span>)
py<span style="color: #666666">.</span>grid()
py<span style="color: #666666">.</span>savefig(<span style="color: #BA2121">&#39;newton_heun.png&#39;</span>, transparent<span style="color: #666666">=</span><span style="color: #008000">True</span>)
py<span style="color: #666666">.</span>show()
</pre></div>
<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 5:  Velocity of falling sphere using Euler's and Heun's methods. <div id="fig:newton_heun"></div> </p></center>
<p><img src="chapter1/programs_and_modules/newton_heun.png" align="bottom" width=400></p>
</center>

<p>
</div>
<!-- end box -->


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">

<h2 id="___sec20">Example: Falling sphere with Heun's method </h2>

<p>
Let's go back to <a href="#ex:falling_sphere">Example: Falling sphere with constant and varying drag</a>, and implement a new function <code>heun()</code> in the program <a href="https://lrhgit.github.io/tkt4140/allfiles/digital_compendium/chapter1/programs_and_modules/FallingSphereEuler.py" target="_blank">FallingSphereEuler.py</a>.

<p>
We recall the system of equations as
$$
\begin{align*}
&\frac{dz}{dt}=v\\ 
&\frac{dv}{dt}=g-\alpha v^2
\end{align*}
$$

which by use of Heun's method in \eqref{eq:1404a} and \eqref{eq:1404b} becomes

<p>
Predictor:
$$
\begin{align}
z^p_{n+1}&=z_n+\Delta t v_n \\ 
v^p_{n+1}&= v_n +\Delta t \cdot (g-\alpha v^2_n) \nonumber
\end{align}
$$

Corrector:
$$
\begin{align}
z_{n+1}&=z_n+0.5\Delta t \cdot (v_n+v^p_{n+1}) \\ 
v_{n+1}&=v_n+0.5\Delta t \cdot \left[2g-\alpha[v^2_n+(v^p_{n+1})^2\right] \nonumber
\end{align}
$$

with initial values \( z_0=z(0)=0,\ v_0=v(0)=0 \). Note that we don't use the predictor \( z^p_{n+1} \) since it doesn't appear on the right hand side of the equation system.

<p>
One possible way of implementing this scheme is given in the following function named <code>heun()</code>, in the program <b>ODEschemes.py</b>:
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">heun</span>(func, z0, time):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;The Heun scheme for solution of systems of ODEs.</span>
<span style="color: #BA2121; font-style: italic">    z0 is a vector for the initial conditions,</span>
<span style="color: #BA2121; font-style: italic">    the right hand side of the system is represented by func which returns</span>
<span style="color: #BA2121; font-style: italic">    a vector with the same size as z0 .&quot;&quot;&quot;</span>

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f_np</span>(z,t):
        <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;A local function to ensure that the return of func is an np array</span>
<span style="color: #BA2121; font-style: italic">        and to avoid lengthy code for implementation of the Heun algorithm&quot;&quot;&quot;</span>
        <span style="color: #008000; font-weight: bold">return</span> np<span style="color: #666666">.</span>asarray(func(z,t))

    z <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros((np<span style="color: #666666">.</span>size(time),np<span style="color: #666666">.</span>size(z0)))
    z[<span style="color: #666666">0</span>,:] <span style="color: #666666">=</span> z0
    zp <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z0)

    <span style="color: #008000; font-weight: bold">for</span> i, t <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">enumerate</span>(time[<span style="color: #666666">0</span>:<span style="color: #666666">-1</span>]):
        dt <span style="color: #666666">=</span> time[i<span style="color: #666666">+1</span>]<span style="color: #666666">-</span>time[i]
        zp <span style="color: #666666">=</span> z[i,:] <span style="color: #666666">+</span> f_np(z[i,:],t)<span style="color: #666666">*</span>dt   <span style="color: #408080; font-style: italic"># Predictor step</span>
        z[i<span style="color: #666666">+1</span>,:] <span style="color: #666666">=</span> z[i,:] <span style="color: #666666">+</span> (f_np(z[i,:],t) <span style="color: #666666">+</span> f_np(zp,t<span style="color: #666666">+</span>dt))<span style="color: #666666">*</span>dt<span style="color: #666666">/2.0</span> <span style="color: #408080; font-style: italic"># Corrector step</span>
</pre></div>
<p>
Using the same time steps as in <a href="#ex:falling_sphere">Example: Falling sphere with constant and varying drag</a>, we get the response plotted in Figure <a href="#fig:falling_sphere_euler_heun">6</a>.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 6:  Velocity of falling sphere using Euler's and Heun's methods. <div id="fig:falling_sphere_euler_heun"></div> </p></center>
<p><img src="chapter1/programs_and_modules/example_sphere_falling_euler_heun.png" align="bottom" width=400></p>
</center>

<p>
The complete program <b>FallingSphereEulerHeun.py</b> is listed below. Note that the solver functions <code>euler</code> and <code>heun</code> are imported from the script <b>ODEschemes.py</b>.

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># chapter1/programs_and_modules/FallingSphereEulerHeun.py;ODEschemes.py @ git@lrhgit/tkt4140/allfiles/digital_compendium/chapter1/programs_and_modules/ODEschemes.py;</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">DragCoefficientGeneric</span> <span style="color: #008000; font-weight: bold">import</span> cd_sphere
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">ODEschemes</span> <span style="color: #008000; font-weight: bold">import</span> euler, heun
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

<span style="color: #408080; font-style: italic"># change some default values to make plots more readable </span>
LNWDT<span style="color: #666666">=5</span>; FNT<span style="color: #666666">=11</span>
rcParams[<span style="color: #BA2121">&#39;lines.linewidth&#39;</span>] <span style="color: #666666">=</span> LNWDT; rcParams[<span style="color: #BA2121">&#39;font.size&#39;</span>] <span style="color: #666666">=</span> FNT

g <span style="color: #666666">=</span> <span style="color: #666666">9.81</span>      <span style="color: #408080; font-style: italic"># Gravity m/s^2</span>
d <span style="color: #666666">=</span> <span style="color: #666666">41.0e-3</span>   <span style="color: #408080; font-style: italic"># Diameter of the sphere</span>
rho_f <span style="color: #666666">=</span> <span style="color: #666666">1.22</span>  <span style="color: #408080; font-style: italic"># Density of fluid [kg/m^3]</span>
rho_s <span style="color: #666666">=</span> <span style="color: #666666">1275</span>  <span style="color: #408080; font-style: italic"># Density of sphere [kg/m^3]</span>
nu <span style="color: #666666">=</span> <span style="color: #666666">1.5e-5</span>   <span style="color: #408080; font-style: italic"># Kinematical viscosity [m^2/s]</span>
CD <span style="color: #666666">=</span> <span style="color: #666666">0.4</span>      <span style="color: #408080; font-style: italic"># Constant drag coefficient</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;2x2 system for sphere with constant drag.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    alpha <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)<span style="color: #666666">*</span>CD
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">1</span>], g <span style="color: #666666">-</span> alpha<span style="color: #666666">*</span>z[<span style="color: #666666">1</span>]<span style="color: #666666">**2</span>]
    <span style="color: #008000; font-weight: bold">return</span> zout 

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f2</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;2x2 system for sphere with Re-dependent drag.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    v <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(z[<span style="color: #666666">1</span>]) 
    Re <span style="color: #666666">=</span> v<span style="color: #666666">*</span>d<span style="color: #666666">/</span>nu
    CD <span style="color: #666666">=</span> cd_sphere(Re)
    alpha <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)<span style="color: #666666">*</span>CD
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">1</span>], g <span style="color: #666666">-</span> alpha<span style="color: #666666">*</span>z[<span style="color: #666666">1</span>]<span style="color: #666666">**2</span>]
    <span style="color: #008000; font-weight: bold">return</span> zout
        
<span style="color: #408080; font-style: italic"># main program starts here</span>

T <span style="color: #666666">=</span> <span style="color: #666666">10</span>  <span style="color: #408080; font-style: italic"># end of simulation</span>
N <span style="color: #666666">=</span> <span style="color: #666666">20</span>  <span style="color: #408080; font-style: italic"># no of time steps</span>
time <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, T, N<span style="color: #666666">+1</span>)

z0<span style="color: #666666">=</span>np<span style="color: #666666">.</span>zeros(<span style="color: #666666">2</span>)
z0[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> <span style="color: #666666">2.0</span>

ze <span style="color: #666666">=</span> euler(f, z0, time)     <span style="color: #408080; font-style: italic"># compute response with constant CD using Euler&#39;s method</span>
ze2 <span style="color: #666666">=</span> euler(f2, z0, time)   <span style="color: #408080; font-style: italic"># compute response with varying CD using Euler&#39;s method</span>

zh <span style="color: #666666">=</span> heun(f, z0, time)     <span style="color: #408080; font-style: italic"># compute response with constant CD using Heun&#39;s method</span>
zh2 <span style="color: #666666">=</span> heun(f2, z0, time)   <span style="color: #408080; font-style: italic"># compute response with varying CD using Heun&#39;s method</span>

k1 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(g<span style="color: #666666">*4*</span>rho_s<span style="color: #666666">*</span>d<span style="color: #666666">/</span>(<span style="color: #666666">3*</span>rho_f<span style="color: #666666">*</span>CD))
k2 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(<span style="color: #666666">3*</span>rho_f<span style="color: #666666">*</span>g<span style="color: #666666">*</span>CD<span style="color: #666666">/</span>(<span style="color: #666666">4*</span>rho_s<span style="color: #666666">*</span>d))
v_a <span style="color: #666666">=</span> k1<span style="color: #666666">*</span>np<span style="color: #666666">.</span>tanh(k2<span style="color: #666666">*</span>time)   <span style="color: #408080; font-style: italic"># compute response with constant CD using analytical solution</span>

<span style="color: #408080; font-style: italic"># plotting</span>

legends<span style="color: #666666">=</span>[]
line_type<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;-&#39;</span>,<span style="color: #BA2121">&#39;:&#39;</span>,<span style="color: #BA2121">&#39;.&#39;</span>,<span style="color: #BA2121">&#39;-.&#39;</span>,<span style="color: #BA2121">&#39;--&#39;</span>]

plot(time, v_a, line_type[<span style="color: #666666">0</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Analytical (constant CD)&#39;</span>)

plot(time, ze[:,<span style="color: #666666">1</span>], line_type[<span style="color: #666666">1</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Euler (constant CD)&#39;</span>)

plot(time, zh[:,<span style="color: #666666">1</span>], line_type[<span style="color: #666666">2</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Heun (constant CD)&#39;</span>)

plot(time, ze2[:,<span style="color: #666666">1</span>], line_type[<span style="color: #666666">3</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Euler (varying CD)&#39;</span>)

plot(time, zh2[:,<span style="color: #666666">1</span>], line_type[<span style="color: #666666">4</span>])
legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;Heun (varying CD)&#39;</span>)

legend(legends, loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;best&#39;</span>, frameon<span style="color: #666666">=</span><span style="color: #008000">False</span>)
font <span style="color: #666666">=</span> {<span style="color: #BA2121">&#39;size&#39;</span> : <span style="color: #666666">16</span>}
rc(<span style="color: #BA2121">&#39;font&#39;</span>, <span style="color: #666666">**</span>font)
xlabel(<span style="color: #BA2121">&#39;Time [s]&#39;</span>)
ylabel(<span style="color: #BA2121">&#39;Velocity [m/s]&#39;</span>)
savefig(<span style="color: #BA2121">&#39;example_sphere_falling_euler_heun.png&#39;</span>, transparent<span style="color: #666666">=</span><span style="color: #008000">True</span>)
show()
</pre></div>
<p>
</div>
<!-- end box -->


<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<h2 id="___sec21">Runge-Kutta of 4th order </h2>

<p>
Euler's method and Heun's method belong to the Runge-Kutta family of explicit methods, and is respectively Runge-Kutta of 1st and 2nd order, the latter with one time use of corrector. Explicit Runge-Kutta schemes are single step schemes that try to copy the Taylor series expansion of the differential equation to a given order.

<p>
The classical Runge-Kutta scheme of 4th order (RK4) is given by
$$
\begin{align}
&k_1=f(x_n,y_n)\nonumber\\ 
&k_2=f(x_n+\frac{h}{2}, y_n+\frac{h}{2}k_1)\nonumber\\ 
\label{eq:1501}
&k_3=f(x_n+\frac{h}{2},y_n+\frac{h}{2}k_2)\\ 
&k_4=f(x_n+h,y_n+hk_3)\nonumber\\ 
&y_{n+1}=y_n+\frac{h}{6}(k_1+2k_2+2k_3+k_4)\nonumber
\end{align}
$$


<p>
We see that we are actually using Euler's method four times and find a weighted gradient. The local error is of order \( O(h^5) \), while the global is of \( O(h^4) \). We refer to <a href="#cheney2012numerical">[1]</a>.

<p>
Figure <a href="#fig:RK4_illustration">7</a> shows a graphical illustration of the RK4 scheme.

<p>
In detail we have

<ol>
 <li> In point \( (x_n,y_n) \) we know the gradient \( k_1 \) and use this when we go forward a step \( h/2 \) where the gradient \( k_2 \) is calculated.</li>
 <li> With this gradient we start again in point \( (x_n,y_n) \), go forward a step \( h/2 \) and find a new gradient \( k_3 \).</li>
 <li> With this gradient we start again in point \( (x_n,y_n) \), but go forward a complete step \( h \) and find a new gradient \( k_4 \).</li>
 <li> The four gradients are averaged with weights \( 1/6 \), \( 2/6 \), \( 2/6 \) and \( 1/6 \). Using the averaged gradient we calculate the final value \( y_{n+1} \).</li>
</ol>

Each of the steps above are Euler steps.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 7:  Illustration of the RK4 scheme. <div id="fig:RK4_illustration"></div> </p></center>
<p><img src="chapter1/12.png" align="bottom" width=400></p>
</center>

<p>
Using \eqref{eq:1501} on the equation system in \eqref{eq:13010} we get
$$
\begin{align}
&(y_1)_{n+1}=(y_1)_n +\frac{h}{6}(k_1+2k_2+2k_3+k_4) \nonumber\\ 
&(y_2)_{n+1}=(y_2)_n +\frac{h}{6}(l_1+2l_2+2l_3+l_4)
\label{eq:1502} \\ 
&(y_3)_{n+1}=(y_3)_n +\frac{h}{6}(m_1+2m_2+2m_3+m_4) \nonumber\\ 
\end{align}
$$

where
$$
\begin{align*}
k_1&=y_2 \\ 
l_1&=y_3 \\ 
m_1&=-y_1y_3\\ 
\\ 
k_2&=(y_2+hl_l/2)\\ 
l_2&=(y_3+hm_1/2)\\ 
m_2&=-[(y_1+hk_1/2)(y_3+hm_1/2)]\\ 
\\ 
k_3&=(y_2+hl_2/2)\\ 
l_3&=(y_3+hm_2/2)\\ 
m_3&=-[(y_1+hk_2/2)(y_3+hm_2/2)]\\ 
\\ 
k_4&=(y_2+hl_3)\\ 
l_4&=(y_3+hm_3)\\ 
m_4&=-[(y_1+hk_3)(y_3+hm_3)
\end{align*}
$$


<p>
<!-- left out for exercise -->

<p>
<!-- !split --><br><br><br><br><br><br><br><br>

<!-- begin box -->
<div style="width: 95%; padding: 10px; border: 1px solid #000; border-radius: 4px;">

<h2 id="___sec22">Example: Particle motion in two dimensions </h2>
In this example we will calculate the motion of a particle in two dimensions. First we will calculate the motion of a smooth ball with drag coefficient given by the previously defined function <code>cd_sphere()</code> (see <a href="#example:sphere_freefall">Example: Sphere in free fall</a>), and then of a golf ball with drag and lift.

<p>
The problem is illustrated in the following figure:
<center><p><img src="chapter1/14.png" align="bottom" width=400></p></center>

<p>
where \( v \) is the absolute velocity, \( v_f= \) is the velocity of the fluid, \( v_r=v-v_f \) is the relative velocity between the fluid and the ball, \( \alpha \) is the elevation angle, \( v_0 \) is the initial velocity and \( \phi \) is the angle between the \( x \)-axis and \( v_r \).

<p>
\( \mathbf{F}_l \) is the lift force stemming from the rotation of the ball (the Magnus-effect) and is normal to \( v_r \). With the given direction the ball rotates counter-clockwise (backspin). \( \mathbf{F}_d \) is the fluids resistance against the motion and is parallel to \( v_r \). These forces are given by
$$
\begin{align}
\mathbf{F}_d=\frac{1}{2}\rho _f AC_Dv_r^2
\label{eq:1504a}\\ 
\mathbf{F}_l=\frac{1}{2}\rho _f AC_Lv_r^2
\label{eq:150b}
\end{align}
$$


<p>
\( C_D \) is the drag coefficient, \( C_L \) is the lift coefficient, \( A \) is the area projected in the velocity direction and \( \rho_F \) is the density of the fluid.

<p>
Newton's law in \( x \)- and \( y \)-directions gives
$$
\begin{align}
\label{eq:1505a}
\frac{dv_x}{dt}&= -\rho _f\frac{A}{2m}v_r^2(C_D\cdot \cos(\phi)+C_L\sin(\phi)) \\ 
\frac{dv_y}{dt}&=\rho _f\frac{A}{2m}v_r^2(C_L\cdot \cos(\phi)-C_D\sin(\phi))-g
\label{eq:1505b}
\end{align}
$$


<p>
From the figure we have
$$
\begin{align*}
\cos (\phi)&=\frac{v_{rx}}{v_r} \\ 
\sin(\phi)&=\frac{v_{ry}}{v_r}
\end{align*}
$$


<p>
We assume that the particle is a sphere, such that \( C=\rho _f\frac{A}{2m}=\frac{3\rho_f}{4\rho_kd} \) as in <a href="#example:sphere_freefall">Example: Sphere in free fall</a>. Here \( d \) is the diameter of the sphere and \( \rho_k \) the density of the sphere.

<p>
Now \eqref{eq:1505a} and \eqref{eq:1505b} become
$$
\begin{align}
\label{eq:1506a}
\frac{dv_x}{dt} &= -C\cdot v_r(C_D\cdot v_{rx}+C_L\cdot v_{ry})\\ 
\frac{dv_y}{dt} &= C\cdot v_r(C_L\cdot v_{rx}-C_D\cdot v_{ry})-
\label{eq:1506b}g
\end{align}
$$


<p>
With \( \frac{dx}{dt}=v_x \) and \( \frac{dy}{dt}=v_y \) we get a system of 1st order equations as follows,
$$
\begin{align}
&\frac{dx}{dt}=v_x \nonumber \\ 
& \frac{dy}{dt}=v_y \nonumber\\ 
& \frac{dv_x}{dt} = -C\cdot v_r(C_D\cdot v_{rx}+C_L\cdot v_{ry})
\label{eq:1507}\\ 
&\frac{dv_y}{dt} = C\cdot v_r(C_L\cdot v_{rx}-C_D\cdot v_{ry})-g \nonumber
\end{align}
$$


<p>
Introducing the notation \( x=y_1 \), \( y=y_2 \), \( v_x=y_3 \), \( v_y=y_4 \), we get
$$
\begin{align}
&\frac{dy_1}{dt}=y_3\nonumber\\ 
& \frac{dy_2}{dt}=y_4\nonumber\\ 
& \frac{dy_3}{dt} = -C\cdot v_r(C_D\cdot v_{rx}+C_L\cdot v_{ry})
\label{eq:1508}\\ 
&\frac{dy_4}{dt} = C\cdot v_r(C_L\cdot v_{rx}-C_D\cdot v_{ry})-g\nonumber
\end{align}
$$


<p>
Here we have \( v_{rx}=v_x-v_{fx}=y_3-v_{fx},\ v_{ry}=v_y-v_{fy}=y_4-v_{fy},\\ v_r=\sqrt{v_{rx}^2+v_{ry}^2} \)

<p>
Initial conditions for \( t=0 \) are
$$
\begin{align*}
y_1&=y_2=0 \\ 
y_3&=v_0\cos(\alpha)\\ 
y_4&=v_0\sin(\alpha)
\end{align*}
$$


<p>
<hr>

<p>
Let's first look at the case of a smooth ball. We use the following data (which are the data for a golf ball):
$$
\begin{equation*}
\label{eq:1509}
\text{Diameter } d = 41 \text{mm},\text{ mass } m = 46\text{g which gives } \rho_k=\frac{6m}{\pi d^3} = 1275 \text{kg/m}^3
\end{equation*}
$$

We use the initial velocity \( v_0=50 \) m/s and solve \eqref{eq:1508} using the Runge-Kutta 4 scheme. In this example we have used the Python package <b>Odespy</b> (ODE Software in Python), which offers a large collection of functions for solving ODE's. The RK4 scheme available in Odespy is used herein.

<p>
The right hand side in \eqref{eq:1508} is implemented as the following function:
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;4x4 system for smooth sphere with drag in two directions.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    C <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)
    vrx <span style="color: #666666">=</span> z[<span style="color: #666666">2</span>] <span style="color: #666666">-</span> vfx
    vry <span style="color: #666666">=</span> z[<span style="color: #666666">3</span>] <span style="color: #666666">-</span> vfy
    vr <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(vrx<span style="color: #666666">**2</span> <span style="color: #666666">+</span> vry<span style="color: #666666">**2</span>)
    Re <span style="color: #666666">=</span> vr<span style="color: #666666">*</span>d<span style="color: #666666">/</span>nu
    CD <span style="color: #666666">=</span> cd_sphere(Re) <span style="color: #408080; font-style: italic"># using the already defined function</span>
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">2</span>], z[<span style="color: #666666">3</span>], <span style="color: #666666">-</span>C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(CD<span style="color: #666666">*</span>vrx), C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(<span style="color: #666666">-</span>CD<span style="color: #666666">*</span>vry) <span style="color: #666666">-</span> g]
</pre></div>
<p>
Note that we have used the function <code>cd_sphere()</code> defined in <a href="#example:sphere_freefall">Example: Sphere in free fall</a> to calculate the drag coefficient of the smooth sphere.

<p>
The results are shown for some initial angles in Figure <a href="#fig:smooth_ball_drag">8</a>.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 8:  Motion of smooth ball with drag. <div id="fig:smooth_ball_drag"></div> </p></center>
<p><img src="chapter1/programs_and_modules/example_particle_motion_2d_1.png" align="bottom" width=700></p>
</center>

<p>
<hr>

<p>
Now let's look at the same case for a golf ball. The dimension and weight are the same as for the sphere. Now we need to account for the lift force from the spin of the ball. In addition, the drag data for a golf ball are completely different from the smooth sphere. We use the data from Bearman and Harvey <a href="#Bearman1976112">[2]</a> who measured the drag and lift of a golf ball for different spin velocities in a vindtunnel. We choose as an example 3500 rpm, and an initial velocity of \( v_0=50 \) m/s.

<p>
The right hand side in \eqref{eq:1508} is now implemented as the following function:
<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f3</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;4x4 system for golf ball with drag and lift in two directions.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    C <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)
    vrx <span style="color: #666666">=</span> z[<span style="color: #666666">2</span>] <span style="color: #666666">-</span> vfx
    vry <span style="color: #666666">=</span> z[<span style="color: #666666">3</span>] <span style="color: #666666">-</span> vfy
    vr <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(vrx<span style="color: #666666">**2</span> <span style="color: #666666">+</span> vry<span style="color: #666666">**2</span>)
    Re <span style="color: #666666">=</span> vr<span style="color: #666666">*</span>d<span style="color: #666666">/</span>nu
    CD, CL <span style="color: #666666">=</span> cdcl(vr, nrpm)
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">2</span>], z[<span style="color: #666666">3</span>], <span style="color: #666666">-</span>C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(CD<span style="color: #666666">*</span>vrx <span style="color: #666666">+</span> CL<span style="color: #666666">*</span>vry), C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(CL<span style="color: #666666">*</span>vrx <span style="color: #666666">-</span> CD<span style="color: #666666">*</span>vry) <span style="color: #666666">-</span> g]
</pre></div>
<p>
The function <code>cdcl()</code> (may be downloaded <a href="https://lrhgit.github.io/tkt4140/allfiles/digital_compendium/chapter1/programs_and_modules/cdclgolfball.py" target="_blank">here</a>) gives the drag and lift data for a given velocity and spin.

<p>
The results are shown in Figure <a href="#fig:golf_drag_lift">9</a>. The motion of a golf ball with drag but without lift is also included. We see that the golf ball goes much farther than the smooth sphere, due to less drag and the lift.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 9:  Motion of golf ball with drag and lift. <div id="fig:golf_drag_lift"></div> </p></center>
<p><img src="chapter1/programs_and_modules/example_particle_motion_2d_2.png" align="bottom" width=700></p>
</center>

<p>
The complete program <b>ParticleMotion2D.py</b> is listed below.

<p>

<!-- code=python (!bc pypro) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic"># chapter1/programs_and_modules/ParticleMotion2D.py;DragCoefficientGeneric.py @ git@lrhgit/tkt4140/allfiles/digital_compendium/chapter1/programs_and_modules/DragCoefficientGeneric.py;cdclgolfball.py @ git@lrhgit/tkt4140/allfiles/digital_compendium/chapter1/programs_and_modules/cdclgolfball.py;</span>

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">DragCoefficientGeneric</span> <span style="color: #008000; font-weight: bold">import</span> cd_sphere
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">cdclgolfball</span> <span style="color: #008000; font-weight: bold">import</span> cdcl  
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">odespy</span>

g <span style="color: #666666">=</span> <span style="color: #666666">9.81</span>      <span style="color: #408080; font-style: italic"># Gravity [m/s^2]</span>
nu <span style="color: #666666">=</span> <span style="color: #666666">1.5e-5</span>   <span style="color: #408080; font-style: italic"># Kinematical viscosity [m^2/s]</span>
rho_f <span style="color: #666666">=</span> <span style="color: #666666">1.20</span>  <span style="color: #408080; font-style: italic"># Density of fluid [kg/m^3]</span>
rho_s <span style="color: #666666">=</span> <span style="color: #666666">1275</span>  <span style="color: #408080; font-style: italic"># Density of sphere [kg/m^3]</span>
d <span style="color: #666666">=</span> <span style="color: #666666">41.0e-3</span>   <span style="color: #408080; font-style: italic"># Diameter of the sphere [m]</span>
v0 <span style="color: #666666">=</span> <span style="color: #666666">50.0</span>     <span style="color: #408080; font-style: italic"># Initial velocity [m/s]</span>
vfx <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>     <span style="color: #408080; font-style: italic"># x-component of fluid&#39;s velocity</span>
vfy <span style="color: #666666">=</span> <span style="color: #666666">0.0</span>     <span style="color: #408080; font-style: italic"># y-component of fluid&#39;s velocity</span>

nrpm <span style="color: #666666">=</span> <span style="color: #666666">3500</span>   <span style="color: #408080; font-style: italic"># no of rpm of golf ball</span>

<span style="color: #408080; font-style: italic"># smooth ball</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;4x4 system for smooth sphere with drag in two directions.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    C <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)
    vrx <span style="color: #666666">=</span> z[<span style="color: #666666">2</span>] <span style="color: #666666">-</span> vfx
    vry <span style="color: #666666">=</span> z[<span style="color: #666666">3</span>] <span style="color: #666666">-</span> vfy
    vr <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(vrx<span style="color: #666666">**2</span> <span style="color: #666666">+</span> vry<span style="color: #666666">**2</span>)
    Re <span style="color: #666666">=</span> vr<span style="color: #666666">*</span>d<span style="color: #666666">/</span>nu
    CD <span style="color: #666666">=</span> cd_sphere(Re) <span style="color: #408080; font-style: italic"># using the already defined function</span>
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">2</span>], z[<span style="color: #666666">3</span>], <span style="color: #666666">-</span>C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(CD<span style="color: #666666">*</span>vrx), C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(<span style="color: #666666">-</span>CD<span style="color: #666666">*</span>vry) <span style="color: #666666">-</span> g]
    <span style="color: #008000; font-weight: bold">return</span> zout 

<span style="color: #408080; font-style: italic"># golf ball without lift</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f2</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;4x4 system for golf ball with drag in two directions.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    C <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)
    vrx <span style="color: #666666">=</span> z[<span style="color: #666666">2</span>] <span style="color: #666666">-</span> vfx
    vry <span style="color: #666666">=</span> z[<span style="color: #666666">3</span>] <span style="color: #666666">-</span> vfy
    vr <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(vrx<span style="color: #666666">**2</span> <span style="color: #666666">+</span> vry<span style="color: #666666">**2</span>)
    Re <span style="color: #666666">=</span> vr<span style="color: #666666">*</span>d<span style="color: #666666">/</span>nu
    CD, CL <span style="color: #666666">=</span> cdcl(vr, nrpm)
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">2</span>], z[<span style="color: #666666">3</span>], <span style="color: #666666">-</span>C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(CD<span style="color: #666666">*</span>vrx), C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(<span style="color: #666666">-</span>CD<span style="color: #666666">*</span>vry) <span style="color: #666666">-</span> g]
    <span style="color: #008000; font-weight: bold">return</span> zout 

<span style="color: #408080; font-style: italic"># golf ball with lift</span>
<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f3</span>(z, t):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;4x4 system for golf ball with drag and lift in two directions.&quot;&quot;&quot;</span>
    zout <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros_like(z)
    C <span style="color: #666666">=</span> <span style="color: #666666">3.0*</span>rho_f<span style="color: #666666">/</span>(<span style="color: #666666">4.0*</span>rho_s<span style="color: #666666">*</span>d)
    vrx <span style="color: #666666">=</span> z[<span style="color: #666666">2</span>] <span style="color: #666666">-</span> vfx
    vry <span style="color: #666666">=</span> z[<span style="color: #666666">3</span>] <span style="color: #666666">-</span> vfy
    vr <span style="color: #666666">=</span> np<span style="color: #666666">.</span>sqrt(vrx<span style="color: #666666">**2</span> <span style="color: #666666">+</span> vry<span style="color: #666666">**2</span>)
    Re <span style="color: #666666">=</span> vr<span style="color: #666666">*</span>d<span style="color: #666666">/</span>nu
    CD, CL <span style="color: #666666">=</span> cdcl(vr, nrpm)
    zout[:] <span style="color: #666666">=</span> [z[<span style="color: #666666">2</span>], z[<span style="color: #666666">3</span>], <span style="color: #666666">-</span>C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(CD<span style="color: #666666">*</span>vrx <span style="color: #666666">+</span> CL<span style="color: #666666">*</span>vry), C<span style="color: #666666">*</span>vr<span style="color: #666666">*</span>(CL<span style="color: #666666">*</span>vrx <span style="color: #666666">-</span> CD<span style="color: #666666">*</span>vry) <span style="color: #666666">-</span> g]
    <span style="color: #008000; font-weight: bold">return</span> zout 


<span style="color: #408080; font-style: italic"># main program starts here</span>

T <span style="color: #666666">=</span> <span style="color: #666666">7</span>   <span style="color: #408080; font-style: italic"># end of simulation</span>
N <span style="color: #666666">=</span> <span style="color: #666666">60</span>  <span style="color: #408080; font-style: italic"># no of time steps</span>
time <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, T, N<span style="color: #666666">+1</span>)

N2 <span style="color: #666666">=</span> <span style="color: #666666">4</span>
alfa <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">30</span>, <span style="color: #666666">15</span>, N2)   <span style="color: #408080; font-style: italic"># Angle of elevation [degrees]</span>
angle <span style="color: #666666">=</span> alfa<span style="color: #666666">*</span>np<span style="color: #666666">.</span>pi<span style="color: #666666">/180.0</span> <span style="color: #408080; font-style: italic"># convert to radians</span>

legends<span style="color: #666666">=</span>[]
line_color<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;k&#39;</span>,<span style="color: #BA2121">&#39;m&#39;</span>,<span style="color: #BA2121">&#39;b&#39;</span>,<span style="color: #BA2121">&#39;r&#39;</span>]
figure(figsize<span style="color: #666666">=</span>(<span style="color: #666666">20</span>, <span style="color: #666666">8</span>))
hold(<span style="color: #BA2121">&#39;on&#39;</span>)
LNWDT<span style="color: #666666">=4</span>; FNT<span style="color: #666666">=18</span>
rcParams[<span style="color: #BA2121">&#39;lines.linewidth&#39;</span>] <span style="color: #666666">=</span> LNWDT; rcParams[<span style="color: #BA2121">&#39;font.size&#39;</span>] <span style="color: #666666">=</span> FNT

<span style="color: #408080; font-style: italic"># computing and plotting</span>

<span style="color: #408080; font-style: italic"># smooth ball with drag</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>,N2):
    z0 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #666666">4</span>)
    z0[<span style="color: #666666">2</span>] <span style="color: #666666">=</span> v0<span style="color: #666666">*</span>np<span style="color: #666666">.</span>cos(angle[i])
    z0[<span style="color: #666666">3</span>] <span style="color: #666666">=</span> v0<span style="color: #666666">*</span>np<span style="color: #666666">.</span>sin(angle[i])
    solver <span style="color: #666666">=</span> odespy<span style="color: #666666">.</span>RK4(f)
    solver<span style="color: #666666">.</span>set_initial_condition(z0)
    z, t <span style="color: #666666">=</span> solver<span style="color: #666666">.</span>solve(time)
    plot(z[:,<span style="color: #666666">0</span>], z[:,<span style="color: #666666">1</span>], <span style="color: #BA2121">&#39;:&#39;</span>, color<span style="color: #666666">=</span>line_color[i])
    legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;angle=&#39;</span><span style="color: #666666">+</span><span style="color: #008000">str</span>(alfa[i])<span style="color: #666666">+</span><span style="color: #BA2121">&#39;, smooth ball&#39;</span>)
    
<span style="color: #408080; font-style: italic"># golf ball with drag</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>,N2):
    z0 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #666666">4</span>)
    z0[<span style="color: #666666">2</span>] <span style="color: #666666">=</span> v0<span style="color: #666666">*</span>np<span style="color: #666666">.</span>cos(angle[i])
    z0[<span style="color: #666666">3</span>] <span style="color: #666666">=</span> v0<span style="color: #666666">*</span>np<span style="color: #666666">.</span>sin(angle[i])
    solver <span style="color: #666666">=</span> odespy<span style="color: #666666">.</span>RK4(f2)
    solver<span style="color: #666666">.</span>set_initial_condition(z0)
    z, t <span style="color: #666666">=</span> solver<span style="color: #666666">.</span>solve(time)
    plot(z[:,<span style="color: #666666">0</span>], z[:,<span style="color: #666666">1</span>], <span style="color: #BA2121">&#39;-.&#39;</span>, color<span style="color: #666666">=</span>line_color[i])
    legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;angle=&#39;</span><span style="color: #666666">+</span><span style="color: #008000">str</span>(alfa[i])<span style="color: #666666">+</span><span style="color: #BA2121">&#39;, golf ball&#39;</span>)
     
<span style="color: #408080; font-style: italic"># golf ball with drag and lift</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">0</span>,N2):
    z0 <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(<span style="color: #666666">4</span>)
    z0[<span style="color: #666666">2</span>] <span style="color: #666666">=</span> v0<span style="color: #666666">*</span>np<span style="color: #666666">.</span>cos(angle[i])
    z0[<span style="color: #666666">3</span>] <span style="color: #666666">=</span> v0<span style="color: #666666">*</span>np<span style="color: #666666">.</span>sin(angle[i])
    solver <span style="color: #666666">=</span> odespy<span style="color: #666666">.</span>RK4(f3)
    solver<span style="color: #666666">.</span>set_initial_condition(z0)
    z, t <span style="color: #666666">=</span> solver<span style="color: #666666">.</span>solve(time)
    plot(z[:,<span style="color: #666666">0</span>], z[:,<span style="color: #666666">1</span>], <span style="color: #BA2121">&#39;.&#39;</span>, color<span style="color: #666666">=</span>line_color[i])
    legends<span style="color: #666666">.</span>append(<span style="color: #BA2121">&#39;angle=&#39;</span><span style="color: #666666">+</span><span style="color: #008000">str</span>(alfa[i])<span style="color: #666666">+</span><span style="color: #BA2121">&#39;, golf ball (with lift)&#39;</span>)
 
legend(legends, loc<span style="color: #666666">=</span><span style="color: #BA2121">&#39;best&#39;</span>, frameon<span style="color: #666666">=</span><span style="color: #008000">False</span>)
xlabel(<span style="color: #BA2121">&#39;x [m]&#39;</span>)
ylabel(<span style="color: #BA2121">&#39;y [m]&#39;</span>)
axis([<span style="color: #666666">0</span>, <span style="color: #666666">250</span>, <span style="color: #666666">0</span>, <span style="color: #666666">50</span>])
savefig(<span style="color: #BA2121">&#39;example_particle_motion_2d_2.png&#39;</span>, transparent<span style="color: #666666">=</span><span style="color: #008000">True</span>)
show()
</pre></div>
<p>
</div>
<!-- end box -->


<p>
<!-- begin bibliography -->

<ol>
 <li> <div id="cheney2012numerical"></div> <b>E. Cheney and D. Kincaid</b>. 
    <em>Numerical Mathematics and Computing</em>,
    Cengage Learning,
    2012.</li>
 <li> <div id="Bearman1976112"></div> <b>P. Bearman and J. Harvey</b>. 
    GOLF BALL AERODYNAMICS.,
    <em>Aeronaut Q</em>,
    27(pt 2),
    pp. 112-122,
    1976,
    <a href="http://www.scopus.com/inward/record.url?eid=2-s2.0-0016949854&partnerID=40&md5=a1d1cc6e8477e33fcd2d5ccf55fc29a8" target="_blank"><tt>http://www.scopus.com/inward/record.url?eid=2-s2.0-0016949854&partnerID=40&md5=a1d1cc6e8477e33fcd2d5ccf55fc29a8</tt></a>.</li>
</ol>

<!-- end bibliography -->

<!-- ------------------- end of main content --------------- -->


</body>
</html>
    

