<!--
Automatically generated HTML file from DocOnce source
(https://github.com/hplgit/doconce/)
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="DocOnce: https://github.com/hplgit/doconce/" />
<meta name="description" content="An intro to scientific computing with Python">
<meta name="keywords" content="doc strings,pickling">

<title>An intro to scientific computing with Python</title>

<!-- Bootstrap style: bootstrap_bluegray -->
<link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet">
<link href="https://raw.github.com/hplgit/doconce/master/bundled/html_styles/style_bootstrap/css/bootstrap_bluegray.css" rel="stylesheet">
<!-- not necessary
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
-->

</head>

<!-- tocinfo
{'highest level': 1,
 'sections': [(' Optimal backround for reading this note ',
               3,
               None,
               '___sec0'),
              (' A scientific application ', 1, None, '___sec1'),
              (' Physical problem and mathematical model ',
               2,
               None,
               '___sec2'),
              (' Numerical model ', 2, None, '___sec3'),
              (' Simple implementation ', 2, None, '___sec4'),
              (' Dissection of the code ', 2, None, '___sec5'),
              (' More advanced implementation ', 2, None, '___sec6'),
              (' Dissection of the code ', 2, None, '___sec7'),
              (' The excitation force ', 2, None, '___sec8'),
              (' A high-level solve function ', 2, None, '___sec9'),
              (' User input ', 1, None, '___sec10'),
              (' Positional command-line arguments ', 2, None, '___sec11'),
              (' Option-value pairs on the command line ',
               2,
               None,
               '___sec12'),
              (' Visual exploration ', 1, None, '___sec13'),
              (' Advanced topics ', 1, None, '___sec14'),
              (' Symbolic computing via SymPy ', 2, None, '___sec15'),
              (' Testing ', 2, None, '___sec16'),
              (' Example on a test function ', 3, None, '___sec17'),
              (' Test function for the numerical solver ',
               3,
               None,
               '___sec18'),
              (' Appendix: Quick motivation for programming with Python ',
               1,
               'app:motivation',
               'app:motivation'),
              (' Appendix: Scientific Python resources ',
               1,
               'app:resources',
               'app:resources'),
              (' Full tutorials on scientific programming with Python ',
               3,
               None,
               '___sec21'),
              (' NumPy resources ', 3, None, '___sec22'),
              (' Useful resources ', 3, None, '___sec23'),
              (' Some relevant Python books ', 3, None, '___sec24'),
              (' Course material on Python programming in general ',
               3,
               None,
               '___sec25')]}
end of tocinfo -->

<body>



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: {
     equationNumbers: {  autoNumber: "AMS"  },
     extensions: ["AMSmath.js", "AMSsymbols.js", "autobold.js", "color.js"]
  }
});
</script>
<script type="text/javascript"
 src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



    
<!-- Bootstrap navigation bar -->
<div class="navbar navbar-default navbar-fixed-top">
  <div class="navbar-header">
    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
      <span class="icon-bar"></span>
    </button>
    <a class="navbar-brand" href="bumpy.html">An intro to scientific computing with Python</a>
  </div>
  <div class="navbar-collapse collapse navbar-responsive-collapse">
    <ul class="nav navbar-nav navbar-right">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Contents <b class="caret"></b></a>
        <ul class="dropdown-menu">
     <!-- navigation toc: --> <li><a href="#___sec1" style="font-size: 80%;">A scientific application</a></li>
     <!-- navigation toc: --> <li><a href="#___sec10" style="font-size: 80%;">User input</a></li>
     <!-- navigation toc: --> <li><a href="#___sec13" style="font-size: 80%;">Visual exploration</a></li>
     <!-- navigation toc: --> <li><a href="#___sec14" style="font-size: 80%;">Advanced topics</a></li>
     <!-- navigation toc: --> <li><a href="#app:motivation" style="font-size: 80%;">Appendix: Quick motivation for programming with Python</a></li>
     <!-- navigation toc: --> <li><a href="#app:resources" style="font-size: 80%;">Appendix: Scientific Python resources</a></li>

        </ul>
      </li>
    </ul>
  </div>
</div>
</div> <!-- end of navigation bar -->

<div class="container">

<p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p> <!-- add vertical space -->

<!-- ------------------- main content ---------------------- -->

<!-- NOTE: This document is written in DocOnce syntax and automatically -->
<!-- compiled to HTML, Sphinx, LaTeX, Markdown, MediaWiki, IPython notebooks, ... -->

<p>
<!-- See <a href="https://github.com/hplgit/doconce" target="_blank"><tt>https://github.com/hplgit/doconce</tt></a> -->

<p>


<div class="jumbotron">
<center><h1>An intro to scientific computing with Python</h1></center>  <!-- document title -->

<p>
<!-- author(s): Johan Kolst&#248; S&#248;nstab&#248;, and Leif Rune Hellevik -->

<center>
<b>Johan Kolst&#248; S&#248;nstab&#248;</b> [1, 2]
</center>

<center>
<b>Leif Rune Hellevik</b> [2]
</center>


<p>
<!-- institution(s) -->

<center>[1] <b>Centre for Advanced Structural Analysis (CASA)</b></center>
<center>[2] <b>Department of Structural Engineering, NTNU</b></center>
<p>
<center><h4>Dec 10, 2014</h4></center> <!-- date -->
<p>
This example is to a large extent developed by <b>Hans Petter Langtangen</b> (<a href="http://hplgit.github.io/bumpy/doc/pub/bumpy.html" target="_blank"><tt>http://hplgit.github.io/bumpy/doc/pub/bumpy.html</tt></a>) at Simula Research Laboratory and University of Oslo, and he is credited for that. 

<p>
<div class="alert alert-block alert-warning alert-text-normal"><b>Contents.</b>
This worked example

<ul>
  <li> fetches a data file from a web site,</li>
  <li> applies that file as input data for a differential equation modeling a vibrating system,</li>
  <li> solves the equation by a finite difference method,</li>
  <li> visualizes various properties of the solution and the input data.</li>
</ul>
</div>


<p>
The following programming topics are illustrated:

<ul>
  <li> basic Python constructs: variables, loops, if-tests, arrays, functions</li>
  <li> flexible storage of objects in lists,</li>
  <li> storage of objects in files (persistence),</li>
  <li> downloading files from the web,</li>
  <li> user input via the command line</li>
  <li> signal processing and FFT,</li>
  <li> curve plotting of data,</li>
  <li> testing.</li>
</ul>

<!-- potential-jumbotron-button -->
</div> <!-- end jumbotron -->

<!-- !split -->

<h3 id="___sec0">Optimal backround for reading this note <a name="___sec0"></a></h3>

<ul>
  <li> Some interest in exploring physics through numerical simulation</li>
  <li> Some very basic knowledge of differential equations</li>
  <li> Some very basic knowledge of finite difference approximations</li>
  <li> Significant interest in exploring Python for scientific computations</li>
</ul>

<div class="alert alert-block alert-success alert-text-normal"><b></b>
No background in Python is assumed - the aim is to give an impression of
how Python can be used in a MATLAB-like fashion to solve a real-world
physical problem (with low mathematical complexity).
</div>


<p>
If you need motivation for using Python as programming language,
see  <a href="#app:motivation">Appendix: Quick motivation for programming with Python</a>. Lists of many useful tutorials
and introductions to Python, with emphasis on scientific computing,
are found in  <a href="#app:resources">Appendix: Scientific Python resources</a>.

<p>
<!-- !split -->

<h1 id="___sec1">A scientific application <a name="___sec1"></a></h1>

<h2 id="___sec2">Physical problem and mathematical model <a name="___sec2"></a></h2>

The task is to make a simulation program that can predict how a (simple)
mechanical system oscillates in response to environmental forces.
Introducing \( u(t) \) as some displacement of the system at time \( t \),
application of Newton's second law of motion to such a mechanical system often
results in the following type of equation for \( u \):

$$
\begin{equation}
mu'' + f(u') + s(u) = F(t),
\label{bumpy:eq1}
\end{equation}
$$

The prime, as in \( u' \), denotes differentiation with respect to time
(\( u'(t) \) or \( du/dt \)).
Furthermore, \( m \) is the mass of the system, \( f(u') \) is a friction force
that gives rise to a damping of the motion,
\( s(u) \) represents a restoring force, such as
a spring, and \( F(t) \) models the external environmental forces on the system.
Equation \eqref{bumpy:eq1} must be accompanied by two initial conditions:
\( u(0)=I \) and \( u'(0)=V \).
The values of these have no effect on the
steady state behavior of \( u(t) \) for large values of \( t \), since this
behavior is determined by the force \( F(t) \) and the system
parameters \( m \), \( f(u') \), and \( s(u) \).

<p>
There are two types of the friction force \( f \): linear damping \( f(u')=bu' \)
and quadratic damping \( f(u')=bu'|u'| \).
The input data consists of \( m \), \( b \), \( s(u) \), \( F(t) \), \( I \), \( V \),
and specification of linear or quadratic damping.
The unknown quantity to be computed is \( u(t) \) for \( t\in (0,T] \).

<p>
One example where the model above has relevance, is the vertical
vibration of a vehicle in response to a bumpy road. Let \( h(x) \) be the
height of the road at some coordinate \( x \) along the road.  When
driving along this road with constant velocity \( v \), the vehicle is
moved up and down in time according to \( h(vt) \), resulting in an
external vertical force \( F(t)=-mh''(vt)v^2 \). We assume that the
vehicle has springs and dampers that here are modeled as \( bu' \)
(damper) and \( s(s)=ku \) (spring), with given damping parameter \( b \) and
spring constant \( k \). The unknown \( u(t) \) is the vertical displacement
of the vehicle relative to the road. Figure <a href="#bumpy:fig1">1</a>
illustrates the situation.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 1:  Vehicle on a bumpy road. <a name="bumpy:fig1"></a> </p></center>
<p><img src="fig-bumpy/vehicle2_2.png" align="bottom" width=600></p>
</center>

<p>
Another example regards the vertical shaking of a building due to
earthquake-induced movement of the ground. If the vertical displacement of the
ground is recorded as a function \( d(t) \), this results in a
vertical force \( F(t)=-md''(t) \). The soil foundation acts as a
spring and damper on the building, modeled through the damping parameter
\( b \) and normally a linear spring term \( s(u)=ku \).

<p>
In both cases we drop the effect of gravity, which is just a constant
compression of the spring.

<p>
<!-- wing, riser -->

<p>
Our task is to compute and analyse the vertical \( u(t) \) vibrations
of a vehicle, given the shape \( h(x) \) of the road and some velocity \( v \).

<p>
<!-- !split -->

<h2 id="___sec3">Numerical model <a name="___sec3"></a></h2>

The differential equation problem \eqref{bumpy:eq1} can be solved
by introducing finite difference approximations for \( u'' \) and \( u' \).
In case of quadratic damping one can use a geometric mean to approximate
\( u'|u'| \) and thereby linearize the equations. The result of using
such numerical methods is an algorithm for computing \( u(t) \) at
discrete points in time. Let \( u^n \) be the approximation to \( u \) at
time \( t_n=n\Delta t \), \( n=1,2,\ldots \), where \( \Delta t \)
is a (small) time interval. For example, if \( \Delta t = 0.1 \), we
find approximations \( u^1 \) to \( u \) at \( t=0.1 \), \( u^2 \) at \( t=0.2 \), \( u^3 \)
to \( t=0.3 \), and so forth. Any value \( u^{n+1} \) can be computed if \( u^n \)
and \( u^{n-1} \) are known (i.e., previously computed).
The formula for \( u^{n+1} \) is, in case of linear damping \( f(u')=bu' \),

$$
\begin{equation}
u^{n+1} = \left(2mu^n + (\frac{b}{2}\Delta t - m)u^{n-1} +
\Delta t^2(F^n - s(u^n))
\right)(m + \frac{b}{2}\Delta t)^{-1},
\label{bumpy:u:scheme:lin}
\end{equation}
$$

where \( F^n \) means \( F(t) \) evaluated for \( t=t_n \). A special formula
must be applied for \( n=0 \):

$$
\begin{equation}
u^1 = u^0 + \Delta t\, V
+ \frac{\Delta t^2}{2m}(-bV - s(u^0) + F^0)
\thinspace .
\label{bumpy:u:scheme0:lin}
\end{equation}
$$

For quadratic damping we have a slightly different formula,

$$
\begin{align}
u^{n+1} = & \left( m + b|u^n-u^{n-1}|\right)^{-1}\times\nonumber\\
&\quad \left(2m u^n - mu^{n-1} + bu^n|u^n-u^{n-1}| + \Delta t^2 (F^n - s(u^n))
\right),
\label{bumpy:u:scheme:quad}
\end{align}
$$

and again a special formula for \( u^1 \):

$$
\begin{equation}
u^1 = u^0 + \Delta t V + \frac{\Delta t^2}{2m}\left(-bV|V| - s(u^0) + F^0\right)
\thinspace .
\label{bumpy:u:scheme0:quad}
\end{equation}
$$


<p>
The implementation of the computational algorithm can make use
of an array <code>u</code> to represent \( u^n \) as <code>u[n]</code>. The force \( F(t_n) \) is
assumed to be available as an array element <code>F[n]</code>. The following
Python function computes <code>u</code> given  an array <code>t</code>
with time points \( t_0,t_1,\ldots \),
the initial displacement <code>I</code>, mass <code>m</code>, damping parameter <code>b</code>,
restoring force <code>s(u)</code>, environmental forces <code>F</code> as an array
(corresponding to <code>t</code>).

<p>
<!-- !split -->

<h2 id="___sec4">Simple implementation <a name="___sec4"></a></h2>

Let us first implement the computational formulas for the linear
damping case in a short and compact Python function:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">solver_linear_damping</span>(I, V, m, b, s, F, t):
    N <span style="color: #666666">=</span> t<span style="color: #666666">.</span>size <span style="color: #666666">-</span> <span style="color: #666666">1</span>              <span style="color: #408080; font-style: italic"># No of time intervals</span>
    dt <span style="color: #666666">=</span> t[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> t[<span style="color: #666666">0</span>]            <span style="color: #408080; font-style: italic"># Time step</span>
    u <span style="color: #666666">=</span> zeros(N<span style="color: #666666">+1</span>)              <span style="color: #408080; font-style: italic"># Result array</span>
    u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> I
    u[<span style="color: #666666">1</span>] <span style="color: #666666">=</span> u[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>V <span style="color: #666666">+</span> dt<span style="color: #666666">**2/</span>(<span style="color: #666666">2*</span>m)<span style="color: #666666">*</span>(<span style="color: #666666">-</span>b<span style="color: #666666">*</span>V <span style="color: #666666">-</span> s(u[<span style="color: #666666">0</span>]) <span style="color: #666666">+</span> F[<span style="color: #666666">0</span>])

    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>,N):
        u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> <span style="color: #666666">1./</span>(m <span style="color: #666666">+</span> b<span style="color: #666666">*</span>dt<span style="color: #666666">/2</span>)<span style="color: #666666">*</span>(<span style="color: #666666">2*</span>m<span style="color: #666666">*</span>u[n] <span style="color: #666666">+</span> \ 
                 (b<span style="color: #666666">*</span>dt<span style="color: #666666">/2</span> <span style="color: #666666">-</span> m)<span style="color: #666666">*</span>u[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> dt<span style="color: #666666">**2*</span>(F[n] <span style="color: #666666">-</span> s(u[n])))
    <span style="color: #008000; font-weight: bold">return</span> u
</pre></div>

<h2 id="___sec5">Dissection of the code <a name="___sec5"></a></h2>

Functions in Python start with <code>def</code>, followed by the function name and
the list of input objects separated by comma. The function body is
indented, and the first non-indented line signifies the end of the function
body block.

<p>
The arguments to this function and the variables created
inside the function are not declared with type. We therefore need to
know what the variables are supposed to be: <code>I</code>, <code>V</code>, <code>m</code>, and <code>b</code>
are real numbers, while <code>F</code> and <code>t</code> are one-dimensional arrays of
the same length, where <code>F</code> holds \( F(t_n) \) and <code>t</code> holds \( t_n \),
\( n=0,1,\ldots,N+1 \).

<p>
The number of elements in an array <code>t</code> is given by <code>t.size</code> (or
<code>len(t)</code>, but <code>t.size</code> works for multi-dimensional arrays too).
Arrays are indexed by square brackets, and indices always start at 0.
For/do loops in Python are more general than those in Fortran, C, C++,
and Java, as one can loop over the any set of objects with the
syntax <code>for element in some_set</code>. In numerical code, it is common
to loop over array indices, i.e., a set of integers. Such a set
is produced by <code>range(start, stop, increment)</code>, which returns a
list of integers <code>start, start+increment, start+2*increment</code>, and so on,
up to <em>but not including</em> <code>stop</code>. Writing just <code>range(stop)</code> means
<code>range(0, stop, 1)</code>. The particular call <code>range(1, N)</code> used in the code
above results in a list of integers: <code>1</code>, <code>2</code>, ..., <code>N-1</code>.

<p>
Array functionality is enabled by the <code>numpy</code> package, which offers
functions such as <code>zeros</code> and <code>linspace</code>, as known from MATLAB.
Here we import all objects in the <code>numpy</code> package by the statement

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
</pre></div>
<p>
Only the <code>zeros</code> function is used to create the output array <code>u</code>.

<p>
Comments start with the character <code>#</code> and the rest of the line
is then ignored by Python.

<p>
Every variable in Python is an object. In particular, the <code>s</code> function
above is a function object, transferred to the function as any other
object, and called as any other function. Transferring a function as
argument to another function is therefore simpler and cleaner in Python
than in, e.g., C, C++, Java, C#, and MATLAB.

<p>
How can we use the <code>solver_linear_damping</code> function? We need to <em>call</em> it
with relevant values for the arguments. Suppose we want to solve
a vibration problem with \( I=1 \), \( V=0 \),
\( F=0 \), \( m=2 \), \( b=0.2 \), \( s(u)=2u \), \( \Delta t=0.2 \),
for \( t\in [0,10\pi] \). This will be a damped sinusoidal solution
(setting \( b=0 \) will result in \( u(t)=\cos t \)).
The test code becomes

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #408080; font-style: italic">#/python_intro/doc/src/src-bumpy/session.py</span>

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">solver</span> <span style="color: #008000; font-weight: bold">import</span> solver_linear_damping
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">s</span>(u):
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">2*</span>u

T <span style="color: #666666">=</span> <span style="color: #666666">10*</span>pi      <span style="color: #408080; font-style: italic"># simulate for t in [0,T]</span>
dt <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
N <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
t <span style="color: #666666">=</span> linspace(<span style="color: #666666">0</span>, T, N<span style="color: #666666">+1</span>)
F <span style="color: #666666">=</span> zeros(t<span style="color: #666666">.</span>size)
I <span style="color: #666666">=</span> <span style="color: #666666">1</span>; V <span style="color: #666666">=</span> <span style="color: #666666">0</span>
m <span style="color: #666666">=</span> <span style="color: #666666">2</span>; b <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
u <span style="color: #666666">=</span> solver_linear_damping(I, V, m, b, s, F, t)

<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
plot(t, u)
savefig(<span style="color: #BA2121">&#39;tmp.pdf&#39;</span>)   <span style="color: #408080; font-style: italic"># save plot to PDF file</span>
savefig(<span style="color: #BA2121">&#39;tmp.png&#39;</span>)   <span style="color: #408080; font-style: italic"># save plot to PNG file</span>
show()
</pre></div>
<p>
The <code>solver_linear_damping</code> function resides in the file <code>solver.py</code>,
so if we make the call to this function in separate file (assumed above),
we have to import the function as shown. We also need functions and
variables from
the <code>numpy</code> package, here <code>pi</code>, <code>linspace</code>, and <code>zeros</code>.
Normally, there is one statement per line in Python programs, and there
is no need to end the statement with a semicolon. However, if we
want multiple statements on a line, they must be separated by semi colon
as demonstrated in the initialization of <code>I</code> and <code>V</code>. Plotting the
computed curve makes use of the <code>matplotlib</code> package, where we call
its <code>plot</code>, <code>savefig</code>, and <code>show</code> functions. Figure <a href="#bumpy:fig0">2</a>
shows the result.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 2:  Plot of computed curve. <a name="bumpy:fig0"></a> </p></center>
<p><img src="fig-bumpy/solver_linear_damping.png" align="bottom" width=500></p>
</center>

<p>
<!-- !split -->

<h2 id="___sec6">More advanced implementation <a name="___sec6"></a></h2>

Let us extend the function above to also include the quadratic damping
formulas. The \( F(t) \) function in \eqref{bumpy:eq1} is required to be
available as an array in the <code>solver_linear_damping</code> function, but
now we will allow for more flexibility: the <code>F</code> argument may either be
a Python function <code>F(t)</code> or a Python array. In addition, we add some
checks that variables have correct values or are of correct type.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">solver</span>(I, V, m, b, s, F, t, damping<span style="color: #666666">=</span><span style="color: #BA2121">&#39;linear&#39;</span>):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    Solve m*u&#39;&#39; + f(u&#39;) + s(u) = F for time points in t.</span>
<span style="color: #BA2121; font-style: italic">    u(0)=I and u&#39;(0)=V,</span>
<span style="color: #BA2121; font-style: italic">    by a central finite difference method with time step dt.</span>
<span style="color: #BA2121; font-style: italic">    If damping is &#39;linear&#39;, f(u&#39;)=b*u, while if damping is</span>
<span style="color: #BA2121; font-style: italic">    &#39;quadratic&#39;, we have f(u&#39;)=b*u&#39;*abs(u&#39;).</span>
<span style="color: #BA2121; font-style: italic">    s(u) is a Python function, while F may be a function</span>
<span style="color: #BA2121; font-style: italic">    or an array (then F[i] corresponds to F at t[i]).</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    N <span style="color: #666666">=</span> t<span style="color: #666666">.</span>size <span style="color: #666666">-</span> <span style="color: #666666">1</span>              <span style="color: #408080; font-style: italic"># No of time intervals</span>
    dt <span style="color: #666666">=</span> t[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> t[<span style="color: #666666">0</span>]            <span style="color: #408080; font-style: italic"># Time step</span>
    u <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(N<span style="color: #666666">+1</span>)           <span style="color: #408080; font-style: italic"># Result array</span>
    b <span style="color: #666666">=</span> <span style="color: #008000">float</span>(b); m <span style="color: #666666">=</span> <span style="color: #008000">float</span>(m)  <span style="color: #408080; font-style: italic"># Avoid integer division</span>

    <span style="color: #408080; font-style: italic"># Convert F to array</span>
    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">callable</span>(F):
        F <span style="color: #666666">=</span> F(t)
    <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">isinstance</span>(F, (<span style="color: #008000">list</span>,<span style="color: #008000">tuple</span>,np<span style="color: #666666">.</span>ndarray)):
        F <span style="color: #666666">=</span> np<span style="color: #666666">.</span>asarray(F)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">TypeError</span>(
            <span style="color: #BA2121">&#39;F must be function or array, not </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> <span style="color: #008000">type</span>(F))

    u[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> I
    <span style="color: #008000; font-weight: bold">if</span> damping <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;linear&#39;</span>:
        u[<span style="color: #666666">1</span>] <span style="color: #666666">=</span> u[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>V <span style="color: #666666">+</span> dt<span style="color: #666666">**2/</span>(<span style="color: #666666">2*</span>m)<span style="color: #666666">*</span>(<span style="color: #666666">-</span>b<span style="color: #666666">*</span>V <span style="color: #666666">-</span> s(u[<span style="color: #666666">0</span>]) <span style="color: #666666">+</span> F[<span style="color: #666666">0</span>])
    <span style="color: #008000; font-weight: bold">elif</span> damping <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;quadratic&#39;</span>:
        u[<span style="color: #666666">1</span>] <span style="color: #666666">=</span> u[<span style="color: #666666">0</span>] <span style="color: #666666">+</span> dt<span style="color: #666666">*</span>V <span style="color: #666666">+</span> \ 
               dt<span style="color: #666666">**2/</span>(<span style="color: #666666">2*</span>m)<span style="color: #666666">*</span>(<span style="color: #666666">-</span>b<span style="color: #666666">*</span>V<span style="color: #666666">*</span><span style="color: #008000">abs</span>(V) <span style="color: #666666">-</span> s(u[<span style="color: #666666">0</span>]) <span style="color: #666666">+</span> F[<span style="color: #666666">0</span>])
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">ValueError</span>(<span style="color: #BA2121">&#39;Wrong value: damping=&quot;</span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&quot;&#39;</span> <span style="color: #666666">%</span> damping)

    <span style="color: #008000; font-weight: bold">for</span> n <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>,N):
        <span style="color: #008000; font-weight: bold">if</span> damping <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;linear&#39;</span>:
            u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> (<span style="color: #666666">2*</span>m<span style="color: #666666">*</span>u[n] <span style="color: #666666">+</span> (b<span style="color: #666666">*</span>dt<span style="color: #666666">/2</span> <span style="color: #666666">-</span> m)<span style="color: #666666">*</span>u[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span>
                      dt<span style="color: #666666">**2*</span>(F[n] <span style="color: #666666">-</span> s(u[n])))<span style="color: #666666">/</span>(m <span style="color: #666666">+</span> b<span style="color: #666666">*</span>dt<span style="color: #666666">/2</span>)
        <span style="color: #008000; font-weight: bold">elif</span> damping <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;quadratic&#39;</span>:
            u[n<span style="color: #666666">+1</span>] <span style="color: #666666">=</span> (<span style="color: #666666">2*</span>m<span style="color: #666666">*</span>u[n] <span style="color: #666666">-</span> m<span style="color: #666666">*</span>u[n<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> b<span style="color: #666666">*</span>u[n]<span style="color: #666666">*</span><span style="color: #008000">abs</span>(u[n] <span style="color: #666666">-</span> u[n<span style="color: #666666">-1</span>])
                      <span style="color: #666666">-</span> dt<span style="color: #666666">**2*</span>(s(u[n]) <span style="color: #666666">-</span> F[n]))<span style="color: #666666">/</span>\ 
                      (m <span style="color: #666666">+</span> b<span style="color: #666666">*</span><span style="color: #008000">abs</span>(u[n] <span style="color: #666666">-</span> u[n<span style="color: #666666">-1</span>]))
    <span style="color: #008000; font-weight: bold">return</span> u, t
</pre></div>

<h2 id="___sec7">Dissection of the code <a name="___sec7"></a></h2>

<b>Two types of import.</b>
This time we replace <code>from numpy import *</code>, which imports over 500
variables and functions, by <code>import numpy as np</code>, which just imports
one variable, the package <code>numpy</code>, here under the nickname <code>np</code>.
All variables and functions in <code>numpy</code> must now be reached via the
prefix <code>np.</code>, as in <code>np.zeros</code>, and <code>np.linspace</code>, and <code>np.pi</code> (for \( \pi \)).
The advantage of the prefix is that we clearly see where functionality
comes from. The disadvantage is that mathematical formulas like
\( \sin (\pi x) \) must be written <code>np.sin(np.pi*x)</code>. We can always perform
an explicit import of some names, like <code>sin</code> and <code>pi</code>, to write
the formula as <code>sin(pi*x)</code>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> sin, pi

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">myfunction</span>(x):
    <span style="color: #008000; font-weight: bold">return</span> sin(pi<span style="color: #666666">*</span>x)
</pre></div>
<p>
Another disadvantage with the <code>np.</code> prefix is that names are no longer
(almost) the
same as in MATLAB. Many will therefore prefer to do <code>from numpy import *</code>
and skip the prefix.
<!-- Still much import * so the following is not yet valid: -->
<!-- We shall keep <code>np.</code> as it has become a standard in the Python scientific computing community. -->

<p>
<b>Doc strings.</b>
The string, enclosed in triple double-quotes, right after
the function definition, is a <em>doc string</em> used for documenting the
function. Various tools can extract function definitions and doc strings
to automatically produce nicely typeset manuals.

<p>
<b>Avoiding integer division.</b>
At one line we explicitly convert <code>b</code> and <code>m</code> to <code>float</code> variables.
This is not strictly necessary, but if we supply <code>b=2</code> and <code>m=4</code>,
a computation like <code>b/m</code> will give zero as result because both <code>b</code> and <code>m</code>
are then integers and <code>b/m</code> implies <em>integer division</em>, not the
mathematical division of real numbers (this is not a special
feature of Python - all languges with a strong heritage from C
invoke integer division if both operands in a division are integers).
We need to make
sure that at least one of the operands in a division is a real
number (<code>float</code>) to ensure the intended mathematical operation. Looking at
the formulas, there is never a problem with integer division in
our implementation, because <code>dt</code> is computed from <code>t</code>, which has
<code>float</code> elements (<code>linspace</code> makes <code>float</code> elements by default),
and all divisions in our code involve <code>dt</code> as one of the operands.
However, future edits may alter the way formulas are written, so to
be on the safe side we ensure that real input parameters are <code>float</code>
objects.

<p>
<b>Flexible variable type.</b>
As mentioned, we allow <code>F</code> to be either a function or an array.
In the former case, we convert <code>F</code> to an array such that the
rest of the code can assume that <code>F</code> is indeed an array.
It is easy to check the type of variables in Python. The
test <code>if callable(F)</code> is true if the object <code>F</code> can be called
as a function.

<p>
<b>Checking correct variable type.</b>
To test that <code>F</code> is an array, we can use <code>isinstance(F, np.ndarray)</code>
(<code>ndarray</code> is the name of the array type in <code>numpy</code>). In the code
above we allow that <code>F</code> can also be a list or a tuple. Running <code>F</code>
through the <code>asarray</code> function makes an array out of <code>F</code> in the cases
where <code>F</code> is a list or tuple. The final <code>else:</code> clause takes care of
the situation where <code>F</code> is neither a function, nor an object that can
easily be converted to an array, and an error message is issued. More
precisely, we <em>raise</em> a <code>TypeError</code> <em>exception</em> indicating that we
have encountered a wrong type. The error message will contain the type
of <code>F</code> as obtained from <code>type(F)</code>. Instead of using the syntax <code>isinstance(F,
list)</code> we may test <code>type(F) == list</code> or even <code>type(F) in
(list,tuple,np.ndarray)</code>.

<p>
We could simplify the <code>if-else</code> test involving <code>F</code> to just the two lines

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">callable</span>(F):
    F <span style="color: #666666">=</span> F(t)
</pre></div>
<p>
if we are sure that <code>F</code> is either a function or a <code>numpy</code> array.
Should the user send in something else for <code>F</code>, Python will encounter
a run-time error when trying to index <code>F</code> as in <code>F[0]</code> in the
statement computating <code>u[1]</code>.

<p>
To be absolutely safe, we should test that the other arguments are
of right type as well. For example,

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> <span style="color: #008000">isinstance</span>(I, (<span style="color: #008000">float</span>,<span style="color: #008000">int</span>)):
    <span style="color: #008000; font-weight: bold">raise</span> <span style="color: #D2413A; font-weight: bold">TypeError</span>(<span style="color: #BA2121">&#39;V must be float or int, not </span><span style="color: #BB6688; font-weight: bold">%s</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> <span style="color: #008000">type</span>(V))
</pre></div>
<p>
and similar for <code>V</code>, <code>m</code>, <code>b</code>, while <code>s</code> must be tested by <code>callable(s)</code>,
<code>t</code> must be <code>np.ndarray</code>, and <code>damping</code> must be <code>str</code>.

<p>
<b>Calling the function.</b>
Below is a simple example on how the <code>solver</code> function can be called
to solve the differential equation problem \( mu'' + bu' + ku = A\sin\pi t \),
\( u(0)=I \), \( u'(0)=0 \):

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">import</span> sin, pi  <span style="color: #408080; font-style: italic"># for nice math</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">F</span>(t):
    <span style="color: #408080; font-style: italic"># Sinusoidal bumpy road</span>
    <span style="color: #008000; font-weight: bold">return</span> A<span style="color: #666666">*</span>sin(pi<span style="color: #666666">*</span>t)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">s</span>(u):
    <span style="color: #008000; font-weight: bold">return</span> k<span style="color: #666666">*</span>u

A <span style="color: #666666">=</span> <span style="color: #666666">0.25</span>
k <span style="color: #666666">=</span> <span style="color: #666666">2</span>
t <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, <span style="color: #666666">20</span>, <span style="color: #666666">2001</span>)
u, t <span style="color: #666666">=</span> solver(I<span style="color: #666666">=0.1</span>, V<span style="color: #666666">=0</span>, m<span style="color: #666666">=2</span>, b<span style="color: #666666">=0.05</span>, s<span style="color: #666666">=</span>s, F<span style="color: #666666">=</span>F, t<span style="color: #666666">=</span>t)

<span style="color: #408080; font-style: italic"># Show u(t) as a curve plot</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pyplot</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">plt</span>
plt<span style="color: #666666">.</span>plot(t, u)
plt<span style="color: #666666">.</span>show()
</pre></div>
<p>
<b>Local and global variables.</b>
We use in this example a linear spring function \( s(u) \),
<p>

<!-- code=text (!bc cod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">def f(u):
    return k*u
</pre></div>
<p>
Here, <code>u</code> is a <em>local variable</em>,
which is accessible just inside in the function,
while <code>k</code> is a <em>global variable</em>, which must be initialized outside
the function prior to calling <code>f</code>.

<p>
<div class="alert alert-block alert-success alert-text-normal"><b>Advanced programming of functions with parameters.</b>
The best way to implement mathematical functions that has a set
of parameters in addition to some
independent variables is to create a <em>class</em> where
the parameters are attributes and a <code>__call__</code> method evaluates
the function formula given the independent variables as arguments.
This requires, of course,
knowledge of classes and special methods like <code>__call__</code>.

<p>
As an example, the <code>f(u)</code> function above can be implemented as

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #ffffff"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">class</span> <span style="color: #0000FF; font-weight: bold">Spring</span>:
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__init__</span>(<span style="color: #008000">self</span>, k):
        <span style="color: #008000">self</span><span style="color: #666666">.</span>k <span style="color: #666666">=</span> k
    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">__call__</span>(<span style="color: #008000">self</span>, u):
        <span style="color: #008000; font-weight: bold">return</span> <span style="color: #008000">self</span><span style="color: #666666">.</span>k<span style="color: #666666">*</span>u

f <span style="color: #666666">=</span> Spring(k)
</pre></div>
<p>
Because of the <code>__call__</code> method, we can make calls <code>f(u)</code>. Note that
the <code>k</code> parameter is bundled with the function in the <code>f</code> object.
</div>


<p>
<!-- !split -->

<h2 id="___sec8">The excitation force <a name="___sec8"></a></h2>

Considering the application where the present mathematical model describes
the vibrations of a vehicle driving along a bumpy road, we need
to establish the force array <code>F</code> from the shape of the road \( h(x) \).
Various shapes are
available as a file with web address <a href="http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz" target="_blank"><tt>http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz</tt></a>. The Python functionality for downloading this <code>gzip</code>
compressed file as a local file <code>bumpy.dat.gz</code>
and reading it into a <code>numpy</code> array goes as follows:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">filename <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;bumpy.dat.gz&#39;</span>
url <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">urllib</span>
urllib<span style="color: #666666">.</span>urlretrieve(url, filename)
h_data <span style="color: #666666">=</span> np<span style="color: #666666">.</span>loadtxt(filename)     <span style="color: #408080; font-style: italic"># read numpy array from file</span>
</pre></div>
<p>
<!-- It may happen that the URL is wrong or that the Internet connection is -->
<!-- down, resulting in a <code>ValueError</code> exception in <code>np.loadtxt</code>. -->
<!-- This potential error can be handled in a <code>try-except</code> construction: -->

<p>
The <code>h_data</code> object is a rectangular <code>numpy</code> array where the first
column contains the \( x \) coordinates along the road and the next columns
contain various road shapes \( h(x) \). We can extract the \( x \) data and
redefine <code>h_data</code> to contain solely the \( h(x) \) shapes:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">x <span style="color: #666666">=</span> h_data[<span style="color: #666666">0</span>,:]                <span style="color: #408080; font-style: italic"># 1st column: x coordinates</span>
h_data <span style="color: #666666">=</span> h_data[<span style="color: #666666">1</span>:,:]          <span style="color: #408080; font-style: italic"># other columns: h shapes</span>
</pre></div>
<p>
In general, the syntax <code>a[s:t:i,2]</code> gives a <em>view</em> (not a copy) to the part of
the array <code>a</code> where the first index goes from <code>s</code> to <code>t</code>,
<em>but not including</em> the <code>t</code> value, in increments of <code>i</code>, and the
second index is fixed at 2. Just writing <code>:</code> for an index means all
legal values of this index.

<p>
Given \( h(x) \), the corresponding acceleration \( a(t) \) needed in the
force \( F(t)=-ma(t) \), follows from \( a(t)=h''(vt)v^2 \), where \( v \) is
the velocity of the vehicle. The compuation may utilize a finite
difference approximation for the second-order derivative \( h'' \) and
be encapsulated in a Python function:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">acceleration</span>(h, x, v):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Compute 2nd-order derivative of h.&quot;&quot;&quot;</span>
    <span style="color: #408080; font-style: italic"># Method: standard finite difference aproximation</span>
    d2h <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(h<span style="color: #666666">.</span>size)
    dx <span style="color: #666666">=</span> x[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> x[<span style="color: #666666">0</span>]
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(<span style="color: #666666">1</span>, h<span style="color: #666666">.</span>size<span style="color: #666666">-1</span>, <span style="color: #666666">1</span>):
        d2h[i] <span style="color: #666666">=</span> (h[i<span style="color: #666666">-1</span>] <span style="color: #666666">-</span> <span style="color: #666666">2*</span>h[i] <span style="color: #666666">+</span> h[i<span style="color: #666666">+1</span>])<span style="color: #666666">/</span>dx<span style="color: #666666">**2</span>
    <span style="color: #408080; font-style: italic"># Extraplolate end values from first interior value</span>
    d2h[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> d2h[<span style="color: #666666">1</span>]
    d2h[<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> d2h[<span style="color: #666666">-2</span>]
    a <span style="color: #666666">=</span> d2h<span style="color: #666666">*</span>v<span style="color: #666666">**2</span>
    <span style="color: #008000; font-weight: bold">return</span> a
</pre></div>
<p>
Note that here, <code>h</code> is a one-dimensional array containing the \( h(x) \)
values corresponding to a given coordinate array <code>x</code>. Also note that
we for mathematical simplicity set \( h''(x) \) at the end points equal to
\( h''(x) \) at the closest interior point.

<p>
The computations of <code>d2h</code> above was done array element by array element.
This loop can be a slow process in Python for long arrays. To speed
up computations dramatically, we can invoke a <em>vectorization</em> of
the above alogrithm. This means that we get rid of the loops and
perform arithmetics on complete (or almost complete) arrays.
The vectorized form of the
<code>acceleration</code> function goes like

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">acceleration_vectorized</span>(h, x, v):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Compute 2nd-order derivative of h. Vectorized version.&quot;&quot;&quot;</span>
    d2h <span style="color: #666666">=</span> np<span style="color: #666666">.</span>zeros(h<span style="color: #666666">.</span>size)
    dx <span style="color: #666666">=</span> x[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> x[<span style="color: #666666">0</span>]
    d2h[<span style="color: #666666">1</span>:<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> (h[:<span style="color: #666666">-2</span>] <span style="color: #666666">-</span> <span style="color: #666666">2*</span>h[<span style="color: #666666">1</span>:<span style="color: #666666">-1</span>] <span style="color: #666666">+</span> h[<span style="color: #666666">2</span>:])<span style="color: #666666">/</span>dx<span style="color: #666666">**2</span>
    <span style="color: #408080; font-style: italic"># Extraplolate end values from first interior value</span>
    d2h[<span style="color: #666666">0</span>] <span style="color: #666666">=</span> d2h[<span style="color: #666666">1</span>]
    d2h[<span style="color: #666666">-1</span>] <span style="color: #666666">=</span> d2h[<span style="color: #666666">-2</span>]
    a <span style="color: #666666">=</span> d2h<span style="color: #666666">*</span>v<span style="color: #666666">**2</span>
    <span style="color: #008000; font-weight: bold">return</span> a
</pre></div>
<p>
For each shape \( h(x) \) we want to compute the corresponding
vertical displacement \( u(t) \) using the mathematical model \eqref{bumpy:eq1}.
This can be accomplished by looping over the columns of <code>h_data</code> and
calling <code>forced_vibrations</code> for each column, i.e., each realization of
the force \( F \).
The major arrays from the computations
are collected in a list <code>data</code>. The two first elements in
<code>data</code> are <code>x</code> and <code>t</code>. The next elements are
3-lists <code>[h, a, u]</code> for each road shape.
Note that some elements in <code>data</code> are arrays while others are list of
arrays. This composition is convenient when analyzing and visualizing
key quantities in the problem.

<p>
The computations of <code>u</code> for each road shape can be done as follows:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">data <span style="color: #666666">=</span> [x, t]      <span style="color: #408080; font-style: italic"># key input and output data (arrays)</span>
<span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h_data<span style="color: #666666">.</span>shape[<span style="color: #666666">0</span>]):
    h <span style="color: #666666">=</span> h_data[i,:]            <span style="color: #408080; font-style: italic"># extract a column</span>
    a <span style="color: #666666">=</span> acceleration(h, x, v)
    u <span style="color: #666666">=</span> forced_vibrations(t<span style="color: #666666">=</span>t, I<span style="color: #666666">=0</span>, m<span style="color: #666666">=</span>m, b<span style="color: #666666">=</span>b, f<span style="color: #666666">=</span>f, F<span style="color: #666666">=-</span>m<span style="color: #666666">*</span>a)
    data<span style="color: #666666">.</span>append([h, a, u])
</pre></div>
<p>
A parameter choice \( m=60 \) kg, \( v=5 \) m/s, \( k=60 \) N/m,
and \( b=80 \) Ns/m
corresponds to a velocity of 18 km/h and a mass of 60 kg, i.e.,
bicycle conditions.

<p>
<!-- !split -->

<h2 id="___sec9">A high-level solve function <a name="___sec9"></a></h2>

The code above is naturally implemented as a Python function.
This function can take the most important physical parameters of the problem
as input, along with information about the file with road shapes.
We allow for defining road shapes either through a file on a web site
or a local file.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">solve</span>(url<span style="color: #666666">=</span><span style="color: #008000">None</span>, m<span style="color: #666666">=60</span>, b<span style="color: #666666">=80</span>, k<span style="color: #666666">=60</span>, v<span style="color: #666666">=5</span>):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;</span>
<span style="color: #BA2121; font-style: italic">    Solve model for verticle vehicle vibrations.</span>

<span style="color: #BA2121; font-style: italic">    =========   ==============================================</span>
<span style="color: #BA2121; font-style: italic">    variable    description</span>
<span style="color: #BA2121; font-style: italic">    =========   ==============================================</span>
<span style="color: #BA2121; font-style: italic">    url         either URL of file with excitation force data,</span>
<span style="color: #BA2121; font-style: italic">                or name of a local file</span>
<span style="color: #BA2121; font-style: italic">    m           mass of system</span>
<span style="color: #BA2121; font-style: italic">    b           friction parameter</span>
<span style="color: #BA2121; font-style: italic">    k           spring parameter</span>
<span style="color: #BA2121; font-style: italic">    v           (constant) velocity of vehicle</span>
<span style="color: #BA2121; font-style: italic">    Return      data (list) holding input and output data</span>
<span style="color: #BA2121; font-style: italic">                [x, t, [h,a,u], [h,a,u], ...]</span>
<span style="color: #BA2121; font-style: italic">    =========   ==============================================</span>
<span style="color: #BA2121; font-style: italic">    &quot;&quot;&quot;</span>
    <span style="color: #408080; font-style: italic"># Download file (if url is not the name of a local file)</span>
    <span style="color: #008000; font-weight: bold">if</span> url<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">&#39;http://&#39;</span>) <span style="color: #AA22FF; font-weight: bold">or</span> url<span style="color: #666666">.</span>startswith(<span style="color: #BA2121">&#39;file://&#39;</span>):
        <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">urllib</span>
        filename <span style="color: #666666">=</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>basename(url)  <span style="color: #408080; font-style: italic"># strip off path</span>
        urllib<span style="color: #666666">.</span>urlretrieve(url, filename)
    <span style="color: #008000; font-weight: bold">else</span>:
        <span style="color: #408080; font-style: italic"># Check if url is the name of a local file</span>
        filename <span style="color: #666666">=</span> url
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #AA22FF; font-weight: bold">not</span> os<span style="color: #666666">.</span>path<span style="color: #666666">.</span>isfile(filename):
            <span style="color: #008000; font-weight: bold">print</span> url, <span style="color: #BA2121">&#39;must be a URL or a filename&#39;</span>
            sys<span style="color: #666666">.</span>exit(<span style="color: #666666">1</span>)  <span style="color: #408080; font-style: italic"># abort program</span>
        <span style="color: #408080; font-style: italic"># else: ok</span>

    h_data <span style="color: #666666">=</span> np<span style="color: #666666">.</span>loadtxt(filename)  <span style="color: #408080; font-style: italic"># read numpy array from file</span>

    x <span style="color: #666666">=</span> h_data[<span style="color: #666666">0</span>,:]                <span style="color: #408080; font-style: italic"># 1st column: x coordinates</span>
    h_data <span style="color: #666666">=</span> h_data[<span style="color: #666666">1</span>:,:]          <span style="color: #408080; font-style: italic"># other columns: h shapes</span>

    t <span style="color: #666666">=</span> x<span style="color: #666666">/</span>v                        <span style="color: #408080; font-style: italic"># time corresponding to x</span>
    dt <span style="color: #666666">=</span> t[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> t[<span style="color: #666666">0</span>]

    <span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">f</span>(u):
        <span style="color: #008000; font-weight: bold">return</span> k<span style="color: #666666">*</span>u

    data <span style="color: #666666">=</span> [x, t]      <span style="color: #408080; font-style: italic"># key input and output data (arrays)</span>
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">range</span>(h_data<span style="color: #666666">.</span>shape[<span style="color: #666666">0</span>]):
        h <span style="color: #666666">=</span> h_data[i,:]            <span style="color: #408080; font-style: italic"># extract a column</span>
        a <span style="color: #666666">=</span> acceleration(h, x, v)

        u <span style="color: #666666">=</span> forced_vibrations(t<span style="color: #666666">=</span>t, I<span style="color: #666666">=0.2</span>, m<span style="color: #666666">=</span>m, b<span style="color: #666666">=</span>b, f<span style="color: #666666">=</span>f, F<span style="color: #666666">=-</span>m<span style="color: #666666">*</span>a)
        data<span style="color: #666666">.</span>append([h, a, u])
    <span style="color: #008000; font-weight: bold">return</span> data
</pre></div>
<p>
Note that function arguments can be given default values (known as
<em>keyword arguments</em> in Python). Python has a lot of operating
system functionality, such as
checking if a file, directory, or link exist, creating or
removing files and directories, running stand-alone applications, etc.

<p>
Since the roads have a quite noise shape, the force \( F=-ma \) looks
very noisy, while the response \( u(t) \) to this excitation is
significantly less noisy,
see Figure <a href="#bumpy:fig4">5</a> for an example.
It may be useful to compute the root mean square value of the various
realizations of \( u(t) \) and add this array to the <code>data</code> list of input
and output data in the problem:

<p>

<!-- code=text (!bc cod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">def rms(data):
    t = data[1]
    u_rms = np.zeros(t.size)  # for accumulating the rms value
    for h, a, u in data[2:]:  # loop over results
        u_rms += u**2
    u_rms = np.sqrt(u_rms/u_rms.size)
    data.append(u_rms)
    return data
</pre></div>
<p>
Observe here the <code>for</code> loop where three variables (<code>h</code>, <code>a</code>, and <code>u</code>)
are set equal to the three arrays in each element of the sublist
<code>data[2:]</code>. We only need the <code>u</code> array for the computation. An alternative
loop would be to have one loop variable for each list element and
get <code>u</code> as the 3rd element of each list element:
<p>

<!-- code=text (!bc cod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">    for res in data[2:]:
        u = res[2]         # res is [h,a,u]
        ...
</pre></div>
<p>
After calling
<p>

<!-- code=text (!bc cod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">road_url = &#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;
data = solve(url=road_url,
             m=60, b=200, k=60, v=6)
data = rms(data)
</pre></div>
<p>
the <code>data</code> array contains single arrays and triplets of arrays,
<p>

<!-- code=text (!bc cod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">[x, t, [h,a,u], [h,a,u], ..., [h,a,u], u_rms]
</pre></div>
<p>
This list, or any Python object, can be stored on file for later
retrieval of the results, using the <em>pickling</em> functionality
in Python:
<p>

<!-- code=text typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">import cPickle
outfile = open(&#39;bumpy.res&#39;, &#39;w&#39;)
cPickle.dump(data, outfile)
outfile.close()
</pre></div>
<p>
<!-- joblib!! -->

<p>
<!-- !split -->

<h1 id="___sec10">User input <a name="___sec10"></a></h1>

We can in this example easily set the input data directly in
the program, e.g., in the call to the <code>solve</code> function, as
demonstrated above. However, most users will find it more
convenient to set parameters through a user interface rather
than editing the source code directly.

<h2 id="___sec11">Positional command-line arguments <a name="___sec11"></a></h2>

The simplest, and often also the most effective type of
user interface is to use the command line. Suppose \( m \), \( k \),
and \( v \), as well as the URL or filename for the road shapes,
are fixed parameters and that the user is allowed to vary
\( b \) only. Then it is convenient, both for the user and
the programmer, to specify \( b \) as the first command-line
argument to the program. If the name of the program file
is <code>bumpy.py</code> and \( b=10 \) is desired, we can write

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python bumpy.py 10
</pre></div>
<p>
The corresponding code in the program for setting input data
and extract the user-given value of \( b \) reads

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">prepare_input</span>():
    url <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
    m <span style="color: #666666">=</span> <span style="color: #666666">60</span>
    k <span style="color: #666666">=</span> <span style="color: #666666">60</span>
    v <span style="color: #666666">=</span> <span style="color: #666666">5</span>
    <span style="color: #008000; font-weight: bold">try</span>:
        b <span style="color: #666666">=</span> <span style="color: #008000">float</span>(sys<span style="color: #666666">.</span>argv[<span style="color: #666666">1</span>])
    <span style="color: #008000; font-weight: bold">except</span> <span style="color: #D2413A; font-weight: bold">IndexError</span>:
        b <span style="color: #666666">=</span> <span style="color: #666666">80</span>  <span style="color: #408080; font-style: italic"># default</span>
    <span style="color: #008000; font-weight: bold">return</span> url, m, b, k, v
</pre></div>
<p>
The command-line arguments are available as strings in the
list <code>sys.argv</code>, from the element with index 1 and onward.
The first command-line argument <code>sys.argv[1]</code> is a string
so it must be converted to a <code>float</code> object (representing
real number) prior to computations. If the command-line
argument is missing, <code>sys.argv[1]</code> is illegal indexing
and the <code>IndexError</code> exception is raised. We can test for this
error and provide a default value. Without the <code>try-except</code>
construction, the program will abort with an error message
if no command-line argument is given.

<h2 id="___sec12">Option-value pairs on the command line <a name="___sec12"></a></h2>

Letting the user set many parameters on the command line is most
conveniently done by allowing option-value pairs, e.g.,

<p>

<!-- code=text (!bc sys) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">Terminal&gt; python bumpy.py --m 40 --b 280
</pre></div>
<p>
All parameters have a default value which can be overrided on
the command line by providing the string (option) <code>--name</code>, where
<code>name</code> is the name of the parameter, followed by the desired value of
the parameter. Implementation of option-value input is
most easily carried out using Python's <code>argparse</code> module.
The recipe goes as follows.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">command_line_options</span>():
    <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">argparse</span>
    parser <span style="color: #666666">=</span> argparse<span style="color: #666666">.</span>ArgumentParser()
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">&#39;--m&#39;</span>, <span style="color: #BA2121">&#39;--mass&#39;</span>, <span style="color: #008000">type</span><span style="color: #666666">=</span><span style="color: #008000">float</span>,
                        default<span style="color: #666666">=60</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;mass of vehicle&#39;</span>)
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">&#39;--k&#39;</span>, <span style="color: #BA2121">&#39;--spring&#39;</span>, <span style="color: #008000">type</span><span style="color: #666666">=</span><span style="color: #008000">float</span>,
                        default<span style="color: #666666">=60</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;spring parameter&#39;</span>)
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">&#39;--b&#39;</span>, <span style="color: #BA2121">&#39;--damping&#39;</span>, <span style="color: #008000">type</span><span style="color: #666666">=</span><span style="color: #008000">float</span>,
                        default<span style="color: #666666">=80</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;damping parameter&#39;</span>)
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">&#39;--v&#39;</span>, <span style="color: #BA2121">&#39;--velocity&#39;</span>, <span style="color: #008000">type</span><span style="color: #666666">=</span><span style="color: #008000">float</span>,
                        default<span style="color: #666666">=5</span>, help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;velocity of vehicle&#39;</span>)
    url <span style="color: #666666">=</span> <span style="color: #BA2121">&#39;http://hplbit.bitbucket.org/data/bumpy/bumpy.dat.gz&#39;</span>
    parser<span style="color: #666666">.</span>add_argument(<span style="color: #BA2121">&#39;--roadfile&#39;</span>, <span style="color: #008000">type</span><span style="color: #666666">=</span><span style="color: #008000">str</span>,
              default<span style="color: #666666">=</span>url, help<span style="color: #666666">=</span><span style="color: #BA2121">&#39;filename/URL with road data&#39;</span>)
    args <span style="color: #666666">=</span> parser<span style="color: #666666">.</span>parse_args()
    <span style="color: #408080; font-style: italic"># Extract input parameters</span>
    m <span style="color: #666666">=</span> args<span style="color: #666666">.</span>m; k <span style="color: #666666">=</span> args<span style="color: #666666">.</span>k; b <span style="color: #666666">=</span> args<span style="color: #666666">.</span>b; v <span style="color: #666666">=</span> args<span style="color: #666666">.</span>v
    url <span style="color: #666666">=</span> args<span style="color: #666666">.</span>roadfile
    <span style="color: #008000; font-weight: bold">return</span> url, m, b, k, v
</pre></div>
<p>
We may offer two options for each parameter, one reflecting the
mathematical symbol (like <code>--v</code>) and one more descriptive text
(like <code>--velocity-</code>).

<p>
The files in <code>doc/src/src-bumpy/</code> on <a href="https://bitbucket.org/hplbit/bumpy" target="_blank">Bitbucket</a> contain the complete code
for downloading road shapes and solving the problem with aid of the
code snippets above.

<p>
<!-- !split -->

<h1 id="___sec13">Visual exploration <a name="___sec13"></a></h1>

This section explains how to load the data from the computation, stored
as a pickled list in the file <code>bumpy.res</code>, into various arrays, and how
to visualize these arrays. We want to produce the following plots:

<ul>
 <li> the root mean square value of \( u(t) \), to see the typical amplitudes</li>
 <li> the spectrum of \( u(t) \), for \( t>t_s \) (using FFT) to see which frequencies
   that dominate in the signal</li>
 <li> for each road shape, a plot of \( h(x) \), \( a(t) \), and \( u(t) \), for
   \( t\geq t_s \)</li>
</ul>

We use Matplotlib's <code>pylab</code> module for curve plotting since it provides
a syntax very close to that of MATLAB, which is well known by many readers.

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">matplotlib.pylab</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #666666">*</span>
</pre></div>
<p>
This import also perform as <code>from numpy import *</code> such that we have access
to all the array functionality too.

<p>
Loading the computational data from file back to a list <code>data</code> is done
by

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">cPickle</span>
outfile <span style="color: #666666">=</span> <span style="color: #008000">open</span>(<span style="color: #BA2121">&#39;bumpy.res&#39;</span>, <span style="color: #BA2121">&#39;r&#39;</span>)
data <span style="color: #666666">=</span> cPickle<span style="color: #666666">.</span>load(outfile)
outfile<span style="color: #666666">.</span>close()

x, t <span style="color: #666666">=</span> data[<span style="color: #666666">0</span>:<span style="color: #666666">2</span>]
u_rms <span style="color: #666666">=</span> data[<span style="color: #666666">-1</span>]
</pre></div>
<p>
The remaining data, <code>data[2:-1]</code>, contains all the 3-lists <code>[h, a, u]</code>
from the computations in the function <code>forced_vibrations</code>.

<p>
Since now we concentrate on the part \( t\geq t_s \) of the data, we
can grab the corresponding parts of the arrays in the following way,
using boolean arrays as indices:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">indices <span style="color: #666666">=</span> t <span style="color: #666666">&gt;=</span> t_s   <span style="color: #408080; font-style: italic"># True/False boolean array</span>
t <span style="color: #666666">=</span> t[indices]       <span style="color: #408080; font-style: italic"># fetch the part of t for which t &gt; t_s</span>
x <span style="color: #666666">=</span> x[indices]       <span style="color: #408080; font-style: italic"># fetch the part of x for which t &gt; t_s</span>
</pre></div>
<p>
Indexing by a boolean array extracts all the elements corresponding to
the <code>True</code> elements in the index array.

<p>
Plotting the root mean square value array <code>u_rms</code> for <code>t >= t_s</code> is now done by

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">figure()
u_rms <span style="color: #666666">=</span> u_rms[indices]
plot(t, u_rms)
legend([<span style="color: #BA2121">&#39;u&#39;</span>])
xlabel(<span style="color: #BA2121">&#39;t&#39;</span>)
title(<span style="color: #BA2121">&#39;Root mean square value of u(t) functions&#39;</span>)
</pre></div>
<p>
Figure <a href="#bumpy:fig3">3</a> shows the result.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 3:  Root mean square of displacement. <a name="bumpy:fig3"></a> </p></center>
<p><img src="fig-bumpy/u_rms.png" align="bottom" width=600></p>
</center>

<p>
The spectrum of a \( u(t) \) function (represented through the arrays <code>u</code>
and <code>t</code>) can be computed by the Python function

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">frequency_analysis</span>(u, t):
    A <span style="color: #666666">=</span> fft(u)
    A <span style="color: #666666">=</span> <span style="color: #666666">2*</span>A
    dt <span style="color: #666666">=</span> t[<span style="color: #666666">1</span>] <span style="color: #666666">-</span> t[<span style="color: #666666">0</span>]
    N <span style="color: #666666">=</span> t<span style="color: #666666">.</span>size
    freq <span style="color: #666666">=</span> arange(N<span style="color: #666666">/2</span>, dtype<span style="color: #666666">=</span><span style="color: #008000">float</span>)<span style="color: #666666">/</span>N<span style="color: #666666">/</span>dt
    A <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(A[<span style="color: #666666">0</span>:freq<span style="color: #666666">.</span>size])<span style="color: #666666">/</span>N
    <span style="color: #408080; font-style: italic"># Remove small high frequency part</span>
    tol <span style="color: #666666">=</span> <span style="color: #666666">0.05*</span>A<span style="color: #666666">.</span>max()
    <span style="color: #008000; font-weight: bold">for</span> i <span style="color: #AA22FF; font-weight: bold">in</span> <span style="color: #008000">xrange</span>(<span style="color: #008000">len</span>(A)<span style="color: #666666">-1</span>, <span style="color: #666666">0</span>, <span style="color: #666666">-1</span>):
        <span style="color: #008000; font-weight: bold">if</span> A[i] <span style="color: #666666">&gt;</span> tol:
            <span style="color: #008000; font-weight: bold">break</span>
    <span style="color: #008000; font-weight: bold">return</span> freq[:i<span style="color: #666666">+1</span>], A[:i<span style="color: #666666">+1</span>]
</pre></div>
<p>
Note here that we truncate that last part of the spectrum where the
amplitudes are small (this usually gives a plot that is easier to inspect).

<p>
In the present case, we utilize the <code>frequency_analysis</code> through

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">figure()
u <span style="color: #666666">=</span> data[<span style="color: #666666">3</span>][<span style="color: #666666">2</span>][indices]  <span style="color: #408080; font-style: italic"># 2nd realization of u</span>
f, A <span style="color: #666666">=</span> frequency_analysis(u, t)
plot(f, A)
title(<span style="color: #BA2121">&#39;Spectrum of u&#39;</span>)
</pre></div>
<p>
Note the list look-up <code>data[3][2][indices]</code>: the element with index
3 contains the 2nd 3-list <code>[h, a, u]</code>, and the element with index 2
in this 3-list is the <code>u</code> array, in which we seek the part where
\( t\geq t_s \), here corresponding to the <code>True</code> indices in the boolean
array <code>indices</code>.

<p>
Figure <a href="#bumpy:fig2">4</a> shows the amplitudes and that the
dominating frequency is 1 Hz.

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 4:  Spectrum of displacement. <a name="bumpy:fig2"></a> </p></center>
<p><img src="fig-bumpy/u_spectrum.png" align="bottom" width=600></p>
</center>

<p>
Finally, we can run through all the 3-lists <code>[h, a, u]</code> and plot
these arrays:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%">case_counter <span style="color: #666666">=</span> <span style="color: #666666">0</span>
<span style="color: #008000; font-weight: bold">for</span> h, a, u <span style="color: #AA22FF; font-weight: bold">in</span> data[<span style="color: #666666">2</span>:<span style="color: #666666">-1</span>]:
    h <span style="color: #666666">=</span> h[indices]
    a <span style="color: #666666">=</span> a[indices]
    u <span style="color: #666666">=</span> u[indices]

    figure()
    subplot(<span style="color: #666666">3</span>, <span style="color: #666666">1</span>, <span style="color: #666666">1</span>)
    plot(x, h, <span style="color: #BA2121">&#39;g-&#39;</span>)
    legend([<span style="color: #BA2121">&#39;h </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> case_counter])
    hmax <span style="color: #666666">=</span> (<span style="color: #008000">abs</span>(h<span style="color: #666666">.</span>max()) <span style="color: #666666">+</span> <span style="color: #008000">abs</span>(h<span style="color: #666666">.</span>min()))<span style="color: #666666">/2</span>
    axis([x[<span style="color: #666666">0</span>], x[<span style="color: #666666">-1</span>], <span style="color: #666666">-</span>hmax<span style="color: #666666">*5</span>, hmax<span style="color: #666666">*5</span>])
    xlabel(<span style="color: #BA2121">&#39;distance&#39;</span>); ylabel(<span style="color: #BA2121">&#39;height&#39;</span>)

    subplot(<span style="color: #666666">3</span>, <span style="color: #666666">1</span>, <span style="color: #666666">2</span>)
    plot(t, a)
    legend([<span style="color: #BA2121">&#39;a </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> case_counter])
    xlabel(<span style="color: #BA2121">&#39;t&#39;</span>); ylabel(<span style="color: #BA2121">&#39;acceleration&#39;</span>)

    subplot(<span style="color: #666666">3</span>, <span style="color: #666666">1</span>, <span style="color: #666666">3</span>)
    plot(t, u, <span style="color: #BA2121">&#39;r-&#39;</span>)
    legend([<span style="color: #BA2121">&#39;u </span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">&#39;</span> <span style="color: #666666">%</span> case_counter])
    xlabel(<span style="color: #BA2121">&#39;t&#39;</span>); ylabel(<span style="color: #BA2121">&#39;displacement&#39;</span>)
    savefig(<span style="color: #BA2121">&#39;tmp</span><span style="color: #BB6688; font-weight: bold">%d</span><span style="color: #BA2121">.png&#39;</span> <span style="color: #666666">%</span> case_counter)
    case_counter <span style="color: #666666">+=</span> <span style="color: #666666">1</span>
</pre></div>
<p>
<!-- A word about what happens to the <code>h</code> (or <code>a</code> or <code>u</code>) variable might -->
<!-- illustrate much about dynamic typing in Python. In the loop, <code>h</code> is -->
<!-- set equal to an -->

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 5:  First realization of a bumpy road, with corresponding acceleration of the wheel and resulting vibrations. <a name="bumpy:fig4"></a> </p></center>
<p><img src="fig-bumpy/hau0.png" align="bottom" width=700></p>
</center>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 6:  Second realization of a bumpy road, with corresponding acceleration of the wheel and resulting vibrations. <a name="bumpy:fig5"></a> </p></center>
<p><img src="fig-bumpy/hau1.png" align="bottom" width=700></p>
</center>

<p>
<center> <!-- figure -->
<hr class="figure">
<center><p class="caption">Figure 7:  Third realization of a bumpy road, with corresponding acceleration of the wheel and resulting vibrations. <a name="bumpy:fig6"></a> </p></center>
<p><img src="fig-bumpy/hau2.png" align="bottom" width=700></p>
</center>

<p>
If all the plot commands above are placed in a file, as in
<a href="https://github.com/hplgit/bumpy/blob/master/doc/src/src-bumpy/explore.py" target="_blank">explore.py</a>, a final <code>show()</code> call is needed to show the
plots on the screen. On the other hand, the commands are usually
more conveniently performed in an interactive Python shell, preferably
IPython.

<p>
<!-- include something about Cython, software engineering (classes, testing, -->
<!-- modules) -->

<p>
<!-- ======= Software engineering ======= -->

<h1 id="___sec14">Advanced topics <a name="___sec14"></a></h1>

<h2 id="___sec15">Symbolic computing via SymPy <a name="___sec15"></a></h2>

Python has a package SymPy that offers symbolic computing. Here is
a simple introductory example where we differentiate a quadratic
polynomial, integrate it again, and find the roots:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> <span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">sympy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">sp</span>
<span style="color: #666666">&gt;&gt;&gt;</span> x, a <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>symbols(<span style="color: #BA2121">&#39;x a&#39;</span>)        <span style="color: #408080; font-style: italic"># Define mathematical symbols</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Q <span style="color: #666666">=</span> a<span style="color: #666666">*</span>x<span style="color: #666666">**2</span> <span style="color: #666666">-</span> <span style="color: #666666">1</span>                  <span style="color: #408080; font-style: italic"># Quadratic function</span>
<span style="color: #666666">&gt;&gt;&gt;</span> dQdx <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>diff(Q, x)            <span style="color: #408080; font-style: italic"># Differentiate wrt x</span>
<span style="color: #666666">&gt;&gt;&gt;</span> dQdx
<span style="color: #666666">2*</span>a<span style="color: #666666">*</span>x
<span style="color: #666666">&gt;&gt;&gt;</span> Q2 <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>integrate(dQdx, x)      <span style="color: #408080; font-style: italic"># Integrate (no constant)</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Q2
a<span style="color: #666666">*</span>x<span style="color: #666666">**2</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Q2 <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>integrate(Q, (x, <span style="color: #666666">0</span>, a)) <span style="color: #408080; font-style: italic"># Definite integral</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Q2
a<span style="color: #666666">**4/3</span> <span style="color: #666666">-</span> a
<span style="color: #666666">&gt;&gt;&gt;</span> roots <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>solve(Q, x)          <span style="color: #408080; font-style: italic"># Solve Q = 0 wrt x</span>
<span style="color: #666666">&gt;&gt;&gt;</span> roots
[<span style="color: #666666">-</span>sqrt(<span style="color: #666666">1/</span>a), sqrt(<span style="color: #666666">1/</span>a)]
</pre></div>
<p>
One can easily convert a SymPy expression like <code>Q</code> into
a Python function <code>Q(x, a)</code> to be used for further numerical
computing:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> Q <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>lambdify([x, a], Q)      <span style="color: #408080; font-style: italic"># Turn Q into Py func.</span>
<span style="color: #666666">&gt;&gt;&gt;</span> Q(x<span style="color: #666666">=2</span>, a<span style="color: #666666">=3</span>)                     <span style="color: #408080; font-style: italic"># 3*2**2 - 1 = 11</span>
<span style="color: #666666">11</span>
</pre></div>
<p>
Sympy can do a lot of other things. Here is an example on
computing the Taylor series of \( e^{-x}\sin(rx) \), where \( r \)
is the smallest root of \( Q=ax^2-1=0 \) as computed above:

<p>

<!-- code=python (!bc pyshell) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #666666">&gt;&gt;&gt;</span> f <span style="color: #666666">=</span> sp<span style="color: #666666">.</span>exp(<span style="color: #666666">-</span>a<span style="color: #666666">*</span>x)<span style="color: #666666">*</span>sp<span style="color: #666666">.</span>sin(roots[<span style="color: #666666">0</span>]<span style="color: #666666">*</span>x)
<span style="color: #666666">&gt;&gt;&gt;</span> f<span style="color: #666666">.</span>series(x, <span style="color: #666666">0</span>, <span style="color: #666666">4</span>)
<span style="color: #666666">-</span>x<span style="color: #666666">*</span>sqrt(<span style="color: #666666">1/</span>a) <span style="color: #666666">+</span> x<span style="color: #666666">**3*</span>(<span style="color: #666666">-</span>a<span style="color: #666666">**2*</span>sqrt(<span style="color: #666666">1/</span>a)<span style="color: #666666">/2</span> <span style="color: #666666">+</span> (<span style="color: #666666">1/</span>a)<span style="color: #666666">**</span>(<span style="color: #666666">3/2</span>)<span style="color: #666666">/6</span>) <span style="color: #666666">+</span>
a<span style="color: #666666">*</span>x<span style="color: #666666">**2*</span>sqrt(<span style="color: #666666">1/</span>a) <span style="color: #666666">+</span> O(x<span style="color: #666666">**4</span>)
</pre></div>

<h2 id="___sec16">Testing <a name="___sec16"></a></h2>

Software testing in Python is best done with a <em>unit test framework</em>
such as <code>nose</code> or <code>pytest</code>. These frameworks can automatically
run all functions starting with <code>test_</code> recursively in files in a
directory tree. Each <code>test_*</code> function is called a <em>test function</em>
and must take no arguments and apply <code>assert</code> to a boolean expression
that is <code>True</code> if the test passes and <code>False</code> if it fails.

<h3 id="___sec17">Example on a test function <a name="___sec17"></a></h3>


<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">halve</span>(x):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return half of x.&quot;&quot;&quot;</span>
    <span style="color: #008000; font-weight: bold">return</span> x<span style="color: #666666">/2.0</span>

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_halve</span>():
    x <span style="color: #666666">=</span> <span style="color: #666666">4</span>
    expected <span style="color: #666666">=</span> <span style="color: #666666">2</span>
    computed <span style="color: #666666">=</span> halve(x)
    <span style="color: #408080; font-style: italic"># Compare real numbers using tolerance</span>
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-14</span>
    diff <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(computed <span style="color: #666666">-</span> expected)
    <span style="color: #008000; font-weight: bold">assert</span> diff <span style="color: #666666">&lt;</span> tol
</pre></div>

<h3 id="___sec18">Test function for the numerical solver <a name="___sec18"></a></h3>

A frequently used technique to test differential equation solvers
is to just specify a solution and fit a source term in the differential
equation such that the specified solution solves the equation.
The initial conditions must be set according to the specified
solution. This technique is known as the <em>method of manufactured
solutions</em>.

<p>
Here we shall specify a solution that is quadratic or linear
in \( t \) because
such lower-order polynomials will often be an exact solution of both
the differential equation <em>and</em> the finite difference equations.
This means that the polynomial should be reproduced to machine
precision by our <code>solver</code> function.

<p>
We can use SymPy to find an appropriate \( F(t) \) term in the
differential equation such that a specified solution \( u(t)=I + Vt + qt^2 \)
fits the equation and initial conditions. With quadratic damping,
only a linear \( u \) will solve the discrete equation so in this case
we choose \( u=I+Vt \).

<p>
We embed the SymPy calculations and the numerical calcuations
in a <em>test function</em>:

<p>

<!-- code=python (!bc pycod) typeset with pygments style "default" -->
<div class="highlight" style="background: #f8f8f8"><pre style="line-height: 125%"><span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">lhs_eq</span>(t, m, b, s, u, damping<span style="color: #666666">=</span><span style="color: #BA2121">&#39;linear&#39;</span>):
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Return lhs of differential equation as sympy expression.&quot;&quot;&quot;</span>
    v <span style="color: #666666">=</span> sm<span style="color: #666666">.</span>diff(u, t)
    d <span style="color: #666666">=</span> b<span style="color: #666666">*</span>v <span style="color: #008000; font-weight: bold">if</span> damping <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;linear&#39;</span> <span style="color: #008000; font-weight: bold">else</span> b<span style="color: #666666">*</span>v<span style="color: #666666">*</span>sm<span style="color: #666666">.</span>Abs(v)
    <span style="color: #008000; font-weight: bold">return</span> m<span style="color: #666666">*</span>sm<span style="color: #666666">.</span>diff(u, t, t) <span style="color: #666666">+</span> d <span style="color: #666666">+</span> s(u)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">test_solver</span>():
    <span style="color: #BA2121; font-style: italic">&quot;&quot;&quot;Verify linear/quadratic solution.&quot;&quot;&quot;</span>
    <span style="color: #408080; font-style: italic"># Set input data for the test</span>
    I <span style="color: #666666">=</span> <span style="color: #666666">1.2</span>; V <span style="color: #666666">=</span> <span style="color: #666666">3</span>; m <span style="color: #666666">=</span> <span style="color: #666666">2</span>; b <span style="color: #666666">=</span> <span style="color: #666666">0.9</span>; k <span style="color: #666666">=</span> <span style="color: #666666">4</span>
    s <span style="color: #666666">=</span> <span style="color: #008000; font-weight: bold">lambda</span> u: k<span style="color: #666666">*</span>u
    T <span style="color: #666666">=</span> <span style="color: #666666">2</span>
    dt <span style="color: #666666">=</span> <span style="color: #666666">0.2</span>
    N <span style="color: #666666">=</span> <span style="color: #008000">int</span>(<span style="color: #008000">round</span>(T<span style="color: #666666">/</span>dt))
    time_points <span style="color: #666666">=</span> np<span style="color: #666666">.</span>linspace(<span style="color: #666666">0</span>, T, N<span style="color: #666666">+1</span>)

    <span style="color: #408080; font-style: italic"># Test linear damping</span>
    t <span style="color: #666666">=</span> sm<span style="color: #666666">.</span>Symbol(<span style="color: #BA2121">&#39;t&#39;</span>)
    q <span style="color: #666666">=</span> <span style="color: #666666">2</span>  <span style="color: #408080; font-style: italic"># arbitrary constant</span>
    u_exact <span style="color: #666666">=</span> I <span style="color: #666666">+</span> V<span style="color: #666666">*</span>t <span style="color: #666666">+</span> q<span style="color: #666666">*</span>t<span style="color: #666666">**2</span>   <span style="color: #408080; font-style: italic"># sympy expression</span>
    F_term <span style="color: #666666">=</span> lhs_eq(t, m, b, s, u_exact, <span style="color: #BA2121">&#39;linear&#39;</span>)
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Fitted source term, linear case:&#39;</span>, F_term
    F <span style="color: #666666">=</span> sm<span style="color: #666666">.</span>lambdify([t], F_term)
    u, t_ <span style="color: #666666">=</span> solver(I, V, m, b, s, F, time_points, <span style="color: #BA2121">&#39;linear&#39;</span>)
    u_e <span style="color: #666666">=</span> sm<span style="color: #666666">.</span>lambdify([t], u_exact, modules<span style="color: #666666">=</span><span style="color: #BA2121">&#39;numpy&#39;</span>)
    error <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(u_e(t_) <span style="color: #666666">-</span> u)<span style="color: #666666">.</span>max()
    tol <span style="color: #666666">=</span> <span style="color: #666666">1E-13</span>
    <span style="color: #008000; font-weight: bold">assert</span> error <span style="color: #666666">&lt;</span> tol

    <span style="color: #408080; font-style: italic"># Test quadratic damping: u_exact must be linear</span>
    u_exact <span style="color: #666666">=</span> I <span style="color: #666666">+</span> V<span style="color: #666666">*</span>t
    F_term <span style="color: #666666">=</span> lhs_eq(t, m, b, s, u_exact, <span style="color: #BA2121">&#39;quadratic&#39;</span>)
    <span style="color: #008000; font-weight: bold">print</span> <span style="color: #BA2121">&#39;Fitted source term, quadratic case:&#39;</span>, F_term
    F <span style="color: #666666">=</span> sm<span style="color: #666666">.</span>lambdify([t], F_term)
    u, t_ <span style="color: #666666">=</span> solver(I, V, m, b, s, F, time_points, <span style="color: #BA2121">&#39;quadratic&#39;</span>)
    u_e <span style="color: #666666">=</span> sm<span style="color: #666666">.</span>lambdify([t], u_exact, modules<span style="color: #666666">=</span><span style="color: #BA2121">&#39;numpy&#39;</span>)
    error <span style="color: #666666">=</span> <span style="color: #008000">abs</span>(u_e(t_) <span style="color: #666666">-</span> u)<span style="color: #666666">.</span>max()
    <span style="color: #008000; font-weight: bold">assert</span> error <span style="color: #666666">&lt;</span> tol
</pre></div>
<p>
<!-- ===== Installation ===== -->

<p>
<!-- Install the <code>solver</code> module using a very simple <code>setup.py</code> script. -->

<p>
<!-- Comment on usefulness even for those without phys/math background, -->
<!-- but with extensive programming background: being a programmer -->
<!-- means divining into domains with a lot of details, yet being able -->
<!-- to program. -->

<p>
<!-- Python Scientific are also in 5620/literature, some of those above -->
<!-- could be copied here -->

<h1 id="app:motivation">Appendix: Quick motivation for programming with Python<a name="app:motivation"></a></h1>

<ul>
  <li> <a href="http://www.pyzo.org/whypython.html" target="_blank">Why Python?</a></li>
  <li> <a href="http://fperez.org/py4science/warts.html" target="_blank">Why Python for Scientific Computing?</a></li>
</ul>

<h1 id="app:resources">Appendix: Scientific Python resources<a name="app:resources"></a></h1>

<h3 id="___sec21">Full tutorials on scientific programming with Python <a name="___sec21"></a></h3>

<ul>
  <li> <a href="http://scipy-lectures.github.com/" target="_blank">Python Scientific Lecture Notes</a> (from EuroSciPy tutorials, based on <a href="http://web.phys.ntnu.no/~ingves/Teaching/TFY4240/Assignments/PythonScientific.pdf" target="_blank">Python Scientific</a>)</li>
  <li> <a href="https://github.com/jrjohansson/scientific-python-lectures" target="_blank">Scientific Python Lectures as IPython notebooks</a></li>
  <li> <a href="https://github.com/stefanv/teaching" target="_blank">Stefan van der Walt's lectures</a></li>
</ul>

<h3 id="___sec22">NumPy resources <a name="___sec22"></a></h3>

<ul>
  <li> <a href="http://www.scipy.org/Tentative_NumPy_Tutorial" target="_blank">NumPy Tutorial</a></li>
  <li> <a href="http://docs.scipy.org/doc/numpy/user/" target="_blank">NumPy User Guide</a></li>
  <li> <a href="https://github.com/pv/advanced-numpy-tutorial" target="_blank">Advanced NumPy Tutorial</a></li>
  <li> <a href="http://scipy2010.blogspot.com/2010/06/tutorials-day-1-advanced-numpy.html" target="_blank">Advanced NumPy Course</a></li>
  <li> <a href="http://www.scipy.org/Numpy_Example_List" target="_blank">NumPy Example List</a></li>
  <li> <a href="http://mentat.za.net/numpy/numpy_advanced_slides/" target="_blank">NumPy Medkit</a></li>
  <li> <a href="http://www.scipy.org/Cookbook" target="_blank">NumPy and SciPy Cookbook</a></li>
  <li> <a href="http://www.scipy.org/NumPy_for_Matlab_Users" target="_blank">NumPy for Matlab Users</a></li>
  <li> <a href="http://mathesaurus.sf.net" target="_blank">NumPy for Matlab/R/IDL Users</a></li>
</ul>

<h3 id="___sec23">Useful resources <a name="___sec23"></a></h3>

<ul>
  <li> <a href="http://www.astropython.org/" target="_blank">AstroPython</a></li>
  <li> <a href="http://www.youtube.com/watch?feature=player_embedded&v=F4rFuIb1Ie4" target="_blank">Talk on IPython by Fernando Perez</a></li>
  <li> <a href="http://fperez.org/py4science/starter_kit.html" target="_blank">Useful software in the Scientific Python Ecosystem</a></li>
  <li> <a href="http://ipython.scipy.org/doc/manual/html" target="_blank">IPython</a></li>
  <li> <a href="http://code.google.com/p/pythonxy/wiki/Welcome" target="_blank">Python(x,y)</a></li>
  <li> <a href="http://www.yourmachines.org/tutorials/mgpy.html" target="_blank">Basic Motion Graphics with Python</a>
<!-- This is now local in doc/literature since the link is broken: <a href="http://www.maths.lth.se/na/help/media/Practical_Scientific_Computing_with_Python.pdf" target="_blank">Practical Scientific Computing with Python</a> -->
<!-- Basic Motion Graphics with Python contains a lot about making movies -->
<!-- and animation - check it out --></li>
</ul>

<h3 id="___sec24">Some relevant Python books <a name="___sec24"></a></h3>

<ul>
  <li> <a href="http://www.greenteapress.com/thinkpython/" target="_blank">Think Python</a></li>
  <li> <a href="http://learnpythonthehardway.org/book/" target="_blank">Learn Python The Hard Way</a></li>
  <li> <a href="http://diveintopython.org/toc/index.html" target="_blank">Dive Into Python</a></li>
  <li> <a href="http://www.freenetpages.co.uk/hp/alan.gauld/" target="_blank">Think Like a Computer Scientist</a></li>
  <li> <a href="http://femhub.com/textbook-python/python_en.pdf/" target="_blank">Introduction to Python Programming</a> (for scientists)</li>
  <li> <a href="http://www.amazon.com/Scientific-Programming-Computational-Science-Engineering/dp/3642183654/ref=sr_1_2?ie=UTF8&qid=1354752885&sr=8-2&keywords=langtangen" target="_blank">A Primer on Scientific Programming with Python</a></li>

<ul>
    <li> Gerard Gorman has made associated <a href="http://ggorman.github.io/Introduction-to-programming-for-geoscientists/" target="_blank">IPython notebooks</a> for teaching</li>
    <li> Traditional beamer <a href="http://www.ifi.uio.no&nbsp;inf1100/foiler" target="_blank">slides</a> are also available</li>
</ul>

  <li> <a href="http://www.amazon.com/Python-Scripting-Computational-Science-Engineering/dp/3642093159/ref=sr_1_1?ie=UTF8&qid=1354752885&sr=8-1&keywords=langtangen" target="_blank">Python Scripting for Computational Science</a></li>
</ul>

<h3 id="___sec25">Course material on Python programming in general <a name="___sec25"></a></h3>

<ul>
  <li> <a href="http://docs.python.org/2/tutorial/" target="_blank">The Official Python Tutorial</a></li>
  <li> <a href="http://www.tutorialspoint.com/python/" target="_blank">Python Tutorial on tutorialspoint.com</a></li>
  <li> <a href="http://www.learnpython.org/" target="_blank">Interactive Python tutorial site</a></li>
  <li> <a href="http://en.wikibooks.org/wiki/A_Beginner's_Python_Tutorial" target="_blank">A Beginner's Python Tutorial on wikibooks.org</a></li>
  <li> <a href="http://en.wikibooks.org/wiki/Python_Programming/" target="_blank">Python Programming on wikibooks.org</a></li>
  <li> <a href="http://en.wikibooks.org/wiki/Non-Programmer's_Tutorial_for_Python_2.6" target="_blank">Non-Programmer's Tutorial for Python on wikibooks.org</a></li>
  <li> <a href="http://www.pythonforbeginners.com/" target="_blank">Python For Beginners</a></li>
  <li> <a href="http://intropython.org" target="_blank">Gentle Python introduction for high school</a> (with <a href="https://github.com/ehmatthes/intro_programming" target="_blank">associated IPython notebooks</a>)</li>
  <li> <a href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-189-a-gentle-introduction-to-programming-using-python-january-iap-2008/" target="_blank">A Gentle Introduction to Programming Using Python</a> (MIT OpenCourseWare)</li>
  <li> <a href="http://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-00-introduction-to-computer-science-and-programming-fall-2008/" target="_blank">Introduction to Computer Science and Programming</a> (MIT OpenCourseWare with videos)</li>
  <li> <a href="http://www.catonmat.net/blog/learning-python-programming-language-through-video-lectures/" target="_blank">Learning Python Programming Language Through Video Lectures</a></li>
  <li> <a href="http://www.learnerstv.com/Free-Computers-Video-lectures-ltv163-Page1.htm" target="_blank">Python Programming Tutorials Video Lecture Course</a> (Learners TV)</li>
  <li> <a href="http://showmedo.com/videotutorials/python" target="_blank">Python Videos, Tutorials and Screencasts</a></li>
</ul>


<!-- ------------------- end of main content --------------- -->

</div>  <!-- end container -->
<!-- include javascript, jQuery *first* -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>

<!-- Bootstrap footer
<footer>
<a href="http://..."><img width="250" align=right src="http://..."></a>
</footer>
-->


</body>
</html>
    

